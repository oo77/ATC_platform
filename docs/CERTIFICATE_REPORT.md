# Ведомость выдачи сертификатов

## Описание

Реализован функционал скачивания ведомости по выдаче сертификатов для учебных групп.

## Доступ

Функция доступна только для:

- **Модераторов**
- **Администраторов**

## Расположение

Кнопка "Ведомость" находится на странице выдачи сертификатов группы:
`/groups/[id]/certificates`

## Формат документа

### Шапка документа

- Логотип организации (слева)
- Заголовок: "ВЕДОМОСТЬ ВЫДАЧИ СЕРТИФИКАТОВ" (по центру)

### Информационный блок

**Левая колонка:**

- Учебная программа
- Группа

**Правая колонка:**

- Инструкторы (все инструкторы группы через запятую)
- Период обучения

### Таблица студентов

Колонки:

1. № - порядковый номер
2. ФИО слушателя
3. Организация
4. Посещ. % - процент посещаемости
5. Ср. балл - средний балл
6. Дисц. пройдено - количество пройденных дисциплин из общего числа
7. Допуск - статус допуска к сертификации
8. Статус сертификата - выдан/не выдан/отозван
9. Дата выдачи - дата выдачи сертификата
10. № сертификата - номер сертификата

### Подвал документа

- Легенда с пояснениями статусов
- Линия для подписи
- ФИО того, кто сформировал ведомость
- Дата формирования ведомости

## Технические детали

### API Endpoint

`GET /api/certificates/report/[groupId]`

**Требования:**

- Авторизация обязательна
- Роль: moderator или admin

**Возвращает:**

```typescript
{
  success: boolean;
  groupCode: string;
  courseName: string;
  instructors: string[];  // Все инструкторы группы
  students: Array<{
    fullName: string;
    organization: string;
    totalAttendancePercent: number;
    averageGrade: number | null;
    eligibility: {
      isEligible: boolean;
      completedDisciplines: number;
      totalDisciplines: number;
    };
    certificate: {
      status: 'draft' | 'issued' | 'revoked';
      issueDate?: string;
      certificateNumber?: string;
    } | null;
  }>;
  startDate?: string;
  endDate?: string;
  generatedBy: string;  // ФИО того, кто сформировал
}
```

### Утилита генерации PDF

`app/utils/pdf/generateCertificateReport.ts`

**Используемые библиотеки:**

- jsPDF - генерация PDF
- jspdf-autotable - создание таблиц
- Шрифт: Montserrat (Regular, Bold, Italic)

### Логирование

Все действия по формированию ведомости логируются с указанием:

- ID группы
- Количества студентов
- Количества инструкторов
- ФИО пользователя, сформировавшего ведомость

## Использование

1. Перейдите на страницу выдачи сертификатов группы
2. Нажмите кнопку "Ведомость"
3. Дождитесь генерации PDF (кнопка покажет "Генерация...")
4. PDF автоматически скачается с именем `Vedomost_Certificates_[код_группы].pdf`

## Отличия от ведомости журнала дисциплин

1. **Инструкторы**: Указываются ВСЕ инструкторы группы, а не один
2. **Таблица**: Содержит данные о сертификатах вместо посещаемости по занятиям
3. **Подпись**: Указывается тот, кто сформировал ведомость (модератор/админ), а не инструктор
4. **Доступ**: Только модераторы и администраторы, а не инструкторы

## Безопасность

- Проверка прав доступа на уровне API
- Логирование всех действий
- Защита от несанкционированного доступа (401/403 ошибки)
