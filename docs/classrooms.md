# Управление аудиториями

## Обзор

Система управления аудиториями позволяет:
- Создавать и редактировать аудитории
- Активировать/деактивировать аудитории
- Назначать аудитории для событий расписания
- Указывать вместимость и описание аудиторий

## Места использования аудиторий

### 1. События расписания (`schedule_events`)
- **Поле**: `classroom_id` (FK на `classrooms.id`)
- **Использование**: Назначение аудитории для конкретного занятия
- **Компоненты**:
  - `app/components/schedule/EventModal.vue` - выбор аудитории при создании/редактировании события
  - `app/components/schedule/RetakeModal.vue` - выбор аудитории для пересдачи
  - `app/components/schedule/EventDetailModal.vue` - отображение аудитории в деталях события
  - `app/components/dashboard/Teacher.vue` - отображение аудитории в дашборде преподавателя
  - `app/components/dashboard/Student.vue` - отображение аудитории в дашборде студента

### 2. Учебные группы (`study_groups`)
- **Поле**: `classroom` (VARCHAR, текстовое поле)
- **Использование**: Указание основной аудитории для группы (опционально)
- **Компоненты**:
  - `app/components/groups/GroupFormModal.vue` - ввод названия аудитории
  - `app/pages/groups/[id]/index.vue` - отображение аудитории группы
  - `app/pages/groups/index.vue` - отображение в списке групп

**ВАЖНО**: В группах аудитория хранится как текст, а не как FK. Это сделано для гибкости, так как группа может проводиться в разных аудиториях.

## API Endpoints

### GET /api/classrooms
Получение списка аудиторий

**Query параметры**:
- `activeOnly` (boolean, default: true) - показывать только активные аудитории

**Ответ**:
```json
{
  "success": true,
  "classrooms": [
    {
      "id": "uuid",
      "name": "Аудитория 101",
      "capacity": 30,
      "description": "Компьютерный класс",
      "isActive": true,
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### POST /api/classrooms
Создание новой аудитории

**Тело запроса**:
```json
{
  "name": "Аудитория 101",
  "capacity": 30,
  "description": "Компьютерный класс"
}
```

**Валидация**:
- `name` - обязательное, минимум 1 символ
- `capacity` - опциональное, целое число >= 0
- `description` - опциональное

### PUT /api/classrooms/:id
Обновление аудитории

**Тело запроса**:
```json
{
  "name": "Аудитория 101",
  "capacity": 35,
  "description": "Обновленное описание",
  "isActive": false
}
```

Все поля опциональные.

### DELETE /api/classrooms/:id
Удаление аудитории

**Важно**: Удаление может не сработать, если аудитория используется в событиях расписания (из-за FK constraint).

## Настройки

Управление аудиториями доступно в разделе **Настройки → Аудитории**.

**Требуемые права**: `Permission.SETTINGS_MANAGE` (ADMIN, MANAGER)

## Функциональность

### Создание аудитории
1. Перейти в Настройки → Аудитории
2. Нажать "Добавить аудиторию"
3. Заполнить форму:
   - Название (обязательно)
   - Вместимость (опционально)
   - Описание (опционально)
4. Нажать "Создать"

### Редактирование аудитории
1. В списке аудиторий нажать кнопку редактирования
2. Изменить необходимые поля
3. Нажать "Сохранить"

### Активация/Деактивация
- Неактивные аудитории не отображаются в выборе при создании событий
- Деактивация не влияет на уже созданные события

### Удаление
- Аудиторию можно удалить только если она не используется в событиях расписания
- При попытке удаления используемой аудитории будет показана ошибка

## Проверка конфликтов

При создании события расписания система проверяет конфликты по аудитории:
- Функция `checkScheduleConflicts` в `server/repositories/scheduleRepository.ts`
- Проверяется пересечение времени для одной аудитории

## Миграции

Таблица `classrooms` создана в миграции `20251224_001_consolidated_schema.ts`

Структура:
```sql
CREATE TABLE IF NOT EXISTS classrooms (
  id VARCHAR(191) PRIMARY KEY,
  name VARCHAR(100) NOT NULL UNIQUE,
  capacity INT DEFAULT 0,
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
  updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),
  
  INDEX idx_name (name),
  INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Рекомендации

1. **Именование**: Используйте понятные названия (например, "Аудитория 101", "Компьютерный класс 1")
2. **Вместимость**: Указывайте реальную вместимость для контроля количества студентов
3. **Деактивация**: Не удаляйте аудитории, которые использовались ранее - лучше деактивируйте их
4. **Описание**: Добавляйте описание для специализированных аудиторий (компьютерный класс, лаборатория и т.д.)

## Будущие улучшения

Возможные улучшения системы:
- [ ] Проверка вместимости аудитории vs количество студентов в группе
- [ ] Визуализация занятости аудиторий
- [ ] Фильтрация аудиторий по вместимости при создании события
- [ ] Автоматическое предложение свободных аудиторий
- [ ] Интеграция с группами (FK вместо текстового поля)
