# План реализации системы архивации

Данный документ описывает план технической реализации архивации для Учебных программ и Учебных групп.

## 1. Архивация Учебных Программ (Courses)

### 1.1 База данных

- **Статус:** ✅ Готово
- Используется существующая миграция `048_course_archive_system`:
  - `is_archived` (boolean)
  - `archived_at` (datetime)
  - `archived_by` (user_id)

### 1.2 Backend API (`/api/courses`)

- [ ] **Обновить Repository (`courseRepository.ts`)**:
  - Добавить поле `isArchived` в интерфейс `CourseFilters`.
  - В функции `getCoursesPaginated` добавить условие `WHERE is_archived = ?`.
- [ ] **Обновить GET Endpoint (`index.get.ts`)**:
  - Принимать параметр `isArchived` из query string.
- [ ] **Создать Endpoint Архивации (`[id]/archive.put.ts`)**:
  - Метод: `PUT`
  - URL: `/api/courses/:id/archive`
  - Body: `{ isArchived: boolean }`
  - Логика:
    - Проверка прав (разрешить `ADMIN` и `MANAGER` (модератор)).
    - Установка флага, времени и автора.
    - Логирование действия.

### 1.3 Frontend (Страница Программ)

- [ ] **Добавить Табы ("Активные" / "Архив")**:
  - Аналогично странице Групп.
  - По умолчанию показывать активные.
  - При переключении запрашивать API с `isArchived=true/false`.
- [ ] **Управление архивацией**:
  - Добавить кнопку "В архив" (для активных) и "Восстановить" (для архивных) в карточку программы или список.
  - Доступно для Модераторов.

---

## 2. Ограничения на создание Групп

### 2.1 Backend (`/api/groups`)

- [ ] **Валидация при создании (`index.post.ts`)**:
  - Получить данные курса по `courseId`.
  - Если `course.isArchived === true`, вернуть ошибку `400 Bad Request` ("Нельзя создать группу по архивной программе").

---

## 3. Архивация Учебных Групп (Groups)

### 3.1 Логика блокировки (Frontend)

Все ограничения применяются, если `group.isArchived === true`.

#### Страница группы (`/groups/[id]`)

- [ ] **Управление**: Скрыть/Отключить кнопки:
  - "Редактировать" (свойства группы).
  - "Удалить" (оставить доступной только для Админа, если требуется).
- [ ] **Студенты**:
  - Скрыть кнопку "Управление слушателями".
  - Скрыть/Отключить кнопки добавления/удаления.
- [ ] **Документы**:
  - Скрыть кнопку "Загрузить документ".
- [ ] **Сертификаты**:
  - Отключить возможность генерации/выдачи новых сертификатов.
- [ ] **Дисциплины**:
  - Отключить редактирование оценок/явок в журналах (перевести в режим Read-only).

#### Календарь и Расписание

- [ ] **Компонент Календаря (`ScheduleCalendarView` или аналог)**:
  - Для событий архивной группы установить свойство `editable: false`.
  - Запретить Drag-and-Drop (изменение времени/даты).
  - При клике на слот — запретить создание занятия.
  - При клике на существующее занятие — открывать модальное окно только в режиме просмотра (Read-only).

---

## 4. Чек-лист для проверки (QA Checklist)

### Учебные программы (УП)

- [ ] **Архивация УП**:
  - [ ] Модератор может отправить УП в архив.
  - [ ] УП исчезает из вкладки "Активные" и появляется в "Архив".
  - [ ] Модератор может восстановить УП из архива.
- [ ] **Влияние на Группы**:
  - [ ] Попытка создать Группу по архивной УП -> Ошибка (на UI блокировка выбора или ошибка при сохранении).
  - [ ] Существующие группы архивной УП продолжают работать (если сами не в архиве).

### Учебные группы

- [ ] **Архивация Группы**:
  - [ ] Админ (или Модератор) может заархивировать группу.
  - [ ] Группа перемещается во вкладку "Архив".
- [ ] **Блокировка функций (в архивной группе)**:
  - [ ] Нет кнопки "Редактировать группу".
  - [ ] Нет кнопки "Управление слушателями".
  - [ ] Нет кнопки "Загрузить документ".
  - [ ] Нельзя изменить оценки или явки в журнале.
  - [ ] **Календарь**:
    - [ ] Нельзя перетащить занятие группы.
    - [ ] Нельзя изменить длительность занятия.
    - [ ] Нельзя создать новое занятие для этой группы.

### Ролевая модель

- [ ] **Модератор**:
  - [ ] Имеет доступ к редакции/архивации УП.
  - [ ] Видит архивные УП и Группы.
