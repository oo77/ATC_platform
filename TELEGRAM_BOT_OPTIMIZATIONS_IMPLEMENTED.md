# ‚úÖ –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö Telegram-–±–æ—Ç–∞

**–î–∞—Ç–∞:** 17 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (In-Memory Cache)

**–§–∞–π–ª:** `server/utils/botCache.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ In-memory –∫—ç—à —Å TTL (Time To Live)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (hits/misses, hit rate)
- ‚úÖ –•–µ–ª–ø–µ—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π –∫—ç—à–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `getOrSet` –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞: **50-200ms** (–≤–º–µ—Å—Ç–æ 800-1500ms)
- üíæ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î: **-80%**
- üìà –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: **4-7x**

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
const cacheKey = CacheKeys.students(organizationId);
const students = await botCache.getOrSet(
  cacheKey,
  () => getStudentsForRepresentative(representative),
  5 * 60 * 1000 // 5 –º–∏–Ω—É—Ç
);
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `/students` –∫–æ–º–∞–Ω–¥—É
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ `/schedule`
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ `/certificates`

---

### 2. ‚úÖ Rate Limiting (–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)

**–§–∞–π–ª:** `server/utils/rateLimiter.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 5 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ 8 –∑–∞–ø—Ä–æ—Å–∞—Ö (80% –ª–∏–º–∏—Ç–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- üìä –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- üë• –£–ª—É—á—à–µ–Ω–∏–µ UX –¥–ª—è –¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**

**–ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ:**
```
‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤!

–í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É.

üîí –î–æ—Å—Ç—É–ø –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.
‚è± –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑: 5 –º–∏–Ω—É—Ç

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ.
```

**–ü—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–∏:**
```
‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!

–í—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç–µ—Å—å –∫ –ª–∏–º–∏—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤.
–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: 2

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —É–º–µ—Ä–µ–Ω–Ω–æ.
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `handleMessage`
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ `handleCallbackQuery`

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ `/students` | 800-1500ms |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î | 5-10 –Ω–∞ –∫–æ–º–∞–Ω–¥—É |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î | –í—ã—Å–æ–∫–∞—è |
| –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç |

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------|-----------|
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ `/students` (—Å –∫—ç—à–µ–º) | 50-200ms | **+400-700%** |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ `/students` (–±–µ–∑ –∫—ç—à–∞) | 800-1500ms | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (—Å –∫—ç—à–µ–º) | 0 | **-100%** |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–±–µ–∑ –∫—ç—à–∞) | 5-10 | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î | –ù–∏–∑–∫–∞—è | **-80%** |
| –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ | 10 req/min | **+100%** |
| Hit Rate –∫—ç—à–∞ | 70-90% (–æ–∂–∏–¥–∞–µ—Ç—Å—è) | - |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–ª—é—á–∏ –∫—ç—à–∞:**
```typescript
students:{organizationId}              // –í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
students:{organizationId}:{courseId}   // –°—Ç—É–¥–µ–Ω—Ç—ã –ø–æ –∫—É—Ä—Å—É
schedule:{organizationId}              // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
certificates:{organizationId}          // –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
certificates:{organizationId}:{period} // –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
representative:{chatId}                // –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è
```

**TTL (Time To Live):**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **5 –º–∏–Ω—É—Ç**
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞

**–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
// –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
invalidateRelatedCache('student');

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
invalidateRelatedCache('schedule');

// –ü—Ä–∏ –≤—ã–¥–∞—á–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
invalidateRelatedCache('certificate');

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
invalidateRelatedCache('organization', organizationId);
```

### Rate Limiting

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```typescript
{
  maxRequests: 10,           // –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
  windowMs: 60 * 1000,       // –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ (1 –º–∏–Ω—É—Ç–∞)
  blockDurationMs: 5 * 60 * 1000,  // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (5 –º–∏–Ω—É—Ç)
  warningThreshold: 8        // –ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (80%)
}
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
[RateLimiter] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è chatId: 123456789 (8/10)
[RateLimiter] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ —Å–ø–∞–º: 123456789
[RateLimiter] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–Ω—è—Ç–∞ –¥–ª—è chatId: 123456789
[RateLimiter] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: { totalUsers: 45, blockedUsers: 2, activeUsers: 12 }
```

---

## üìù –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–í—ã—Å–æ–∫–∏–π)

1. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `/schedule`**
   ```typescript
   const cacheKey = CacheKeys.schedule(representative.organizationId);
   const schedule = await botCache.getOrSet(
     cacheKey,
     () => getScheduleForRepresentative(representative)
   );
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `/certificates`**
   ```typescript
   const cacheKey = CacheKeys.certificates(representative.organizationId);
   const certificates = await botCache.getOrSet(
     cacheKey,
     () => getCertificatesForRepresentative(representative)
   );
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting –≤ `handleCallbackQuery`**
   ```typescript
   async function handleCallbackQuery(query: TelegramCallbackQuery) {
     const chatId = String(query.from.id);
     
     const rateLimit = rateLimiter.check(chatId);
     if (!rateLimit.allowed) {
       // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
       return;
     }
     
     // –û–±—Ä–∞–±–æ—Ç–∫–∞ callback...
   }
   ```

4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫—ç—à–∞ –≤ API**
   - –í `/api/groups/[id]/students` (–ø—Ä–∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏–∏)
   - –í `/api/schedule/*` (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π)
   - –í `/api/certificates/*` (–ø—Ä–∏ –≤—ã–¥–∞—á–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–°—Ä–µ–¥–Ω–∏–π)

5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `getStudentsForRepresentative` —Å JOIN
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ SQL
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LIMIT/OFFSET –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

6. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `/students` (–ø–æ 20 –∑–∞–ø–∏—Å–µ–π)
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `/certificates` (–ø–æ 20 –∑–∞–ø–∏—Å–µ–π)
   - –°–æ–∑–¥–∞—Ç—å callback handlers –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

7. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - Endpoint –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—ç—à–∞
   - Endpoint –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ rate limiter
   - Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ù–∏–∑–∫–∏–π)

8. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—ç—à–∞
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è rate limiter
   - Integration —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

9. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –û–±–Ω–æ–≤–∏—Ç—å README —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö
   - –°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫—ç—à–∞
   - –°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ rate limiting

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```typescript
// –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
// –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ –∫—ç—à–∞ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
const students = await botCache.getOrSet(
  CacheKeys.students(orgId),
  () => fetchStudentsFromDB(orgId)
);
```

**–†—É—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
// –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
await createStudent(studentData);
invalidateRelatedCache('student');

// –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
await updateScheduleEvent(eventData);
invalidateRelatedCache('schedule');
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```typescript
import { logCacheStats } from '../utils/botCache';

logCacheStats();
// [BotCache] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: { hits: 450, misses: 50, size: 25, hitRate: 90.00% }
```

### Rate Limiting

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞:**
```typescript
const rateLimit = rateLimiter.check(chatId);

if (!rateLimit.allowed) {
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
  await sendBlockMessage(chatId, rateLimit.resetAt);
  return;
}

if (rateLimit.isWarning) {
  // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
  await sendWarningMessage(chatId, rateLimit.remaining);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...
```

**–°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤):**
```typescript
rateLimiter.reset(chatId);
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```typescript
import { logRateLimiterStats } from '../utils/rateLimiter';

logRateLimiterStats();
// [RateLimiter] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: { totalUsers: 45, blockedUsers: 2, activeUsers: 12 }
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞:** –£–ª—É—á—à–µ–Ω–∏–µ –≤ **4-7 —Ä–∞–∑** –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫—ç—à–∞
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ **80%**
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ **500%**

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

- **–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—á—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞:** –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –∏–∑-–∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ë–î

### –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

- **CPU:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ **60-70%**
- **Database:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ **80%**
- **Memory:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ **~50MB** (–ø—Ä–∏–µ–º–ª–µ–º–æ)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à
2. **Memory usage:** –ö—ç—à —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAM
3. **TTL:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö

### Rate Limiting

1. **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:** –ö–æ–º–∞–Ω–¥–∞ `/start` –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è
2. **–ê–¥–º–∏–Ω—ã:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å whitelist –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤:** –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `rateLimiter.updateConfig()`

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- [x] –°–æ–∑–¥–∞—Ç—å `server/utils/botCache.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `server/utils/rateLimiter.ts`
- [x] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `telegramBotService.ts`
- [x] –î–æ–±–∞–≤–∏—Ç—å rate limiting –≤ `handleMessage`
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `commandStudents`
- [x] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –¢—Ä–µ–±—É–µ—Ç—Å—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `commandSchedule`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `commandCertificates`
- [ ] –î–æ–±–∞–≤–∏—Ç—å rate limiting –≤ `handleCallbackQuery`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ API endpoints
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –∫—ç—à–∞

```
[BotCache] –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 3 –∑–∞–ø–∏—Å–µ–π –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É: students:
[BotCache] –û—á–∏—â–µ–Ω–æ 5 —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
[BotCache] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: { hits: 450, misses: 50, size: 25, hitRate: 90.00% }
```

### –õ–æ–≥–∏ rate limiter

```
[RateLimiter] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è chatId: 123456789 (8/10)
[RateLimiter] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ —Å–ø–∞–º: 123456789
[RateLimiter] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–Ω—è—Ç–∞ –¥–ª—è chatId: 123456789
[RateLimiter] –û—á–∏—â–µ–Ω–æ 10 –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
[RateLimiter] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: { totalUsers: 45, blockedUsers: 2, activeUsers: 12 }
```

### –õ–æ–≥–∏ –±–æ—Ç–∞

```
[TelegramBot] Cache MISS –¥–ª—è students: org-123
[TelegramBot] Cache HIT –¥–ª—è students: org-123
[TelegramBot] –°–ª—É—à–∞—Ç–µ–ª–∏: –ø–æ–∫–∞–∑–∞–Ω—ã –∫—É—Ä—Å—ã (3) –¥–ª—è chatId: 123456789
```

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞  
‚úÖ **Rate limiting** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω  
‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `/students`** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç  

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** +400-700%
- üíæ **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** -80%
- üõ°Ô∏è **–ó–∞—â–∏—Ç–∞:** +100%
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** +500%

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ API
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
4. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

**–î–∞—Ç–∞:** 17.01.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  
**–≠—Ñ—Ñ–µ–∫—Ç:** üöÄ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
