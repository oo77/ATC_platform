import{u as U}from"./DlZaGH1J.js";import{M as m,f as b}from"./GLV6bXvn.js";const g=[{id:1,periodNumber:1,startTime:"09:00",endTime:"09:40",isAfterBreak:!1,isActive:!0},{id:2,periodNumber:2,startTime:"09:40",endTime:"10:20",isAfterBreak:!1,isActive:!0},{id:3,periodNumber:3,startTime:"10:30",endTime:"11:10",isAfterBreak:!1,isActive:!0},{id:4,periodNumber:4,startTime:"11:10",endTime:"11:50",isAfterBreak:!1,isActive:!0},{id:5,periodNumber:5,startTime:"12:00",endTime:"12:40",isAfterBreak:!1,isActive:!0},{id:6,periodNumber:6,startTime:"12:40",endTime:"13:20",isAfterBreak:!1,isActive:!0},{id:7,periodNumber:7,startTime:"14:00",endTime:"14:40",isAfterBreak:!0,isActive:!0},{id:8,periodNumber:8,startTime:"14:40",endTime:"15:20",isAfterBreak:!1,isActive:!0},{id:9,periodNumber:9,startTime:"15:30",endTime:"16:10",isAfterBreak:!1,isActive:!0},{id:10,periodNumber:10,startTime:"16:10",endTime:"16:50",isAfterBreak:!1,isActive:!0},{id:11,periodNumber:11,startTime:"17:00",endTime:"17:40",isAfterBreak:!1,isActive:!0},{id:12,periodNumber:12,startTime:"17:40",endTime:"18:20",isAfterBreak:!1,isActive:!0}],k={lunch_break_start:"13:20",lunch_break_end:"14:00",period_duration_minutes:"40",academic_hour_minutes:"40",short_break_minutes:"10",snap_to_periods:"true",show_period_numbers:"true"},R=()=>{const{authFetch:f}=U(),r=m("schedule-periods",()=>[...g]),i=m("schedule-settings",()=>({...k})),n=m("schedule-settings-loading",()=>!1),p=m("schedule-settings-loaded",()=>!1),_=async()=>{if(p.value)return{periods:r.value,settings:i.value};n.value=!0;try{const e=await f("/api/schedule/settings");return e.success&&(r.value=e.periods,i.value=e.settings,p.value=!0),{periods:r.value,settings:i.value}}catch(e){return console.error("[useScheduleSettings] Ошибка загрузки настроек:",e),{periods:g,settings:k}}finally{n.value=!1}},P=async e=>{n.value=!0;try{const t=await f("/api/schedule/periods",{method:"PUT",body:{periods:e}});return t.success?(r.value=t.periods,!0):!1}catch(t){return console.error("[useScheduleSettings] Ошибка обновления периодов:",t),!1}finally{n.value=!1}},B=async e=>{n.value=!0;try{await f("/api/schedule/settings",{method:"PUT",body:{settings:e}});for(const t of e)i.value[t.key]=t.value;return!0}catch(t){return console.error("[useScheduleSettings] Ошибка обновления настроек:",t),!1}finally{n.value=!1}},y=b(()=>r.value.length===0?"09:00":r.value[0]?.startTime??"09:00"),M=b(()=>r.value.length===0?"18:20":r.value[r.value.length-1]?.endTime??"18:20"),N=e=>{const t=e.split(":").map(Number),s=t[0]??0,v=t[1]??0,d=s*60+v;for(const a of r.value){const u=a.startTime.split(":").map(Number),o=a.endTime.split(":").map(Number),l=u[0]??0,T=u[1]??0,h=o[0]??0,A=o[1]??0,c=l*60+T,D=h*60+A;if(d>=c&&d<D)return a}return null},S=e=>{if(r.value.length===0)return null;const t=e.split(":").map(Number),s=t[0]??0,v=t[1]??0,d=s*60+v;let a=null,u=1/0;for(const o of r.value){const l=o.startTime.split(":").map(Number),T=l[0]??0,h=l[1]??0,A=T*60+h,c=Math.abs(d-A);c<u&&(u=c,a=o)}return a},I=e=>{const t=r.value.find(s=>s.periodNumber===e);return t?t.startTime:null},L=e=>{const t=r.value.find(s=>s.periodNumber===e);return t?t.endTime:null},E=e=>{if(!(i.value.snap_to_periods==="true"))return e;const s=S(e);return s?s.startTime:e},F=e=>{if(!(i.value.snap_to_periods==="true"))return e;const s=N(e);return s?s.endTime:e},w=b(()=>r.value.map(e=>({time:e.startTime,label:`${e.periodNumber} пара`,isAfterBreak:e.isAfterBreak})));return{periods:r,settings:i,loading:n,loadSettings:_,updatePeriods:P,updateSettings:B,resetCache:()=>{p.value=!1,r.value=[...g],i.value={...k}},getFirstPeriodStart:y,getLastPeriodEnd:M,getSlotLabels:w,getPeriodByTime:N,getNearestPeriod:S,getPeriodStartTime:I,getPeriodEndTime:L,snapToNearestPeriodStart:E,snapToNearestPeriodEnd:F,isLunchBreakStart:e=>e===i.value.lunch_break_start,isAfterLunchBreak:e=>r.value.find(s=>s.startTime===e)?.isAfterBreak||!1}};export{R as u};
