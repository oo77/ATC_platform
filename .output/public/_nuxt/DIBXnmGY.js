import{_ as R}from"./BKg9m4wI.js";import{_ as Y}from"./BMofnORk.js";import{_ as K}from"./Bd-ycxNi.js";import{v as Q,s as W,r as d,f as D,g as X,c as n,a as t,b as c,w as v,x as u,h as _,d as m,A as f,n as C,t as l,D as Z,F as j,j as T,G as ee,z as te,o as i}from"./GLV6bXvn.js";import{u as re}from"./DlZaGH1J.js";import{u as se}from"./DVL-QcDc.js";import"./UFmxYCVi.js";import"./CyDLpZDf.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const oe={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},ae={class:"mb-6"},le={class:"flex items-center gap-3 mb-4"},ne={class:"rounded-lg bg-white dark:bg-boxdark p-6 shadow-md"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},de={class:"md:col-span-2"},ue={key:0,class:"mt-1 text-sm text-danger"},me={key:0,class:"mt-1 text-sm text-danger"},pe={key:0,class:"mt-1 text-sm text-danger"},ce=["value"],ve={class:"flex items-center gap-3"},fe={class:"flex items-center gap-3"},xe={class:"inline-flex items-center cursor-pointer"},ge={class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},ke={class:"md:col-span-2"},be={class:"rounded-lg bg-white dark:bg-boxdark p-6 shadow-md"},ye={class:"flex items-center justify-between mb-4"},he={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},we={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},_e={key:1,class:"space-y-3"},Ce={class:"flex items-center gap-3 flex-1"},Ne={class:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold text-sm"},Me={class:"flex-1"},He={class:"font-medium text-gray-900 dark:text-white"},Ve={class:"flex items-center gap-3 mt-1"},De={class:"text-xs text-gray-500 dark:text-gray-400"},je={class:"text-xs font-semibold text-primary"},Te={class:"flex items-center gap-2"},Se=["onClick"],Be=["onClick"],Ie={class:"flex items-center justify-end gap-4"},Je=Q({__name:"create",setup(Ue){const{authFetch:y}=re(),S=W(),h=d(!1),N=d([]),M=d([]),x=d(!1),p=d(null),g=d(void 0),s=d({name:"",shortName:"",code:"",description:"",certificateTemplateId:void 0,certificateValidityMonths:void 0,isActive:!0,disciplines:[]}),a=d({}),B=D(()=>s.value.disciplines.reduce((r,e)=>r+(e.theoryHours||0)+(e.practiceHours||0)+(e.assessmentHours||0),0)),I=r=>(r.theoryHours||0)+(r.practiceHours||0)+(r.assessmentHours||0),U=D(()=>M.value.map(r=>({id:r.id,label:r.fullName,description:r.email}))),{success:A,error:H}=se(),O=async()=>{try{const r=await y("/api/courses/templates");r.success&&(N.value=r.templates)}catch(r){console.error("Ошибка загрузки шаблонов сертификатов:",r)}},F=async()=>{try{const r=await y("/api/instructors/all");r.success&&(M.value=r.instructors)}catch(r){console.error("Ошибка загрузки инструкторов:",r)}},$=()=>{p.value=null,g.value=void 0,x.value=!0},L=r=>{p.value=r,g.value={...s.value.disciplines[r]},x.value=!0},V=()=>{x.value=!1,p.value=null,g.value=void 0},P=r=>{p.value!==null?s.value.disciplines[p.value]={...r,orderIndex:p.value}:s.value.disciplines.push({...r,orderIndex:s.value.disciplines.length}),V()},q=r=>{s.value.disciplines.splice(r,1),s.value.disciplines.forEach((e,k)=>{e.orderIndex=k})},z=()=>(a.value={},(!s.value.name||s.value.name.trim().length===0)&&(a.value.name="Название курса обязательно"),(!s.value.shortName||s.value.shortName.trim().length<2)&&(a.value.shortName="Короткое название должно быть от 2 до 10 символов"),(!s.value.code||s.value.code.trim().length===0)&&(a.value.code="Код курса обязателен"),Object.keys(a.value).length===0),E=async()=>{if(z()){h.value=!0;try{const r=await y("/api/courses",{method:"POST",body:JSON.stringify(s.value)});r.success?(A("Учебная программа успешно создана","Успех"),setTimeout(()=>{S.push("/programs")},1e3)):(r.field&&(a.value[r.field]=r.message),H(r.message||"Ошибка при создании учебной программы","Ошибка"))}catch(r){console.error("Ошибка создания учебной программы:",r);let e="Произошла ошибка при создании учебной программы";r.data?.message?e=r.data.message:r.message&&(e=r.message),r.data?.field&&(a.value[r.data.field]=r.data.message,e=`${r.data.field}: ${r.data.message}`),H(e,"Ошибка валидации")}finally{h.value=!1}}};return X(()=>{O(),F()}),(r,e)=>{const k=R,w=Y,G=K;return i(),n("div",oe,[t("div",ae,[t("div",le,[c(k,{to:"/programs",class:"flex items-center gap-2 text-gray-600 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors"},{default:v(()=>[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),m(" Назад к списку учебных программ ",-1)])]),_:1})]),e[9]||(e[9]=t("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Создание учебной программы ",-1)),e[10]||(e[10]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," Заполните информацию о курсе и добавьте дисциплины ",-1))]),t("form",{onSubmit:te(E,["prevent"]),class:"space-y-6"},[t("div",ne,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold text-black dark:text-white mb-4"}," Основная информация ",-1)),t("div",ie,[t("div",de,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" Название курса "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.name=o),type:"text",placeholder:"Например: Основы программирования на Python",class:C(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":a.value.name}]),required:""},null,2),[[f,s.value.name]]),a.value.name?(i(),n("p",ue,l(a.value.name),1)):_("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" Короткое название "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.shortName=o),type:"text",placeholder:"PYTHON",maxlength:"10",class:C(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary uppercase",{"border-danger":a.value.shortName}]),required:"",onInput:e[2]||(e[2]=o=>s.value.shortName=s.value.shortName.toUpperCase())},null,34),[[f,s.value.shortName]]),e[13]||(e[13]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"4-10 заглавных букв",-1)),a.value.shortName?(i(),n("p",me,l(a.value.shortName),1)):_("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" Код курса "),t("span",{class:"text-danger"},"*")],-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.code=o),type:"text",placeholder:"2400001",class:C(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":a.value.code}]),required:""},null,2),[[f,s.value.code]]),a.value.code?(i(),n("p",pe,l(a.value.code),1)):_("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Шаблон сертификата ",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.certificateTemplateId=o),class:"w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},[e[15]||(e[15]=t("option",{value:void 0},"Не выбран",-1)),(i(!0),n(j,null,T(N.value,o=>(i(),n("option",{key:o.id,value:o.id},l(o.name),9,ce))),128))],512),[[Z,s.value.certificateTemplateId]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок действия сертификата ",-1)),t("div",ve,[u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.certificateValidityMonths=o),type:"number",min:"1",max:"120",placeholder:"Не ограничен",class:"w-40 rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},null,512),[[f,s.value.certificateValidityMonths,void 0,{number:!0}]]),e[17]||(e[17]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"месяцев",-1))]),e[19]||(e[19]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Оставьте пустым для бессрочных сертификатов ",-1))]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),t("div",fe,[t("label",xe,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.isActive=o),type:"checkbox",class:"sr-only peer"},null,512),[[ee,s.value.isActive]]),e[20]||(e[20]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"},null,-1)),t("span",ge,l(s.value.isActive?"Активен":"Неактивен"),1)])])]),t("div",ke,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),u(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.description=o),rows:"4",placeholder:"Краткое описание курса...",class:"w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},null,512),[[f,s.value.description]])])])]),t("div",be,[t("div",ye,[t("div",null,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold text-black dark:text-white"}," Дисциплины курса ",-1)),t("p",he," Всего часов: "+l(B.value),1)]),c(w,{type:"button",onClick:$,class:"flex items-center gap-2"},{default:v(()=>[...e[25]||(e[25]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),m(" Добавить дисциплину ",-1)])]),_:1})]),s.value.disciplines.length===0?(i(),n("div",we,[...e[26]||(e[26]=[t("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1),t("p",null,"Дисциплины не добавлены",-1),t("p",{class:"text-sm mt-1"},'Нажмите "Добавить дисциплину" чтобы начать',-1)])])):(i(),n("div",_e,[(i(!0),n(j,null,T(s.value.disciplines,(o,b)=>(i(),n("div",{key:b,class:"flex items-center justify-between border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-primary/50 transition-colors"},[t("div",Ce,[t("div",Ne,l(b+1),1),t("div",Me,[t("h4",He,l(o.name),1),t("div",Ve,[t("span",De," Теория: "+l(o.theoryHours)+"ч | Практика: "+l(o.practiceHours)+"ч | Проверка: "+l(o.assessmentHours)+"ч ",1),t("span",je," Всего: "+l(I(o))+"ч ",1)])])]),t("div",Te,[t("button",{type:"button",onClick:J=>L(b),class:"p-2 text-gray-600 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors",title:"Редактировать"},[...e[27]||(e[27]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Se),t("button",{type:"button",onClick:J=>q(b),class:"p-2 text-danger hover:text-danger/80 transition-colors",title:"Удалить"},[...e[28]||(e[28]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Be)])]))),128))]))]),t("div",Ie,[c(k,{to:"/programs"},{default:v(()=>[c(w,{variant:"danger"},{default:v(()=>[...e[29]||(e[29]=[m(" Отмена ",-1)])]),_:1})]),_:1}),c(w,{type:"submit",variant:"success",loading:h.value},{default:v(()=>[...e[30]||(e[30]=[m(" Создать учебную программу ",-1)])]),_:1},8,["loading"])])],32),c(G,{"is-open":x.value,discipline:g.value,"instructor-options":U.value,onClose:V,onSave:P},null,8,["is-open","discipline","instructor-options"])])}}});export{Je as default};
