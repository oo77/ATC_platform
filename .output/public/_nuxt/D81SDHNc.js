import{v as D,r as f,f as v,g as F,c as a,a as t,x as O,h as C,D as A,t as o,m as w,d as _,b as M,w as $,_ as E,F as z,j as N,k as V,Z as U,o as s,n as Y}from"./GLV6bXvn.js";import{_ as R}from"./BMofnORk.js";import{u as L}from"./DlZaGH1J.js";const T={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark p-6"},W={class:"flex flex-col sm:flex-row items-center justify-between mb-6 gap-4"},P={class:"flex items-center gap-3 w-full sm:w-auto"},Z={key:0,class:"flex justify-center items-center py-20"},q={key:1,class:"text-center py-10"},G={class:"text-danger mb-3"},J={key:2,class:"space-y-8"},K={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Q={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},X={class:"text-2xl font-bold text-gray-900 dark:text-white"},tt={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},et={class:"text-2xl font-bold text-gray-900 dark:text-white"},rt={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},st={class:"text-2xl font-bold text-gray-900 dark:text-white"},ot={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800"},at={class:"text-2xl font-bold text-gray-900 dark:text-white"},nt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},lt={class:"lg:col-span-2 rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-gray-700 dark:bg-gray-800"},dt={class:"h-[300px]"},it={class:"rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-gray-700 dark:bg-gray-800"},ut={class:"h-[300px] flex items-center justify-center"},ct={class:"rounded-xl border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800 overflow-hidden"},xt={key:0,class:"overflow-x-auto"},gt={class:"w-full text-sm"},yt={class:"divide-y divide-gray-200 dark:divide-gray-700"},pt={class:"py-4 px-6 font-medium text-gray-900 dark:text-white"},mt={class:"py-4 px-6 text-right"},ht={class:"inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-success/10 text-success"},vt={class:"py-4 px-6 text-right"},bt={class:"inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-primary/10 text-primary"},ft={class:"py-4 px-6 text-right text-gray-600 dark:text-gray-400"},kt={class:"py-4 px-6 text-right font-medium text-gray-900 dark:text-white"},wt={key:1,class:"p-8 text-center bg-gray-50 dark:bg-gray-800/50"},_t={key:3,class:"flex flex-col items-center justify-center py-16 bg-gray-50 dark:bg-gray-800/30 rounded-lg border border-dashed border-gray-300 dark:border-gray-700"},Ct=D({__name:"HoursStats",props:{instructorId:{},initialLoad:{type:Boolean}},setup(H,{expose:j}){const y=H,{authFetch:B}=L(),n=f(null),p=f(!1),g=f(null),c=f("all"),m=async()=>{if(y.instructorId){p.value=!0,g.value=null;try{const r=await B(`/api/instructors/${y.instructorId}/hours`);r.success&&(n.value=r.stats)}catch(r){console.error("Error loading hours stats:",r),g.value="Не удалось загрузить статистику часов"}finally{p.value=!1}}},h=v(()=>{if(!n.value)return[];const r=[...n.value.byMonth].reverse();if(c.value==="all")return r;const e=new Date,k=e.getFullYear();if(c.value==="current_year")return r.filter(x=>x.year===k);if(c.value==="last_12_months"){const x=new Date;x.setMonth(e.getMonth()-12);const b=x.toISOString().slice(0,7);return r.filter(u=>u.yearMonth>=b)}return r}),l=v(()=>{const r=h.value,e=r.reduce((x,b)=>x+b.usedHours,0),k=r.reduce((x,b)=>x+b.scheduledHours,0);return{usedHours:Number(e.toFixed(1)),scheduledHours:Number(k.toFixed(1))}}),d=v(()=>({chart:{type:"bar",toolbar:{show:!1},fontFamily:"Inter, sans-serif"},colors:["#10B981","#3C50E0"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:4}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:h.value.map(r=>`${r.monthName} ${r.year}`),axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{title:{text:"Часы"}},fill:{opacity:1},tooltip:{y:{formatter:r=>r+" ч."}},legend:{position:"top",horizontalAlign:"left"},grid:{borderColor:"#e2e8f0",strokeDashArray:4}})),i=v(()=>[{name:"Отработано",data:h.value.map(r=>r.usedHours)},{name:"Запланировано",data:h.value.map(r=>r.scheduledHours)}]),S=v(()=>{const r=n.value;return r?{chart:{type:"donut"},labels:["Отработано","Запланировано","Осталось"],colors:["#10B981","#3C50E0","#FBBF24"],legend:{position:"bottom"},plotOptions:{pie:{donut:{size:"70%",labels:{show:!0,total:{show:!0,label:"Лимит",formatter:()=>r.maxHours+" ч."}}}}},dataLabels:{enabled:!1}}:{}}),I=v(()=>{const r=n.value;if(!r)return[];const e=Math.max(0,r.remainingHours);return[r.totalUsedHours,r.totalScheduledHours,e]});return F(()=>{y.initialLoad&&y.instructorId&&m()}),j({load:m,hasData:v(()=>!!n.value)}),(r,e)=>{const k=U("apexchart"),x=E,b=R;return s(),a("div",T,[t("div",W,[e[3]||(e[3]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Отчётность по часам ",-1)),t("div",P,[n.value?O((s(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=u=>c.value=u),class:"rounded-lg border border-gray-300 bg-white py-2 pl-3 pr-8 text-sm outline-none focus:border-primary dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 w-full sm:w-auto"},[...e[1]||(e[1]=[t("option",{value:"all"},"За все время",-1),t("option",{value:"current_year"},"Текущий год",-1),t("option",{value:"last_12_months"},"Последние 12 мес.",-1)])],512)),[[A,c.value]]):C("",!0),t("button",{onClick:m,class:"p-2 rounded-lg text-gray-500 hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Обновить данные"},[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])])]),p.value?(s(),a("div",Z,[...e[4]||(e[4]=[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"h-10 w-10 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"}),t("p",{class:"text-sm text-gray-500"},"Загрузка статистики...")],-1)])])):g.value?(s(),a("div",q,[e[5]||(e[5]=t("div",{class:"mx-auto mb-4 h-12 w-12 rounded-full bg-danger/10 flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-danger",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),t("path",{d:"M12 8v4m0 4h.01","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("p",G,o(g.value),1),t("button",{onClick:m,class:"text-sm text-primary hover:underline hover:text-primary-dark"}," Попробовать снова ")])):n.value?(s(),a("div",J,[t("div",K,[t("div",Q,[e[7]||(e[7]=w('<div class="flex items-center gap-3 mb-2"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-success/10"><svg class="h-5 w-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="text-sm font-medium text-gray-500 dark:text-gray-400">Отработано</span></div>',1)),t("p",X,[_(o(l.value.usedHours)+" ",1),e[6]||(e[6]=t("span",{class:"text-sm font-normal text-gray-500"},"ч.",-1))])]),t("div",tt,[e[9]||(e[9]=w('<div class="flex items-center gap-3 mb-2"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10"><svg class="h-5 w-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div><span class="text-sm font-medium text-gray-500 dark:text-gray-400">Запланировано</span></div>',1)),t("p",et,[_(o(l.value.scheduledHours)+" ",1),e[8]||(e[8]=t("span",{class:"text-sm font-normal text-gray-500"},"ч.",-1))])]),t("div",rt,[e[11]||(e[11]=w('<div class="flex items-center gap-3 mb-2"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-warning/10"><svg class="h-5 w-5 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span class="text-sm font-medium text-gray-500 dark:text-gray-400">Осталось</span></div>',1)),t("p",st,[_(o(n.value.remainingHours)+" ",1),e[10]||(e[10]=t("span",{class:"text-sm font-normal text-gray-500"},"ч.",-1))]),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 mt-1"},"от общего лимита",-1))]),t("div",ot,[e[14]||(e[14]=w('<div class="flex items-center gap-3 mb-2"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-gray-200 dark:bg-gray-700"><svg class="h-5 w-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><span class="text-sm font-medium text-gray-500 dark:text-gray-400">Лимит</span></div>',1)),t("p",at,[_(o(n.value.maxHours)+" ",1),e[13]||(e[13]=t("span",{class:"text-sm font-normal text-gray-500"},"ч.",-1))])])]),t("div",nt,[t("div",lt,[e[15]||(e[15]=t("h4",{class:"mb-4 text-lg font-semibold text-gray-900 dark:text-white"}," Динамика часов по месяцам ",-1)),t("div",dt,[M(x,null,{default:$(()=>[d.value&&i.value?(s(),V(k,{key:0,type:"bar",height:"100%",options:d.value,series:i.value},null,8,["options","series"])):C("",!0)]),_:1})])]),t("div",it,[e[16]||(e[16]=t("h4",{class:"mb-4 text-lg font-semibold text-gray-900 dark:text-white"}," Использование лимита ",-1)),t("div",ut,[M(x,null,{default:$(()=>[S.value&&I.value?(s(),V(k,{key:0,type:"donut",width:"100%",options:S.value,series:I.value},null,8,["options","series"])):C("",!0)]),_:1})])])]),t("div",ct,[e[19]||(e[19]=t("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[t("h4",{class:"font-semibold text-gray-900 dark:text-white"}," Детальная разбивка ")],-1)),h.value.length>0?(s(),a("div",xt,[t("table",gt,[e[17]||(e[17]=t("thead",null,[t("tr",{class:"bg-gray-50 dark:bg-gray-700/50"},[t("th",{class:"py-3 px-6 text-left font-medium text-gray-600 dark:text-gray-400"}," Месяц "),t("th",{class:"py-3 px-6 text-right font-medium text-gray-600 dark:text-gray-400"}," Отработано "),t("th",{class:"py-3 px-6 text-right font-medium text-gray-600 dark:text-gray-400"}," Запланировано "),t("th",{class:"py-3 px-6 text-right font-medium text-gray-600 dark:text-gray-400"}," Всего занятий "),t("th",{class:"py-3 px-6 text-right font-medium text-gray-600 dark:text-gray-400"}," Академ. часы ")])],-1)),t("tbody",yt,[(s(!0),a(z,null,N(h.value,u=>(s(),a("tr",{key:u.yearMonth,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",pt,o(u.monthName)+" "+o(u.year),1),t("td",mt,[t("span",ht,o(u.usedHours)+" ч. ",1)]),t("td",vt,[t("span",bt,o(u.scheduledHours)+" ч. ",1)]),t("td",ft,o(u.eventCount),1),t("td",kt,o((u.usedHours+u.scheduledHours).toFixed(1)),1)]))),128))])])])):(s(),a("div",wt,[...e[18]||(e[18]=[t("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-700 mb-3"},[t("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Нет данных за выбранный период ",-1)])]))])])):(s(),a("div",_t,[e[21]||(e[21]=w('<div class="h-16 w-16 rounded-full bg-primary/5 dark:bg-primary/20 flex items-center justify-center mb-4"><svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2"> Статистика часов не загружена </h4><p class="text-sm text-gray-500 dark:text-gray-400 mb-6 max-w-sm text-center"> Нажмите кнопку ниже, чтобы загрузить подробный отчет о часах, включая графики и разбивку по месяцам. </p>',3)),M(b,{variant:"primary",onClick:m},{default:$(()=>[...e[20]||(e[20]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),_(" Загрузить статистику ",-1)])]),_:1})]))])}}}),Tt=Object.assign(Ct,{__name:"InstructorsHoursStats"}),Ht={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark p-6"},jt={class:"flex items-center justify-between mb-4"},Bt={key:0,class:"flex justify-center items-center py-8"},Mt={key:1,class:"text-center py-6"},$t={class:"text-danger mb-3"},St={key:2},It={class:"overflow-x-auto"},Vt={class:"w-full text-sm"},Dt={class:"py-2 px-3 font-medium text-gray-900 dark:text-white"},Ft={class:"py-2 px-3 text-gray-600 dark:text-gray-400"},zt={class:"py-2 px-3 text-gray-600 dark:text-gray-400"},Nt={class:"py-2 px-3 text-right"},Lt={class:"font-medium"},Ot={class:"py-2 px-3 text-center"},At={key:3,class:"text-center py-8"},Et=D({__name:"CourseHistory",props:{instructorId:{},initialLoad:{type:Boolean}},setup(H,{expose:j}){const y=H,{authFetch:B}=L(),n=f([]),p=f(!1),g=f(null),c=async()=>{if(y.instructorId){p.value=!0,g.value=null;try{const l=await B(`/api/instructors/${y.instructorId}/course-history`);l.success&&(n.value=l.history)}catch(l){console.error("Error loading course history:",l),g.value="Не удалось загрузить историю курсов"}finally{p.value=!1}}},m=l=>l?new Date(l).toLocaleDateString("ru-RU"):"-",h=l=>({active:"Активен",completed:"Завершен",upcoming:"Скоро",archived:"В архиве"})[l]||l;return F(()=>{y.initialLoad&&y.instructorId&&c()}),j({load:c,hasData:v(()=>n.value.length>0)}),(l,d)=>(s(),a("div",Ht,[t("div",jt,[d[0]||(d[0]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," История курсов ",-1)),n.value.length===0&&!p.value&&!g.value?(s(),a("button",{key:0,onClick:c,class:"text-sm text-primary hover:underline"}," Загрузить историю ")):C("",!0)]),p.value?(s(),a("div",Bt,[...d[1]||(d[1]=[t("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"},null,-1)])])):g.value?(s(),a("div",Mt,[t("p",$t,o(g.value),1),t("button",{onClick:c,class:"text-sm text-primary hover:underline"}," Попробовать снова ")])):n.value&&n.value.length>0?(s(),a("div",St,[t("div",It,[t("table",Vt,[d[2]||(d[2]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[t("th",{class:"py-2 px-3 text-left font-medium text-gray-600 dark:text-gray-400"}," Курс "),t("th",{class:"py-2 px-3 text-left font-medium text-gray-600 dark:text-gray-400"}," Группа "),t("th",{class:"py-2 px-3 text-left font-medium text-gray-600 dark:text-gray-400"}," Период "),t("th",{class:"py-2 px-3 text-right font-medium text-gray-600 dark:text-gray-400"}," Отработано "),t("th",{class:"py-2 px-3 text-center font-medium text-gray-600 dark:text-gray-400"}," Статус ")])],-1)),t("tbody",null,[(s(!0),a(z,null,N(n.value,i=>(s(),a("tr",{key:i.id,class:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50"},[t("td",Dt,o(i.name),1),t("td",Ft,o(i.groupName),1),t("td",zt,o(m(i.startDate))+" - "+o(m(i.endDate)),1),t("td",Nt,[t("span",Lt,o(i.hoursWorked)+" ч.",1)]),t("td",Ot,[t("span",{class:Y(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",{"bg-success/10 text-success":i.status==="completed","bg-primary/10 text-primary":i.status==="active","bg-warning/10 text-warning":i.status==="upcoming"}])},o(h(i.status)),3)])]))),128))])])])])):(s(),a("div",At,[d[3]||(d[3]=t("div",{class:"mx-auto mb-4 h-16 w-16 rounded-full bg-gray-100 dark:bg-meta-4 flex items-center justify-center"},[t("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})])],-1)),d[4]||(d[4]=t("p",{class:"text-gray-600 dark:text-gray-400 mb-3"}," История курсов пуста или не загружена ",-1)),t("button",{onClick:c,class:"inline-flex items-center justify-center rounded bg-primary py-2 px-6 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-10"}," Загрузить историю ")]))]))}}),Wt=Object.assign(Et,{__name:"InstructorsCourseHistory"});export{Tt as I,Wt as a};
