import{R as M,b as B}from"./DVCvjknM.js";import{u as A}from"./DlZaGH1J.js";import{v as S,r as p,g as E,q as $,c as n,a as t,h as c,i as r,d as y,n as m,t as o,F as D,j as H,o as d}from"./GLV6bXvn.js";import{u as L}from"./DVL-QcDc.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const U={class:"container mx-auto px-4 py-6"},N={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},F=["disabled"],P={key:0,class:"grid grid-cols-2 sm:grid-cols-5 gap-4 mb-6"},V={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700"},z={class:"text-2xl font-bold text-gray-900 dark:text-white"},O={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-red-200 dark:border-red-800"},Q={class:"text-2xl font-bold text-red-600"},I={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-yellow-200 dark:border-yellow-800"},G={class:"text-2xl font-bold text-yellow-600"},J={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-green-200 dark:border-green-800"},K={class:"text-2xl font-bold text-green-600"},W={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-purple-200 dark:border-purple-800"},X={class:"text-2xl font-bold text-purple-600"},Y={class:"flex gap-2 mb-6"},Z={key:1,class:"flex justify-center py-12"},q={key:2,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center"},tt={class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},et={class:"text-gray-500 dark:text-gray-400"},st={key:3,class:"space-y-4"},rt={class:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4"},ot={class:"flex-1"},at={class:"flex items-start gap-4"},nt={class:"flex-1 min-w-0"},dt={class:"text-lg font-semibold text-gray-900 dark:text-white"},it={class:"text-sm text-gray-500 dark:text-gray-400"},lt={class:"mt-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg"},gt={class:"font-medium text-gray-900 dark:text-white"},ct={class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},mt={key:0,class:"ml-2"},ut={class:"mt-3"},xt={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},pt={class:"flex items-center gap-2"},yt={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},bt={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-2"},kt={key:0,class:"flex gap-2 lg:flex-col"},ft=["onClick","disabled"],ht={key:0,class:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wt=["onClick","disabled"],At=S({__name:"attendance-requests",setup(_t){const{authFetch:b}=A(),{success:C,error:f}=L(),u=p(!0),h=p([]),i=p(null),l=p("pending"),g=p(null);async function x(){u.value=!0;try{const[a,e]=await Promise.all([b("/api/attendance/marking/requests",{params:{onlyPending:l.value==="pending"?"true":void 0}}),b("/api/attendance/marking/overdue")]);a.success&&(h.value=a.requests),e.success&&(i.value=e.statistics)}catch(a){console.error("Error loading data:",a),f("Ошибка загрузки данных")}finally{u.value=!1}}async function j(a){g.value=a.id;try{(await b(`/api/attendance/marking/requests/${a.id}`,{method:"PUT",body:{approved:!0}})).success&&(C("Запрос одобрен. Инструктор может отметить посещаемость"),await x())}catch(e){f(e.data?.message||"Ошибка при одобрении запроса")}finally{g.value=null}}async function T(a){const e=prompt("Укажите причину отклонения (опционально):");if(e!==null){g.value=a.id;try{(await b(`/api/attendance/marking/requests/${a.id}`,{method:"PUT",body:{approved:!1,comment:e}})).success&&(C("Запрос отклонён"),await x())}catch(s){f(s.data?.message||"Ошибка при отклонении запроса")}finally{g.value=null}}}function v(a){return a?new Date(a).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function R(a){const e=new Date(a),w=new Date().getTime()-e.getTime(),k=Math.floor(w/(1e3*60*60));if(k<1)return"Только что";if(k<24)return`${k}ч назад`;const _=Math.floor(k/24);return _===1?"Вчера":_<7?`${_}д назад`:v(a)}return E(()=>{x()}),$(l,()=>{x()}),(a,e)=>(d(),n("div",U,[t("div",N,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Запросы на отметку посещаемости "),t("p",{class:"text-gray-500 dark:text-gray-400 mt-1"}," Одобрение просроченных отметок от инструкторов ")],-1)),t("button",{onClick:x,disabled:r(u),class:"mt-4 sm:mt-0 inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[(d(),n("svg",{class:m(["w-4 h-4",{"animate-spin":r(u)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[2]||(e[2]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),e[3]||(e[3]=y(" Обновить ",-1))],8,F)]),r(i)?(d(),n("div",P,[t("div",V,[t("p",z,o(r(i).pending),1),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Ожидают отметки",-1))]),t("div",O,[t("p",Q,o(r(i).overdue),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Просрочено",-1))]),t("div",I,[t("p",G,o(r(i).late),1),e[7]||(e[7]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"С опозданием",-1))]),t("div",J,[t("p",K,o(r(i).onTime),1),e[8]||(e[8]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Вовремя",-1))]),t("div",W,[t("p",X,o(r(i).pendingRequests),1),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Ожидают одобрения",-1))])])):c("",!0),t("div",Y,[t("button",{onClick:e[0]||(e[0]=s=>l.value="pending"),class:m([r(l)==="pending"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300","px-4 py-2 rounded-lg text-sm font-medium border border-gray-200 dark:border-gray-700 transition-colors"])},[e[10]||(e[10]=y(" Ожидающие ",-1)),r(i)&&r(i).pendingRequests>0?(d(),n("span",{key:0,class:m(["ml-1 px-1.5 py-0.5 text-xs rounded-full",r(l)==="pending"?"bg-white/20":"bg-red-100 text-red-600"])},o(r(i).pendingRequests),3)):c("",!0)],2),t("button",{onClick:e[1]||(e[1]=s=>l.value="all"),class:m([r(l)==="all"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300","px-4 py-2 rounded-lg text-sm font-medium border border-gray-200 dark:border-gray-700 transition-colors"])}," Все запросы ",2)]),r(u)?(d(),n("div",Z,[...e[11]||(e[11]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600"},null,-1)])])):r(h).length===0?(d(),n("div",q,[e[12]||(e[12]=t("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1)),t("p",tt,o(r(l)==="pending"?"Нет ожидающих запросов":"Запросов не найдено"),1),t("p",et,o(r(l)==="pending"?"Все запросы на отметку рассмотрены":"Инструкторы ещё не отправляли запросов"),1)])):(d(),n("div",st,[(d(!0),n(D,null,H(r(h),s=>(d(),n("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},[t("div",rt,[t("div",ot,[t("div",at,[e[14]||(e[14]=t("div",{class:"shrink-0 w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),t("div",nt,[t("h3",dt,o(s.instructor?.fullName||"Инструктор"),1),t("p",it,o(R(s.createdAt)),1),t("div",lt,[t("p",gt,o(s.event?.title||"Занятие"),1),t("p",ct,[y(o(v(s.event?.endTime??null))+" ",1),s.event?.groupCode?(d(),n("span",mt," • "+o(s.event.groupCode),1)):c("",!0)])]),t("div",ut,[e[13]||(e[13]=t("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Причина:",-1)),t("p",xt,o(s.reason),1)]),s.status!=="pending"?(d(),n("div",{key:0,class:m(["mt-3 p-3 rounded-lg",s.status==="approved"?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"])},[t("div",pt,[t("span",{class:m([r(M)[s.status],"px-2 py-1 text-xs font-medium rounded-full"])},o(r(B)[s.status]),3),s.reviewer?(d(),n("span",yt,o(s.reviewer.fullName)+" • "+o(v(s.reviewedAt)),1)):c("",!0)]),s.reviewComment?(d(),n("p",bt,o(s.reviewComment),1)):c("",!0)],2)):c("",!0)])])]),s.status==="pending"?(d(),n("div",kt,[t("button",{onClick:w=>j(s),disabled:r(g)===s.id,class:"flex-1 lg:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white text-sm font-medium rounded-lg transition-colors"},[r(g)===s.id?(d(),n("svg",ht,[...e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(d(),n("svg",vt,[...e[16]||(e[16]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),e[17]||(e[17]=y(" Одобрить ",-1))],8,ft),t("button",{onClick:w=>T(s),disabled:r(g)===s.id,class:"flex-1 lg:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-400 text-white text-sm font-medium rounded-lg transition-colors"},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),y(" Отклонить ",-1)])],8,wt)])):c("",!0)])]))),128))]))]))}});export{At as default};
