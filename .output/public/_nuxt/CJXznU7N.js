import{_ as U}from"./DV0XJymg.js";import{r as c,v as _,f as V,g as F,c as y,a as t,h as f,d as G,x as b,A as R,D as C,m as O,k as M,i,F as B,j as K,t as p,n as z,o as u}from"./GLV6bXvn.js";import{u as j}from"./DlZaGH1J.js";import{u as W}from"./DVL-QcDc.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";function J(){const{authFetch:S}=j(),E=W(),g=c([]),m=c(!1),T=c(0),l=c(1),d=c(10),v=c(0),k=async(a={})=>{m.value=!0;try{const n=new URLSearchParams;a.userId&&n.append("userId",a.userId),a.actionType&&n.append("actionType",a.actionType),a.entityType&&n.append("entityType",a.entityType),a.startDate&&n.append("startDate",a.startDate),a.endDate&&n.append("endDate",a.endDate),n.append("page",String(a.page||l.value)),n.append("limit",String(a.limit||d.value));const s=await S(`/api/activity-logs?${n.toString()}`);if(s.success)g.value=s.data,T.value=s.total,l.value=s.page,d.value=s.limit,v.value=s.totalPages;else throw new Error("Не удалось загрузить журнал действий")}catch(n){console.error("Ошибка загрузки журнала действий:",n),E.error(n.message||"Не удалось загрузить журнал действий")}finally{m.value=!1}};return{logs:g,loading:m,total:T,currentPage:l,pageSize:d,totalPages:v,fetchActivityLogs:k,changePage:async(a,n={})=>{l.value=a,await k({...n,page:a})},changePageSize:async(a,n={})=>{d.value=a,l.value=1,await k({...n,limit:a,page:1})},formatDateTime:a=>{const n=new Date(a);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(n)},getActionTypeLabel:a=>({CREATE:"Создание",UPDATE:"Обновление",DELETE:"Удаление",VIEW:"Просмотр",LOGIN:"Вход",LOGOUT:"Выход",IMPORT:"Импорт",EXPORT:"Экспорт",APPROVE:"Одобрение",REJECT:"Отклонение",BLOCK:"Блокировка",UNBLOCK:"Разблокировка",REVOKE:"Отзыв",ISSUE:"Выдача",RESET_PASSWORD:"Сброс пароля",ASSIGN:"Назначение",UNASSIGN:"Снятие назначения"})[a]||a,getEntityTypeLabel:a=>({USER:"Пользователь",STUDENT:"Студент",CERTIFICATE:"Сертификат",CERTIFICATE_TEMPLATE:"Шаблон сертификата",ISSUED_CERTIFICATE:"Выданный сертификат",COURSE:"Курс",DISCIPLINE:"Дисциплина",INSTRUCTOR:"Инструктор",FILE:"Файл",FOLDER:"Папка",SCHEDULE:"Занятие",GROUP:"Группа",CLASSROOM:"Аудитория",ORGANIZATION:"Организация",REPRESENTATIVE:"Представитель",ATTENDANCE:"Посещаемость",GRADE:"Оценка",SYSTEM:"Система"})[a]||a,getActionTypeColor:a=>({CREATE:"text-green-600 dark:text-green-400",UPDATE:"text-blue-600 dark:text-blue-400",DELETE:"text-red-600 dark:text-red-400",VIEW:"text-gray-600 dark:text-gray-400",LOGIN:"text-purple-600 dark:text-purple-400",LOGOUT:"text-gray-600 dark:text-gray-400",IMPORT:"text-indigo-600 dark:text-indigo-400",EXPORT:"text-indigo-600 dark:text-indigo-400",APPROVE:"text-green-600 dark:text-green-400",REJECT:"text-red-600 dark:text-red-400",BLOCK:"text-red-600 dark:text-red-400",UNBLOCK:"text-green-600 dark:text-green-400",REVOKE:"text-orange-600 dark:text-orange-400",ISSUE:"text-green-600 dark:text-green-400",RESET_PASSWORD:"text-yellow-600 dark:text-yellow-400",ASSIGN:"text-blue-600 dark:text-blue-400",UNASSIGN:"text-gray-600 dark:text-gray-400"})[a]||"text-gray-600 dark:text-gray-400"}}const X={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},H={class:"flex flex-col gap-6"},Y={class:"bg-white dark:bg-boxdark rounded-xl shadow-md p-6"},Z={class:"flex items-center gap-3 mb-4"},$={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},q={class:"bg-white dark:bg-boxdark rounded-xl shadow-md overflow-hidden"},Q={class:"overflow-x-auto"},tt={class:"w-full table-auto"},et={key:0},at={key:1},ot={class:"py-4 px-4 text-sm pl-6"},nt={class:"text-black dark:text-white"},rt={class:"py-4 px-4"},it={class:"flex flex-col"},st={class:"text-sm font-medium text-black dark:text-white"},lt={class:"text-xs text-gray-600 dark:text-gray-400"},dt={class:"py-4 px-4"},pt={class:"py-4 px-4 text-sm text-black dark:text-white"},ut={class:"py-4 px-4 text-sm text-black dark:text-white"},ct={class:"py-4 px-4 text-sm text-gray-600 dark:text-gray-400"},Et=_({__name:"index",setup(S){const{logs:E,loading:g,total:m,currentPage:T,pageSize:l,totalPages:d,fetchActivityLogs:v,changePage:k,changePageSize:h,formatDateTime:D,getActionTypeLabel:A,getEntityTypeLabel:w,getActionTypeColor:I}=J(),o=c({actionType:"",entityType:"",startDate:"",endDate:""}),a=V(()=>o.value.actionType!==""||o.value.entityType!==""||o.value.startDate!==""||o.value.endDate!==""),n=async()=>{await v({actionType:o.value.actionType||void 0,entityType:o.value.entityType||void 0,startDate:o.value.startDate||void 0,endDate:o.value.endDate||void 0,page:1})},s=async()=>{o.value={actionType:"",entityType:"",startDate:"",endDate:""},await n()},P=async x=>{await k(x,{actionType:o.value.actionType||void 0,entityType:o.value.entityType||void 0,startDate:o.value.startDate||void 0,endDate:o.value.endDate||void 0})},L=async x=>{await h(x,{actionType:o.value.actionType||void 0,entityType:o.value.entityType||void 0,startDate:o.value.startDate||void 0,endDate:o.value.endDate||void 0})};return F(async()=>{console.log("Activity Logs Page Mounted");try{await v()}catch(x){console.error("Error fetching logs inside onMounted:",x)}}),(x,e)=>{const N=U;return u(),y("div",X,[e[16]||(e[16]=t("div",{class:"mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},[t("div",null,[t("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Журнал действий "),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"}," История всех действий пользователей в системе ")])],-1)),t("div",H,[t("div",Y,[t("div",Z,[e[5]||(e[5]=t("div",{class:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})])],-1)),e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-black dark:text-white"}," Фильтры ",-1)),a.value?(u(),y("button",{key:0,onClick:s,class:"ml-auto text-sm text-primary hover:text-primary/80 transition-colors flex items-center gap-1"},[...e[4]||(e[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),G(" Сбросить фильтры ",-1)])])):f("",!0)]),t("div",$,[t("div",null,[e[7]||(e[7]=t("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"}," Дата начала ",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.startDate=r),onChange:n,type:"date",class:"w-full rounded-lg border border-stroke bg-transparent py-2 px-4 outline-none focus:border-primary dark:border-strokedark dark:bg-meta-4 dark:focus:border-primary"},null,544),[[R,o.value.startDate]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"}," Дата окончания ",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.endDate=r),onChange:n,type:"date",class:"w-full rounded-lg border border-stroke bg-transparent py-2 px-4 outline-none focus:border-primary dark:border-strokedark dark:bg-meta-4 dark:focus:border-primary"},null,544),[[R,o.value.endDate]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"}," Тип действия ",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.actionType=r),onChange:n,class:"w-full rounded-lg border border-stroke bg-transparent py-2 px-4 outline-none focus:border-primary dark:border-strokedark dark:bg-meta-4 dark:focus:border-primary"},[...e[9]||(e[9]=[O('<option value="">Все действия</option><option value="CREATE">Создание</option><option value="UPDATE">Обновление</option><option value="DELETE">Удаление</option><option value="VIEW">Просмотр</option><option value="LOGIN">Вход</option><option value="LOGOUT">Выход</option><option value="IMPORT">Импорт</option><option value="EXPORT">Экспорт</option><option value="APPROVE">Одобрение</option><option value="REJECT">Отклонение</option><option value="BLOCK">Блокировка</option><option value="UNBLOCK">Разблокировка</option><option value="REVOKE">Отзыв</option><option value="ISSUE">Выдача</option><option value="RESET_PASSWORD">Сброс пароля</option><option value="ASSIGN">Назначение</option><option value="UNASSIGN">Снятие назначения</option>',18)])],544),[[C,o.value.actionType]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"}," Тип сущности ",-1)),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.entityType=r),onChange:n,class:"w-full rounded-lg border border-stroke bg-transparent py-2 px-4 outline-none focus:border-primary dark:border-strokedark dark:bg-meta-4 dark:focus:border-primary"},[...e[11]||(e[11]=[O('<option value="">Все сущности</option><option value="USER">Пользователь</option><option value="STUDENT">Студент</option><option value="CERTIFICATE">Сертификат</option><option value="CERTIFICATE_TEMPLATE">Шаблон сертификата</option><option value="ISSUED_CERTIFICATE">Выданный сертификат</option><option value="COURSE">Курс</option><option value="DISCIPLINE">Дисциплина</option><option value="INSTRUCTOR">Инструктор</option><option value="FILE">Файл</option><option value="FOLDER">Папка</option><option value="SCHEDULE">Занятие</option><option value="GROUP">Группа</option><option value="CLASSROOM">Аудитория</option><option value="ORGANIZATION">Организация</option><option value="REPRESENTATIVE">Представитель</option><option value="ATTENDANCE">Посещаемость</option><option value="GRADE">Оценка</option><option value="SYSTEM">Система</option>',19)])],544),[[C,o.value.entityType]])])])]),t("div",q,[t("div",Q,[t("table",tt,[e[15]||(e[15]=t("thead",null,[t("tr",{class:"bg-gray-2 text-left dark:bg-meta-4"},[t("th",{class:"py-4 px-4 font-medium text-black dark:text-white pl-6"}," Дата и время "),t("th",{class:"py-4 px-4 font-medium text-black dark:text-white"}," Пользователь "),t("th",{class:"py-4 px-4 font-medium text-black dark:text-white"}," Действие "),t("th",{class:"py-4 px-4 font-medium text-black dark:text-white"}," Сущность "),t("th",{class:"py-4 px-4 font-medium text-black dark:text-white"}," Название "),t("th",{class:"py-4 px-4 font-medium text-black dark:text-white"}," IP адрес ")])],-1)),t("tbody",null,[i(g)?(u(),y("tr",et,[...e[13]||(e[13]=[t("td",{colspan:"6",class:"text-center py-12"},[t("div",{class:"flex justify-center items-center"},[t("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"}),t("span",{class:"ml-3 text-gray-600 dark:text-gray-400"},"Загрузка...")])],-1)])])):i(E).length===0?(u(),y("tr",at,[...e[14]||(e[14]=[t("td",{colspan:"6",class:"text-center py-12"},[t("p",{class:"text-gray-600 dark:text-gray-400"}," Нет записей для отображения ")],-1)])])):f("",!0),(u(!0),y(B,null,K(i(E),r=>(u(),y("tr",{key:r.id,class:"border-b border-stroke dark:border-strokedark hover:bg-gray-50 dark:hover:bg-meta-4 transition"},[t("td",ot,[t("span",nt,p(i(D)(r.createdAt)),1)]),t("td",rt,[t("div",it,[t("span",st,p(r.userName||"Неизвестно"),1),t("span",lt,p(r.userEmail||r.userId),1)])]),t("td",dt,[t("span",{class:z(["inline-flex rounded-full bg-opacity-10 py-1 px-3 text-sm font-medium",i(I)(r.actionType)])},p(i(A)(r.actionType)),3)]),t("td",pt,p(i(w)(r.entityType)),1),t("td",ut,p(r.entityName||"—"),1),t("td",ct,p(r.ipAddress||"—"),1)]))),128))])])]),i(d)>0?(u(),M(N,{key:0,"current-page":i(T),"total-pages":i(d),total:i(m),limit:i(l),loading:i(g),"limit-options":[10,50,100],"onUpdate:page":P,"onUpdate:limit":L},null,8,["current-page","total-pages","total","limit","loading"])):f("",!0)])])])}}});export{Et as default};
