import{v as le,r as l,q as A,f as re,g as ne,L as ie,c as i,a as e,h as w,t as p,n as k,l as ue,z as B,x as U,A as V,d as N,Y as de,X as ce,W as ve,o as u}from"./GLV6bXvn.js";import{u as ge}from"./DVL-QcDc.js";import{_ as pe}from"./DlAUqK2U.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const me={class:"fixed inset-0 bg-gray-900 flex flex-col"},be={class:"flex items-center gap-4"},he={class:"min-w-0"},ye={class:"text-white font-semibold truncate"},fe={class:"text-sm text-gray-400 truncate"},xe={class:"flex items-center gap-2"},we=["title"],ke={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_e={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Me={key:0,class:"absolute inset-0 flex items-center justify-center z-20"},Ce=["src","alt"],je={key:2,class:"absolute inset-0 flex items-center justify-center bg-gray-900 z-20"},Pe={class:"text-center max-w-md px-4"},Be={class:"text-gray-400 mb-4"},$e={key:3,class:"absolute bottom-6 right-6 flex flex-col gap-2 z-10"},Le=["disabled"],ze=["disabled"],Te={class:"mb-3"},Ee={class:"flex items-center justify-between text-sm text-gray-400 mb-2"},Re={class:"relative"},Se=["max"],Ie={class:"flex items-center justify-center gap-2"},Ae=["disabled"],Ue={class:"flex items-center gap-2 px-4"},Ve=["max"],Ne=["disabled"],O=.5,F=5,Oe=le({__name:"[id]",setup(Fe){const b=ce(),$=ve(),X=ge(),m=l(!0),y=l(""),a=l(null),s=l(1),d=l(1),c=l(""),L=l(null),n=l(!1),z=l(!0),Y=l(null),r=l(1),f=l(0),v=l({x:0,y:0}),x=l(!1),_=l({x:0,y:0});let M,K;const H=o=>{if(o.ctrlKey){const t=o.deltaY>0?-.1:.1,g=Math.min(Math.max(O,r.value+t),F);r.value=Number(g.toFixed(2))}else r.value>1&&(v.value.y-=o.deltaY,v.value.x-=o.deltaX)},W=()=>{r.value=Math.min(F,r.value+.5)},q=()=>{r.value=Math.max(O,r.value-.5)},D=()=>{f.value-=90},Z=()=>{f.value+=90},C=()=>{r.value=1,f.value=0,v.value={x:0,y:0}},G=o=>{(r.value>1||n.value)&&(x.value=!0,_.value={x:o.clientX-v.value.x,y:o.clientY-v.value.y})},J=o=>{x.value&&(v.value={x:o.clientX-_.value.x,y:o.clientY-_.value.y})},T=()=>{x.value=!1};A(s,()=>{C()});const Q=re(()=>a.value?Math.round(s.value/a.value.total_pages*100):0),ee=async()=>{try{const o=await $fetch(`/api/library/reading/${b.params.id}/start`,{method:"POST"});L.value=o.sessionId,a.value=o.book,s.value=o.lastPage||1,d.value=s.value}catch(o){X.error(o.data?.message||"Ошибка начала сессии чтения"),$.push("/library")}},h=async o=>{if(!(!a.value||o<1||o>a.value.total_pages)){m.value=!0,y.value="";try{const t=await fetch(`/api/library/reading/${b.params.id}/page/${o}`,{headers:{Accept:"image/png"}});if(!t.ok)throw new Error("Ошибка загрузки страницы");const g=await t.blob();c.value=URL.createObjectURL(g),oe(o),te(o+1)}catch(t){y.value=t.message||"Не удалось загрузить страницу",c.value=""}finally{m.value=!1}}},te=o=>{if(!a.value||o>a.value.total_pages)return;const t=new Image;t.src=`/api/library/reading/${b.params.id}/page/${o}`},oe=o=>{clearTimeout(M),M=setTimeout(async()=>{try{await $fetch(`/api/library/reading/${b.params.id}/progress`,{method:"POST",body:{lastPageRead:o}})}catch(t){console.error("Ошибка сохранения прогресса:",t)}},1e3)},E=async()=>{if(L.value)try{await $fetch(`/api/library/reading/${b.params.id}/end`,{method:"POST"})}catch(o){console.error("Ошибка завершения сессии:",o)}},j=()=>{s.value>1&&(s.value--,d.value=s.value)},P=()=>{a.value&&s.value<a.value.total_pages&&(s.value++,d.value=s.value)},se=()=>{d.value=s.value,h(s.value)},R=()=>{if(!a.value)return;const o=Math.max(1,Math.min(d.value,a.value.total_pages));s.value=o,d.value=o,h(o)},ae=async()=>{await E(),$.push("/library")},S=()=>{document.fullscreenElement?(document.exitFullscreen(),n.value=!1):(document.documentElement.requestFullscreen(),n.value=!0)},I=o=>{o.key==="ArrowLeft"?j():o.key==="ArrowRight"?P():o.key==="Escape"&&n.value&&S()};return A(s,o=>{h(o)}),ne(async()=>{await ee(),a.value&&h(s.value),window.addEventListener("keydown",I),document.addEventListener("fullscreenchange",()=>{n.value=!!document.fullscreenElement})}),ie(async()=>{await E(),window.removeEventListener("keydown",I),clearTimeout(M),clearTimeout(K),c.value&&URL.revokeObjectURL(c.value)}),(o,t)=>(u(),i("div",me,[e("div",{class:k(["flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700 z-10",{"opacity-0 pointer-events-none":n.value}])},[e("div",be,[e("button",{onClick:ae,class:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",title:"Назад к каталогу"},[...t[3]||(t[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),e("div",he,[e("h1",ye,p(a.value?.title),1),e("p",fe,p(a.value?.author),1)])]),e("div",xe,[e("button",{onClick:S,class:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",title:n.value?"Выйти из полноэкранного режима":"Полноэкранный режим"},[n.value?(u(),i("svg",_e,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])):(u(),i("svg",ke,[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"},null,-1)])]))],8,we)])],2),e("div",{class:"flex-1 flex items-center justify-center overflow-hidden relative bg-gray-900",ref_key:"containerRef",ref:Y,onWheel:B(H,["prevent"]),onMousedown:G,onMousemove:J,onMouseup:T,onMouseleave:T},[m.value?(u(),i("div",Me,[...t[6]||(t[6]=[e("div",{class:"text-center bg-gray-800/80 p-6 rounded-xl backdrop-blur-sm"},[e("div",{class:"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent mb-4"}),e("p",{class:"text-gray-400"},"Загрузка страницы...")],-1)])])):c.value?(u(),i("div",{key:1,class:"relative flex items-center justify-center transition-transform duration-100 ease-out origin-center",style:ue({transform:`scale(${r.value}) translate(${v.value.x}px, ${v.value.y}px) rotate(${f.value}deg)`,cursor:x.value?"grabbing":r.value>1?"grab":"default"})},[e("img",{src:c.value,draggable:"false",alt:`Страница ${s.value}`,class:k(["max-w-full max-h-[85vh] object-contain shadow-2xl select-none",{"max-h-screen":n.value}]),onLoad:C},null,42,Ce)],4)):y.value?(u(),i("div",je,[e("div",Pe,[t[7]||(t[7]=e("svg",{class:"mx-auto h-16 w-16 text-red-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[8]||(t[8]=e("h3",{class:"text-xl font-semibold text-white mb-2"},"Ошибка загрузки",-1)),e("p",Be,p(y.value),1),e("button",{onClick:t[0]||(t[0]=g=>h(s.value)),class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"}," Повторить попытку ")])])):w("",!0),!m.value&&c.value?(u(),i("div",$e,[e("button",{onClick:D,class:"p-2 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 backdrop-blur-sm shadow-lg transition-colors",title:"Повернуть влево"},[...t[9]||(t[9]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)])]),e("button",{onClick:Z,class:"p-2 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 backdrop-blur-sm shadow-lg transition-colors",title:"Повернуть вправо"},[...t[10]||(t[10]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10H11a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"})],-1)])]),t[13]||(t[13]=e("div",{class:"h-px bg-gray-600 my-1"},null,-1)),e("button",{onClick:W,class:"p-2 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 backdrop-blur-sm shadow-lg transition-colors",title:"Увеличить"},[...t[11]||(t[11]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)])]),e("button",{onClick:C,class:"p-2 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 backdrop-blur-sm shadow-lg transition-colors text-sm font-bold w-10 h-10 flex items-center justify-center",title:"Сбросить масштаб"},p(Math.round(r.value*100))+"% ",1),e("button",{onClick:q,class:"p-2 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 backdrop-blur-sm shadow-lg transition-colors",title:"Уменьшить"},[...t[12]||(t[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])])])):w("",!0),!m.value&&c.value?(u(),i("div",{key:4,class:k(["absolute inset-x-0 top-1/2 -translate-y-1/2 flex items-center justify-between px-4 pointer-events-none z-10",{"opacity-0":!z.value&&!n.value}])},[e("button",{onClick:B(j,["stop"]),disabled:s.value<=1,class:"p-3 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 disabled:opacity-30 disabled:cursor-not-allowed transition-all pointer-events-auto backdrop-blur-sm shadow-lg",title:"Предыдущая страница"},[...t[14]||(t[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,Le),e("button",{onClick:B(P,["stop"]),disabled:s.value>=(a.value?.total_pages||0),class:"p-3 bg-gray-800/80 text-white rounded-full hover:bg-gray-700 disabled:opacity-30 disabled:cursor-not-allowed transition-all pointer-events-auto backdrop-blur-sm shadow-lg",title:"Следующая страница"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,ze)],2)):w("",!0)],544),!m.value&&a.value?(u(),i("div",{key:0,class:k(["px-4 py-3 bg-gray-800 border-t border-gray-700 z-10",{"opacity-0 pointer-events-none":n.value&&!z.value}])},[e("div",Te,[e("div",Ee,[e("span",null,"Страница "+p(s.value)+" из "+p(a.value.total_pages),1),e("span",null,p(Q.value)+"%",1)]),e("div",Re,[U(e("input",{type:"range",min:1,max:a.value.total_pages,"onUpdate:modelValue":t[1]||(t[1]=g=>s.value=g),onChange:se,class:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"},null,40,Se),[[V,s.value,void 0,{number:!0}]])])]),e("div",Ie,[e("button",{onClick:j,disabled:s.value<=1,class:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),N(" Назад ",-1)])],8,Ae),e("div",Ue,[U(e("input",{type:"number",min:1,max:a.value.total_pages,"onUpdate:modelValue":t[2]||(t[2]=g=>d.value=g),onKeyup:de(R,["enter"]),class:"w-20 px-3 py-2 bg-gray-700 text-white text-center rounded-lg border border-gray-600 focus:border-primary outline-none"},null,40,Ve),[[V,d.value,void 0,{number:!0}]]),e("button",{onClick:R,class:"px-3 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"}," Перейти ")]),e("button",{onClick:P,disabled:s.value>=a.value.total_pages,class:"px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[...t[17]||(t[17]=[N(" Вперед ",-1),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Ne)])],2)):w("",!0)]))}}),qe=pe(Oe,[["__scopeId","data-v-87c2531d"]]);export{qe as default};
