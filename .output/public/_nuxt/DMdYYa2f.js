import{c as p,o as i,a as e,v as E,r as x,h as B,n as F,t as $,l as ie,z as H,F as R,j as q,i as Q,f as T,k as I,K as de,b as S,w as j,T as Ce,d as V,q as N,g as ee,x as Z,A as J,S as _e,I as ne,B as Me}from"./GLV6bXvn.js";import{P as Fe}from"./JX9M957j.js";import{_ as te}from"./DlAUqK2U.js";import{_ as K}from"./CyDLpZDf.js";import{u as Y}from"./DlZaGH1J.js";import{s as Se}from"./CRUGdXr-.js";import{_ as se}from"./BMofnORk.js";import{u as ze}from"./DVL-QcDc.js";import"./CFbq0LVm.js";const Be={},Ve={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Te(u,g){return i(),p("svg",Ve,[...g[0]||(g[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.54118 3.7915C6.54118 2.54886 7.54854 1.5415 8.79118 1.5415H11.2078C12.4505 1.5415 13.4578 2.54886 13.4578 3.7915V4.0415H15.6249H16.6658C17.08 4.0415 17.4158 4.37729 17.4158 4.7915C17.4158 5.20572 17.08 5.5415 16.6658 5.5415H16.3749V8.24638V13.2464V16.2082C16.3749 17.4508 15.3676 18.4582 14.1249 18.4582H5.87492C4.63228 18.4582 3.62492 17.4508 3.62492 16.2082V13.2464V8.24638V5.5415H3.33325C2.91904 5.5415 2.58325 5.20572 2.58325 4.7915C2.58325 4.37729 2.91904 4.0415 3.33325 4.0415H4.37492H6.54118V3.7915ZM14.8749 13.2464V8.24638V5.5415H13.4578H12.7078H7.29118H6.54118H5.12492V8.24638V13.2464V16.2082C5.12492 16.6224 5.46071 16.9582 5.87492 16.9582H14.1249C14.5391 16.9582 14.8749 16.6224 14.8749 16.2082V13.2464ZM8.04118 4.0415H11.9578V3.7915C11.9578 3.37729 11.6221 3.0415 11.2078 3.0415H8.79118C8.37696 3.0415 8.04118 3.37729 8.04118 3.7915V4.0415ZM8.33325 7.99984C8.74747 7.99984 9.08325 8.33562 9.08325 8.74984V13.7498C9.08325 14.1641 8.74747 14.4998 8.33325 14.4998C7.91904 14.4998 7.58325 14.1641 7.58325 13.7498V8.74984C7.58325 8.33562 7.91904 7.99984 8.33325 7.99984ZM12.4166 8.74984C12.4166 8.33562 12.0808 7.99984 11.6666 7.99984C11.2524 7.99984 10.9166 8.33562 10.9166 8.74984V13.7498C10.9166 14.1641 11.2524 14.4998 11.6666 14.4998C12.0808 14.4998 12.4166 14.1641 12.4166 13.7498V8.74984Z",fill:"currentColor"},null,-1)])])}const He=Object.assign(te(Be,[["render",Te]]),{__name:"IconsTrashIcon"}),oe=()=>{const{authFetch:u}=Y();return{uploadFile:async(r,l,v,s,o)=>{const a=new FormData;a.append("file",r),a.append("category",l),v!=null&&a.append("folderId",String(v)),s&&a.append("relatedId",String(s)),o&&a.append("metadata",JSON.stringify(o));const c=await u("/api/files/upload",{method:"POST",body:a});if(!c.success||!c.file)throw new Error(c.message||"Не удалось загрузить файл");return c.file},getFiles:async r=>{const l=new URLSearchParams;r?.page&&l.append("page",String(r.page)),r?.limit&&l.append("limit",String(r.limit)),r?.search&&l.append("search",r.search),r?.category&&l.append("category",r.category),r?.userId&&l.append("userId",String(r.userId)),r?.courseId&&l.append("courseId",String(r.courseId)),r?.groupId&&l.append("groupId",String(r.groupId));const v=`/api/files${l.toString()?`?${l}`:""}`,s=await u(v);if(!s.success)throw new Error(s.message||"Не удалось получить список файлов");return s},deleteFile:async r=>{const l=await u(`/api/files/${r}`,{method:"DELETE"});if(!l.success)throw new Error(l.message||"Не удалось удалить файл")},getFileUrl:r=>`/api/files/${r}`,formatFileSize:r=>{if(r===0)return"0 Bytes";const l=1024,v=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(r)/Math.log(l));return Math.round(r/Math.pow(l,s)*100)/100+" "+v[s]}}},je={class:"file-uploader"},Ie=["accept","multiple"],Pe={class:"flex flex-col items-center justify-center gap-4 text-center"},Ee={class:"text-lg font-medium text-black dark:text-white"},Oe={class:"mt-2 text-xs text-gray-400 dark:text-gray-500"},Ue={key:0,class:"w-full max-w-md"},Ae={class:"flex items-center justify-between mb-2"},Le={class:"text-sm font-medium text-primary"},De={class:"h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},Re={key:0,class:"mt-4"},Ne={class:"text-sm font-medium text-black dark:text-white mb-3"},We={class:"space-y-2"},qe={class:"shrink-0 h-10 w-10 rounded overflow-hidden bg-gray-200 dark:bg-gray-700"},Ze=["src","alt"],Je={key:1,class:"h-full w-full flex items-center justify-center"},Ke={class:"flex-1 min-w-0"},Xe={class:"text-sm font-medium text-black dark:text-white truncate"},Ye={class:"text-xs text-gray-500 dark:text-gray-400"},Ge=["onClick"],Qe=E({__name:"FileUploader",props:{category:{},folderId:{},relatedId:{},accept:{default:"*/*"},maxSizeMb:{default:50},multiple:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0},metadata:{}},emits:["uploaded","error","deleted"],setup(u,{emit:g}){const f=u,k=g,{uploadFile:b,deleteFile:d,formatFileSize:r}=oe(),l=x(null),v=x(!1),s=x(!1),o=x(0),a=x([]),c=()=>{s.value||l.value?.click()},C=w=>{const h=f.maxSizeMb*1024*1024;if(w.size>h){const y=`Файл слишком большой. Максимальный размер: ${f.maxSizeMb}MB`;return k("error",y),alert(y),!1}if(f.accept!=="*/*"){const y=f.accept.split(",").map(M=>M.trim()),z="."+w.name.split(".").pop()?.toLowerCase(),A=w.type;if(!y.some(M=>{if(M.startsWith("."))return M.toLowerCase()===z;if(M.endsWith("/*")){const G=M.split("/")[0];return A.startsWith(G+"/")}return M===A})){const M=`Неподдерживаемый тип файла: ${w.name}`;return k("error",M),alert(M),!1}}return!0},_=async w=>{if(!C(w))return;s.value=!0,o.value=0;const h=Se(()=>{o.value<90&&(o.value+=10)},100);try{const y=await b(w,f.category,f.folderId,f.relatedId,f.metadata);o.value=100,f.showPreview&&a.value.push(y),k("uploaded",y),console.log("Файл успешно загружен:",y.filename)}catch(y){const z=y instanceof Error?y.message:"Ошибка загрузки файла";k("error",z),alert(z)}finally{clearInterval(h),s.value=!1,o.value=0}},L=w=>{const h=w.target,y=h.files;if(y&&y.length>0)if(f.multiple)Array.from(y).forEach(_);else{const z=y[0];z&&_(z)}h.value=""},W=w=>{v.value=!1;const h=w.dataTransfer?.files;if(h&&h.length>0)if(f.multiple)Array.from(h).forEach(_);else{const y=h[0];y&&_(y)}},O=async w=>{if(confirm("Вы уверены, что хотите удалить этот файл?"))try{await d(w),a.value=a.value.filter(h=>h.uuid!==w),k("deleted",w)}catch(h){const y=h instanceof Error?h.message:"Ошибка удаления файла";k("error",y),alert(y)}},U=w=>w.startsWith("image/");return(w,h)=>(i(),p("div",je,[e("div",{class:F(["relative rounded-lg border-2 border-dashed p-8 transition-all duration-200",v.value?"border-primary bg-primary/5 scale-[1.02]":"border-stroke dark:border-strokedark hover:border-primary/50","cursor-pointer"]),onDrop:H(W,["prevent"]),onDragover:h[0]||(h[0]=H(y=>v.value=!0,["prevent"])),onDragleave:h[1]||(h[1]=H(y=>v.value=!1,["prevent"])),onClick:c},[e("input",{ref_key:"fileInput",ref:l,type:"file",accept:u.accept,multiple:u.multiple,class:"hidden",onChange:L},null,40,Ie),e("div",Pe,[e("div",{class:F(["flex h-16 w-16 items-center justify-center rounded-full transition-all",v.value?"bg-primary text-white scale-110":"bg-gray-100 dark:bg-gray-800 text-gray-400"])},[...h[2]||(h[2]=[e("svg",{class:"h-8 w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)])],2),e("div",null,[e("p",Ee,$(v.value?"Отпустите файл":"Перетащите файл сюда"),1),h[3]||(h[3]=e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," или нажмите для выбора ",-1)),e("p",Oe," Максимальный размер: "+$(u.maxSizeMb)+" MB ",1)]),s.value?(i(),p("div",Ue,[e("div",Ae,[h[4]||(h[4]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Загрузка...",-1)),e("span",Le,$(o.value)+"%",1)]),e("div",De,[e("div",{class:"h-full bg-linear-to-r from-primary to-secondary transition-all duration-300",style:ie({width:`${o.value}%`})},null,4)])])):B("",!0)])],34),u.showPreview&&a.value.length>0?(i(),p("div",Re,[e("h4",Ne," Загруженные файлы ("+$(a.value.length)+") ",1),e("div",We,[(i(!0),p(R,null,q(a.value,y=>(i(),p("div",{key:y.uuid,class:"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[e("div",qe,[U(y.mimeType)?(i(),p("img",{key:0,src:y.url,alt:y.filename,class:"h-full w-full object-cover"},null,8,Ze)):(i(),p("div",Je,[...h[5]||(h[5]=[e("svg",{class:"h-6 w-6 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z","clip-rule":"evenodd"})],-1)])]))]),e("div",Ke,[e("p",Xe,$(y.filename),1),e("p",Ye,$(Q(r)(y.sizeBytes)),1)]),e("button",{type:"button",onClick:z=>O(y.uuid),class:"shrink-0 p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Удалить"},[...h[6]||(h[6]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ge)]))),128))])])):B("",!0)]))}}),et=Object.assign(te(Qe,[["__scopeId","data-v-460c0dbf"]]),{__name:"CommonFileUploader"}),tt=E({__name:"FileTypeIcon",props:{mimeType:{},extension:{},size:{default:"md"}},setup(u){const g=u,f=T(()=>g.mimeType.startsWith("image/")),k=T(()=>g.mimeType==="application/pdf"||g.extension==="pdf"),b=T(()=>g.mimeType.startsWith("video/")),d=T(()=>g.mimeType.startsWith("audio/")),r=T(()=>{const a=["application/zip","application/x-rar","application/x-7z-compressed","application/x-tar"],c=["zip","rar","7z","tar","gz"];return a.includes(g.mimeType)||g.extension&&c.includes(g.extension.toLowerCase())}),l=T(()=>{const a=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],c=["xls","xlsx","csv"];return a.includes(g.mimeType)||g.extension&&c.includes(g.extension.toLowerCase())}),v=T(()=>{const a=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],c=["doc","docx"];return a.includes(g.mimeType)||g.extension&&c.includes(g.extension.toLowerCase())}),s=T(()=>{switch(g.size){case"sm":return"h-4 w-4";case"md":return"h-6 w-6";case"lg":return"h-8 w-8";case"xl":return"h-12 w-12";default:return"h-6 w-6"}}),o=T(()=>f.value?"text-purple-500":k.value?"text-red-500":b.value?"text-pink-500":d.value?"text-green-500":r.value?"text-yellow-500":l.value?"text-emerald-600":v.value?"text-blue-600":"text-gray-400");return(a,c)=>(i(),p("div",{class:F(["inline-flex items-center justify-center",s.value])},[f.value?(i(),p("svg",{key:0,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[0]||(c[0]=[e("path",{"fill-rule":"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z","clip-rule":"evenodd"},null,-1)])],2)):k.value?(i(),p("svg",{key:1,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[1]||(c[1]=[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"},null,-1)])],2)):b.value?(i(),p("svg",{key:2,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[2]||(c[2]=[e("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"},null,-1)])],2)):r.value?(i(),p("svg",{key:3,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[3]||(c[3]=[e("path",{d:"M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"},null,-1),e("path",{"fill-rule":"evenodd",d:"M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z","clip-rule":"evenodd"},null,-1)])],2)):l.value?(i(),p("svg",{key:4,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[4]||(c[4]=[e("path",{"fill-rule":"evenodd",d:"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z","clip-rule":"evenodd"},null,-1)])],2)):v.value?(i(),p("svg",{key:5,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[5]||(c[5]=[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"},null,-1)])],2)):d.value?(i(),p("svg",{key:6,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[6]||(c[6]=[e("path",{d:"M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"},null,-1)])],2)):(i(),p("svg",{key:7,class:F(["w-full h-full",o.value]),fill:"currentColor",viewBox:"0 0 20 20"},[...c[7]||(c[7]=[e("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z","clip-rule":"evenodd"},null,-1)])],2))],2))}}),ue=Object.assign(tt,{__name:"CommonFileTypeIcon"}),st={class:"relative bg-white dark:bg-boxdark rounded-lg shadow-xl w-full max-w-4xl transition-all",role:"dialog","aria-modal":"true"},ot={class:"flex items-center justify-between px-6 py-4 border-b border-stroke dark:border-strokedark"},rt={class:"text-xl font-semibold text-black dark:text-white truncate"},lt={class:"p-6"},at={key:0,class:"flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded-lg p-4"},nt=["src","alt"],it={key:1,class:"flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded-lg p-4"},dt=["src"],ut={key:2,class:"flex items-center justify-center bg-gray-50 dark:bg-gray-900 rounded-lg p-8"},ct=["src"],mt={key:3,class:"text-center py-12"},pt={class:"text-lg font-medium text-black dark:text-white mb-2"},vt={class:"mt-6 grid grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg"},ft={class:"text-sm font-medium text-black dark:text-white"},gt={class:"text-sm font-medium text-black dark:text-white"},bt={class:"text-sm font-medium text-black dark:text-white"},xt={class:"text-sm font-medium text-black dark:text-white"},yt={class:"px-6 py-4 border-t border-stroke dark:border-strokedark flex justify-end gap-3"},ht=["href"],kt=["href"],wt=E({__name:"FilePreviewModal",props:{isOpen:{type:Boolean},file:{}},emits:["close"],setup(u){const g=u,{formatFileSize:f}=oe(),k=T(()=>g.file.mimeType.startsWith("image/")),b=T(()=>g.file.mimeType.startsWith("video/")),d=T(()=>g.file.mimeType.startsWith("audio/")),r=v=>({profile:"Профиль",certificate_template:"Шаблон",certificate_generated:"Сертификат",course_material:"Материал",course_media:"Медиа",course_cover:"Обложка",group_gallery:"Галерея",group_file:"Файл",assignment:"Задание",other:"Другое"})[v]||v,l=v=>new Date(v).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(v,s)=>(i(),I(de,{to:"body"},[S(Ce,{name:"modal"},{default:j(()=>[u.isOpen?(i(),p("div",{key:0,class:"fixed inset-0 flex items-center justify-center overflow-y-auto z-99999 p-4",onClick:s[1]||(s[1]=H(o=>v.$emit("close"),["self"]))},[s[10]||(s[10]=e("div",{class:"fixed inset-0 bg-black/80 backdrop-blur-sm transition-opacity","aria-hidden":"true"},null,-1)),e("div",st,[e("div",ot,[e("h3",rt,$(u.file?.filename||"Просмотр файла"),1),e("button",{type:"button",onClick:s[0]||(s[0]=o=>v.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"},[...s[2]||(s[2]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",lt,[k.value?(i(),p("div",at,[e("img",{src:u.file.url,alt:u.file.filename,class:"max-w-full max-h-[60vh] object-contain rounded"},null,8,nt)])):b.value?(i(),p("div",it,[e("video",{src:u.file.url,controls:"",class:"max-w-full max-h-[60vh] rounded"}," Ваш браузер не поддерживает видео. ",8,dt)])):d.value?(i(),p("div",ut,[e("audio",{src:u.file.url,controls:"",class:"w-full"}," Ваш браузер не поддерживает аудио. ",8,ct)])):(i(),p("div",mt,[S(ue,{"mime-type":u.file.mimeType,extension:u.file.extension,size:"xl",class:"mx-auto mb-4"},null,8,["mime-type","extension"]),e("p",pt,$(u.file.filename),1),s[3]||(s[3]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Предпросмотр недоступен для этого типа файлов ",-1))])),e("div",vt,[e("div",null,[s[4]||(s[4]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Размер",-1)),e("p",ft,$(Q(f)(u.file.sizeBytes)),1)]),e("div",null,[s[5]||(s[5]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Тип",-1)),e("p",gt,$(u.file.extension.toUpperCase()),1)]),e("div",null,[s[6]||(s[6]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Категория",-1)),e("p",bt,$(r(u.file.category)),1)]),e("div",null,[s[7]||(s[7]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"},"Дата загрузки",-1)),e("p",xt,$(l(u.file.createdAt)),1)])])]),e("div",yt,[e("a",{href:u.file.url,download:"",class:"inline-flex items-center gap-2 rounded-md bg-gray-100 dark:bg-gray-800 px-4 py-2 text-sm font-medium text-black dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"},[...s[8]||(s[8]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),V(" Скачать ",-1)])],8,ht),e("a",{href:u.file.url,target:"_blank",class:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-opacity-90 transition-colors"},[...s[9]||(s[9]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1),V(" Открыть в новой вкладке ",-1)])],8,kt)])])])):B("",!0)]),_:1})]))}}),$t=Object.assign(te(wt,[["__scopeId","data-v-c69c090c"]]),{__name:"FilesFilePreviewModal"}),Ct={class:"flex items-center gap-2 text-sm mb-4"},_t=["onClick","title"],Mt=["title"],Ft=E({__name:"Breadcrumbs",props:{path:{},currentFolderId:{}},emits:["navigate"],setup(u,{emit:g}){const f=u,k=g,{authFetch:b}=Y(),d=x(new Map);async function r(s){if(s!==null)try{const o=await b(`/api/folders/${s}/path`);if(o.success&&o.path){let a="";for(const c of o.path)a+="/"+c.name,d.value.set(a,c.id)}}catch(o){console.error("Ошибка загрузки пути папки:",o)}}const l=T(()=>{if(!f.path||f.path==="/")return[];const s=f.path.split("/").filter(Boolean),o=[];let a="";return s.forEach((c,C)=>{a+="/"+c;const _=d.value.get(a)||null;o.push({id:_,name:c})}),o}),v=s=>{k("navigate",s)};return N(()=>f.currentFolderId,s=>{r(s)},{immediate:!0}),ee(()=>{r(f.currentFolderId)}),(s,o)=>(i(),p("nav",Ct,[e("button",{onClick:o[0]||(o[0]=a=>v(null)),class:"flex items-center gap-1 text-gray-600 dark:text-gray-400 hover:text-primary transition-colors",title:"Корневая папка"},[...o[1]||(o[1]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),e("span",{class:"font-medium"},"storage",-1)])]),(i(!0),p(R,null,q(l.value,(a,c)=>(i(),p(R,{key:c},[o[2]||(o[2]=e("svg",{class:"h-4 w-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),c<l.value.length-1?(i(),p("button",{key:0,onClick:C=>v(a.id),class:"text-gray-600 dark:text-gray-400 hover:text-primary transition-colors font-medium truncate max-w-48",title:a.name},$(a.name),9,_t)):(i(),p("span",{key:1,class:"text-black dark:text-white font-semibold truncate max-w-48",title:a.name},$(a.name),9,Mt))],64))),128))]))}}),St=Object.assign(Ft,{__name:"FilesBreadcrumbs"}),ce=()=>{const{authFetch:u}=Y(),g=async(d,r)=>{const l=await u("/api/folders",{method:"POST",body:{name:d,parentId:r}});if(!l.success||!l.folder)throw new Error(l.message||"Не удалось создать папку");return l.folder},f=async d=>{const r=d!=null?`?parentId=${d}`:"",l=await u(`/api/folders${r}`);if(!l.success||!l.folders)throw new Error(l.message||"Не удалось получить список папок");return l.folders};return{createFolder:g,getFolders:f,getFolderContents:async d=>{const r=d===null?"root":String(d);console.log("getFolderContents - запрос:",{folderId:d,id:r,url:`/api/folders/${r}/contents`});try{const l=await u(`/api/folders/${r}/contents`);if(console.log("getFolderContents - ответ:",l),!l.success)throw new Error(l.message||"Не удалось получить содержимое папки");return l}catch(l){throw console.error("getFolderContents - ошибка:",l),l}},getRootFolders:async()=>f(null)}},zt={class:"mb-4"},Bt=["disabled"],Vt={key:0,class:"mb-4 rounded bg-red-50 dark:bg-red-900/20 p-3 text-sm text-red-600 dark:text-red-400"},Tt={class:"flex justify-end gap-3"},Ht=["disabled"],jt=["disabled"],It=E({__name:"CreateFolderModal",props:{isOpen:{type:Boolean},parentId:{}},emits:["close","created"],setup(u,{emit:g}){const f=u,k=g,{createFolder:b}=ce(),d=x(""),r=x(!1),l=x(""),v=async()=>{if(!r.value){if(!d.value.trim()){l.value="Введите название папки";return}r.value=!0,l.value="";try{const s=await b(d.value.trim(),f.parentId||null);d.value="",k("created",s.id),k("close")}catch(s){l.value=s instanceof Error?s.message:"Ошибка создания папки"}finally{r.value=!1}}};return N(()=>f.isOpen,s=>{s||(d.value="",l.value="")}),(s,o)=>(i(),I(K,{"is-open":u.isOpen,title:"Создать папку",size:"md",onClose:o[2]||(o[2]=a=>s.$emit("close"))},{default:j(()=>[e("form",{onSubmit:H(v,["prevent"])},[e("div",zt,[o[3]||(o[3]=e("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"}," Название папки ",-1)),Z(e("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>d.value=a),type:"text",placeholder:"Введите название...",class:"w-full rounded border border-stroke bg-transparent px-4 py-2.5 text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary",disabled:r.value,required:""},null,8,Bt),[[J,d.value]])]),l.value?(i(),p("div",Vt,$(l.value),1)):B("",!0),e("div",Tt,[e("button",{type:"button",onClick:o[1]||(o[1]=a=>s.$emit("close")),class:"rounded border border-stroke px-4 py-2 text-black transition hover:bg-gray-50 dark:border-strokedark dark:text-white dark:hover:bg-gray-800",disabled:r.value}," Отмена ",8,Ht),e("button",{type:"submit",class:"rounded bg-primary px-4 py-2 text-white transition hover:bg-opacity-90 disabled:opacity-50",disabled:r.value||!d.value.trim()},$(r.value?"Создание...":"Создать"),9,jt)])],32)]),_:1},8,["is-open"]))}}),Pt=Object.assign(It,{__name:"FilesCreateFolderModal"}),Et={key:0,class:"mt-1 text-sm text-danger"},Ot={class:"flex justify-end gap-4"},Ut={key:0},At={key:1,class:"flex items-center gap-2"},Lt=E({__name:"RenameModal",props:{isOpen:{type:Boolean},currentName:{},title:{}},emits:["close","submit"],setup(u,{emit:g}){const f=u,k=g,b=x(""),d=x(""),r=x(!1);N(()=>f.isOpen,v=>{v&&(b.value=f.currentName,d.value="",r.value=!1)});const l=()=>{if(d.value="",!b.value.trim()){d.value="Имя не может быть пустым";return}if(b.value.trim()===f.currentName){d.value="Новое имя совпадает с текущим";return}r.value=!0,k("submit",b.value.trim())};return(v,s)=>{const o=se,a=K;return i(),I(a,{"is-open":u.isOpen,onClose:s[2]||(s[2]=c=>v.$emit("close")),title:u.title},{default:j(()=>[e("form",{onSubmit:H(l,["prevent"]),class:"space-y-4"},[e("div",null,[s[3]||(s[3]=e("label",{for:"newName",class:"mb-2.5 block text-sm font-medium text-black dark:text-white"},[V(" Новое имя "),e("span",{class:"text-danger"},"*")],-1)),Z(e("input",{id:"newName","onUpdate:modelValue":s[0]||(s[0]=c=>b.value=c),type:"text",required:"",autofocus:"",class:F(["w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":d.value}])},null,2),[[J,b.value]]),d.value?(i(),p("p",Et,$(d.value),1)):B("",!0)]),e("div",Ot,[S(o,{type:"button",variant:"secondary",onClick:s[1]||(s[1]=c=>v.$emit("close")),disabled:r.value},{default:j(()=>[...s[4]||(s[4]=[V(" Отмена ",-1)])]),_:1},8,["disabled"]),S(o,{type:"submit",variant:"primary",disabled:r.value},{default:j(()=>[r.value?(i(),p("span",At,[...s[5]||(s[5]=[e("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-solid border-white border-t-transparent"},null,-1),V(" Сохранение... ",-1)])])):(i(),p("span",Ut,"Переименовать"))]),_:1},8,["disabled"])])],32)]),_:1},8,["is-open","title"])}}}),Dt=Object.assign(Lt,{__name:"FilesRenameModal"}),Rt={key:0,class:"mt-1 text-sm text-danger"},Nt={class:"flex justify-end gap-4"},Wt={key:0},qt={key:1,class:"flex items-center gap-2"},Zt=E({__name:"SetPasswordModal",props:{isOpen:{type:Boolean},folderId:{}},emits:["close","submit"],setup(u,{emit:g}){const f=u,k=g,b=x(""),d=x(""),r=x(""),l=x(!1);N(()=>f.isOpen,s=>{s&&(b.value="",d.value="",r.value="",l.value=!1)});const v=()=>{if(r.value="",b.value.length<6){r.value="Пароль должен содержать минимум 6 символов";return}if(b.value!==d.value){r.value="Пароли не совпадают";return}l.value=!0,k("submit",b.value)};return(s,o)=>{const a=se,c=K;return i(),I(c,{"is-open":u.isOpen,onClose:o[3]||(o[3]=C=>s.$emit("close")),title:"Установить пароль на папку"},{default:j(()=>[e("form",{onSubmit:H(v,["prevent"]),class:"space-y-4"},[e("div",null,[o[4]||(o[4]=e("label",{for:"password",class:"mb-2.5 block text-sm font-medium text-black dark:text-white"},[V(" Пароль "),e("span",{class:"text-danger"},"*")],-1)),Z(e("input",{id:"password","onUpdate:modelValue":o[0]||(o[0]=C=>b.value=C),type:"password",required:"",autofocus:"",minlength:"6",class:F(["w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":r.value}]),placeholder:"Минимум 6 символов"},null,2),[[J,b.value]])]),e("div",null,[o[5]||(o[5]=e("label",{for:"confirmPassword",class:"mb-2.5 block text-sm font-medium text-black dark:text-white"},[V(" Подтвердите пароль "),e("span",{class:"text-danger"},"*")],-1)),Z(e("input",{id:"confirmPassword","onUpdate:modelValue":o[1]||(o[1]=C=>d.value=C),type:"password",required:"",minlength:"6",class:F(["w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":r.value}]),placeholder:"Повторите пароль"},null,2),[[J,d.value]]),r.value?(i(),p("p",Rt,$(r.value),1)):B("",!0)]),e("div",Nt,[S(a,{type:"button",variant:"secondary",onClick:o[2]||(o[2]=C=>s.$emit("close")),disabled:l.value},{default:j(()=>[...o[6]||(o[6]=[V(" Отмена ",-1)])]),_:1},8,["disabled"]),S(a,{type:"submit",variant:"primary",disabled:l.value},{default:j(()=>[l.value?(i(),p("span",qt,[...o[7]||(o[7]=[e("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-solid border-white border-t-transparent"},null,-1),V(" Сохранение... ",-1)])])):(i(),p("span",Wt,"Установить пароль"))]),_:1},8,["disabled"])])],32)]),_:1},8,["is-open"])}}}),Jt=Object.assign(Zt,{__name:"FilesSetPasswordModal"}),Kt={key:0,class:"mt-1 text-sm text-danger"},Xt={class:"flex justify-end gap-4"},Yt={key:0},Gt={key:1,class:"flex items-center gap-2"},Qt=E({__name:"UnlockFolderModal",props:{isOpen:{type:Boolean},folderId:{}},emits:["close","submit","error"],setup(u,{expose:g,emit:f}){const k=u,b=f,d=x(""),r=x(""),l=x(!1);N(()=>k.isOpen,o=>{o&&(d.value="",r.value="",l.value=!1)});const v=()=>{if(r.value="",!d.value){r.value="Введите пароль";return}l.value=!0,b("submit",d.value)};return g({setError:o=>{r.value=o,l.value=!1}}),(o,a)=>{const c=se,C=K;return i(),I(C,{"is-open":u.isOpen,onClose:a[3]||(a[3]=_=>o.$emit("close")),title:"Введите пароль"},{default:j(()=>[e("form",{onSubmit:H(v,["prevent"]),class:"space-y-4"},[a[7]||(a[7]=e("div",{class:"flex items-center gap-3 mb-4"},[e("svg",{class:"h-12 w-12 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),e("div",null,[e("p",{class:"text-sm font-medium text-black dark:text-white"}," Папка защищена паролем "),e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," Введите пароль для доступа к содержимому ")])],-1)),e("div",null,[a[4]||(a[4]=e("label",{for:"password",class:"mb-2.5 block text-sm font-medium text-black dark:text-white"},[V(" Пароль "),e("span",{class:"text-danger"},"*")],-1)),Z(e("input",{id:"password","onUpdate:modelValue":a[0]||(a[0]=_=>d.value=_),type:"password",required:"",autofocus:"",class:F(["w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":r.value}]),placeholder:"Введите пароль",onInput:a[1]||(a[1]=_=>r.value="")},null,34),[[J,d.value]]),r.value?(i(),p("p",Kt,$(r.value),1)):B("",!0)]),e("div",Xt,[S(c,{type:"button",variant:"secondary",onClick:a[2]||(a[2]=_=>o.$emit("close")),disabled:l.value},{default:j(()=>[...a[5]||(a[5]=[V(" Отмена ",-1)])]),_:1},8,["disabled"]),S(c,{type:"submit",variant:"primary",disabled:l.value},{default:j(()=>[l.value?(i(),p("span",Gt,[...a[6]||(a[6]=[e("div",{class:"h-4 w-4 animate-spin rounded-full border-2 border-solid border-white border-t-transparent"},null,-1),V(" Проверка... ",-1)])])):(i(),p("span",Yt,"Разблокировать"))]),_:1},8,["disabled"])])],32)]),_:1},8,["is-open"])}}}),es=Object.assign(Qt,{__name:"FilesUnlockFolderModal"}),ts={class:"py-2"},ss=["onClick","disabled"],os=E({__name:"ContextMenu",props:{visible:{type:Boolean},position:{},items:{}},emits:["close"],setup(u,{emit:g}){const f=u,k=g,b=x(null),d=v=>{ne(()=>{r()})},r=()=>{k("close")},l=v=>{v.key==="Escape"&&f.visible&&r()};return N(()=>f.visible,async v=>{if(v&&(await ne(),b.value)){const s=b.value,o=s.getBoundingClientRect(),a=window.innerWidth,c=window.innerHeight;let{x:C,y:_}=f.position;o.right>a&&(C=a-o.width-10),o.bottom>c&&(_=c-o.height-10),C<0&&(C=10),_<0&&(_=10),s.style.left=C+"px",s.style.top=_+"px"}}),ee(()=>{document.addEventListener("keydown",l)}),_e(()=>{document.removeEventListener("keydown",l)}),(v,s)=>(i(),I(de,{to:"body"},[u.visible?(i(),p("div",{key:0,ref_key:"menuRef",ref:b,style:ie({top:u.position.y+"px",left:u.position.x+"px"}),class:"fixed z-99999 min-w-48 rounded-md border border-stroke bg-white shadow-lg dark:border-strokedark dark:bg-boxdark",onClick:d},[e("div",ts,[(i(!0),p(R,null,q(u.items,(o,a)=>(i(),p("button",{key:a,onClick:o.action,disabled:o.disabled,class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-black hover:bg-gray-100 dark:text-white dark:hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[o.icon?(i(),I(Me(o.icon),{key:0,class:F(["h-5 w-5",o.iconClass])},null,8,["class"])):B("",!0),e("span",null,$(o.label),1)],8,ss))),128))])],4)):B("",!0),u.visible?(i(),p("div",{key:1,class:"fixed inset-0 z-99998",onClick:r,onContextmenu:H(r,["prevent"])},null,32)):B("",!0)]))}}),rs=Object.assign(os,{__name:"FilesContextMenu"}),ls={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},as={class:"mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ns={class:"flex gap-2"},is=["disabled"],ds={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},us={class:"p-4 md:p-6"},cs={key:0,class:"flex items-center justify-center py-12"},ms={key:1,class:"py-12 text-center"},ps={key:2,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"},vs=["onDblclick","onContextmenu"],fs={class:"flex flex-col items-center gap-3"},gs={class:"relative text-yellow-500"},bs={key:0,class:"absolute -bottom-1 -right-1 h-6 w-6 text-warning bg-white dark:bg-boxdark rounded-full p-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",title:"Защищена паролем"},xs=["title"],ys={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},hs=["onDblclick","onContextmenu"],ks={class:"aspect-square mb-3 rounded overflow-hidden bg-gray-50 dark:bg-gray-800 flex items-center justify-center"},ws=["src","alt"],$s=["title"],Cs={class:"text-xs text-gray-500 dark:text-gray-400"},_s={class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1"},Ms=["onClick"],Ps=E({__name:"index",setup(u){const{getFolderContents:g}=ce(),{deleteFile:f,formatFileSize:k}=oe(),{authFetch:b}=Y(),d=ze(),r=x([]),l=x([]),v=x(!1),s=x(!1),o=x(!1),a=x(!1),c=x(!1),C=x(!1),_=x(!1),L=x(!1),W=x(null),O=x(null),U=x(null),w=x(null),h=x(null),y=x(new Set),z=x({visible:!1,position:{x:0,y:0},items:[],target:null}),A=x(null),D=x("/"),M=async()=>{v.value=!0;try{const n=await g(A.value);r.value=n.folders,l.value=n.files}catch(n){console.error("Ошибка загрузки содержимого папки:",n),alert("Не удалось загрузить содержимое папки")}finally{v.value=!1}},G=async()=>{s.value=!0;try{const n=await b("/api/files/sync",{method:"POST"});n.success&&(d.success(n.message,"Синхронизация завершена"),n.errors&&n.errors.length>0&&console.warn("Ошибки синхронизации:",n.errors),M())}catch(n){console.error("Ошибка синхронизации:",n);const t=n?.data?.message||n?.message||"Произошла ошибка при синхронизации";d.error(t,"Ошибка")}finally{s.value=!1}},X=async n=>{if(n!==null){const t=r.value.find(m=>m.id===n);if(t?.passwordHash&&!y.value.has(n)){w.value={id:t.id,name:t.name},L.value=!0;return}}if(A.value=n,n===null)D.value="/";else try{const t=await b(`/api/folders/${n}/path`);if(t.success&&t.currentFolder?.path)D.value=t.currentFolder.path;else{const m=r.value.find(P=>P.id===n);m&&(D.value=m.path)}}catch(t){console.error("Ошибка получения пути папки:",t);const m=r.value.find(P=>P.id===n);m&&(D.value=m.path)}M()},me=n=>{console.log("Папка создана:",n),M()},pe=n=>{console.log("Файл загружен:",n.filename),a.value=!1,M()},ve=n=>{console.error("Ошибка загрузки:",n)},re=n=>{W.value=n,c.value=!0},le=async n=>{if(confirm("Вы уверены, что хотите удалить этот файл?"))try{await f(n),M()}catch(t){console.error("Ошибка удаления файла:",t),alert("Не удалось удалить файл")}},fe=n=>n.startsWith("image/"),ge=n=>{const t=document.createElement("a");t.href=n.url,t.download=n.filename,t.click()},ae=(n,t,m)=>{O.value={type:n,id:t,name:m},C.value=!0},be=async n=>{if(O.value)try{const{type:t,id:m}=O.value;t==="folder"?(await b(`/api/folders/${m}/rename`,{method:"PUT",body:{newName:n}}),d.success("Папка успешно переименована","Успех")):(await b(`/api/files/${m}/rename`,{method:"PUT",body:{newName:n}}),d.success("Файл успешно переименован","Успех")),C.value=!1,O.value=null,M()}catch(t){console.error("Ошибка переименования:",t);const m=t?.data?.message||t?.message||"Произошла ошибка при переименовании";d.error(m,"Ошибка")}},xe=n=>{U.value={id:n.id,name:n.name},_.value=!0},ye=async n=>{if(U.value)try{await b(`/api/folders/${U.value.id}/set-password`,{method:"POST",body:{password:n}}),d.success("Пароль успешно установлен","Успех"),_.value=!1,U.value=null,M()}catch(t){console.error("Ошибка установки пароля:",t);const m=t?.data?.message||t?.message||"Произошла ошибка при установке пароля";d.error(m,"Ошибка")}},he=async n=>{try{await b(`/api/folders/${n}/remove-password`,{method:"DELETE"}),d.success("Пароль успешно удален","Успех"),M()}catch(t){console.error("Ошибка удаления пароля:",t);const m=t?.data?.message||t?.message||"Произошла ошибка при удалении пароля";d.error(m,"Ошибка")}},ke=async n=>{if(w.value)try{await b(`/api/folders/${w.value.id}/verify-password`,{method:"POST",body:{password:n}}),y.value.add(w.value.id),sessionStorage.setItem("unlockedFolders",JSON.stringify(Array.from(y.value))),L.value=!1;const t=w.value.id;w.value=null,X(t)}catch(t){console.error("Ошибка проверки пароля:",t);const m=t?.data?.message||t?.message||"Неверный пароль";h.value&&h.value.setError(m)}},we=(n,t)=>{const m=[{label:"Открыть",action:()=>X(t.id)},{label:"Переименовать",action:()=>ae("folder",t.id,t.name),disabled:t.isSystem},{label:"Создать подпапку",action:()=>{o.value=!0},disabled:t.isSystem}];t.isSystem||(t.passwordHash?m.push({label:"Удалить пароль",action:()=>he(t.id)}):m.push({label:"Установить пароль",action:()=>xe(t)})),z.value={visible:!0,position:{x:n.clientX,y:n.clientY},target:t,items:m}},$e=(n,t)=>{z.value={visible:!0,position:{x:n.clientX,y:n.clientY},target:t,items:[{label:"Открыть",action:()=>re(t)},{label:"Скачать",action:()=>ge(t)},{label:"Переименовать",action:()=>ae("file",t.uuid,t.filename)},{label:"Удалить",action:()=>le(t.uuid)}]}};return ee(()=>{try{const n=sessionStorage.getItem("unlockedFolders");if(n){const t=JSON.parse(n);y.value=new Set(t)}}catch(n){console.error("Ошибка загрузки разблокированных папок:",n)}M()}),(n,t)=>(i(),p("div",ls,[e("div",as,[t[12]||(t[12]=e("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Файловый менеджер ",-1)),e("div",ns,[e("button",{onClick:G,disabled:s.value,class:"inline-flex items-center gap-2 rounded-md border border-meta-3 bg-transparent px-4 py-2.5 text-sm font-medium text-meta-3 hover:bg-meta-3 hover:text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",title:"Синхронизировать файлы и папки из storage/uploads"},[(i(),p("svg",{class:F(["h-5 w-5",{"animate-spin":s.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),V(" "+$(s.value?"Синхронизация...":"Синхронизировать"),1)],8,is),e("button",{onClick:t[0]||(t[0]=m=>o.value=!0),class:"inline-flex items-center gap-2 rounded-md border border-primary bg-transparent px-4 py-2.5 text-sm font-medium text-primary hover:bg-primary hover:text-white transition-all duration-200"},[...t[10]||(t[10]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})],-1),V(" Создать папку ",-1)])]),e("button",{onClick:t[1]||(t[1]=m=>a.value=!0),class:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2.5 text-sm font-medium text-white hover:bg-opacity-90 transition-all duration-200"},[S(Fe,{class:"h-5 w-5"}),t[11]||(t[11]=V(" Загрузить файлы ",-1))])])]),S(St,{path:D.value,"current-folder-id":A.value,onNavigate:X},null,8,["path","current-folder-id"]),e("div",ds,[e("div",us,[v.value?(i(),p("div",cs,[...t[13]||(t[13]=[e("div",{class:"h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"},null,-1)])])):r.value.length===0&&l.value.length===0?(i(),p("div",ms,[...t[14]||(t[14]=[e("svg",{class:"mx-auto h-16 w-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})],-1),e("p",{class:"text-gray-500 dark:text-gray-400"}," Папка пуста. Создайте подпапку или загрузите файлы. ",-1)])])):(i(),p("div",ps,[(i(!0),p(R,null,q(r.value,m=>(i(),p("div",{key:"folder-"+m.id,onDblclick:P=>X(m.id),onContextmenu:H(P=>we(P,m),["prevent"]),class:"group relative rounded-lg border border-stroke dark:border-strokedark p-4 hover:border-primary hover:shadow-lg transition-all duration-200 cursor-pointer"},[e("div",fs,[e("div",gs,[t[16]||(t[16]=e("svg",{class:"h-16 w-16",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})],-1)),m.passwordHash?(i(),p("svg",bs,[...t[15]||(t[15]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"},null,-1)])])):B("",!0)]),e("p",{class:"text-sm font-medium text-black dark:text-white text-center truncate w-full",title:m.name},$(m.name),9,xs),m.isSystem?(i(),p("span",ys," Системная ")):B("",!0)])],40,vs))),128)),(i(!0),p(R,null,q(l.value,m=>(i(),p("div",{key:"file-"+m.uuid,onDblclick:P=>re(m),onContextmenu:H(P=>$e(P,m),["prevent"]),class:"group relative rounded-lg border border-stroke dark:border-strokedark p-4 hover:border-primary hover:shadow-lg transition-all duration-200 cursor-pointer"},[e("div",ks,[fe(m.mimeType)?(i(),p("img",{key:0,src:m.url,alt:m.filename,class:"w-full h-full object-cover"},null,8,ws)):(i(),I(ue,{key:1,"mime-type":m.mimeType,extension:m.extension,size:"xl"},null,8,["mime-type","extension"]))]),e("div",null,[e("p",{class:"text-sm font-medium text-black dark:text-white truncate mb-1",title:m.filename},$(m.filename),9,$s),e("p",Cs,$(Q(k)(m.sizeBytes)),1)]),e("div",_s,[e("button",{onClick:H(P=>le(m.uuid),["stop"]),class:"p-1.5 rounded bg-white dark:bg-gray-800 text-red-500 hover:bg-red-500 hover:text-white shadow transition-colors",title:"Удалить"},[S(He,{class:"h-4 w-4"})],8,Ms)])],40,hs))),128))]))])]),S(Pt,{"is-open":o.value,"parent-id":A.value,onClose:t[2]||(t[2]=m=>o.value=!1),onCreated:me},null,8,["is-open","parent-id"]),S(K,{"is-open":a.value,title:"Загрузить файлы",size:"lg",onClose:t[3]||(t[3]=m=>a.value=!1)},{default:j(()=>[S(et,{category:"other","folder-id":A.value,accept:"*/*","max-size-mb":50,multiple:!0,onUploaded:pe,onError:ve},null,8,["folder-id"])]),_:1},8,["is-open"]),W.value?(i(),I($t,{key:0,"is-open":c.value,file:W.value,onClose:t[4]||(t[4]=m=>c.value=!1)},null,8,["is-open","file"])):B("",!0),S(Dt,{"is-open":C.value,"current-name":O.value?.name||"",title:O.value?.type==="folder"?"Переименовать папку":"Переименовать файл",onClose:t[5]||(t[5]=m=>C.value=!1),onSubmit:be},null,8,["is-open","current-name","title"]),U.value?(i(),I(Jt,{key:1,"is-open":_.value,"folder-id":U.value.id,onClose:t[6]||(t[6]=m=>_.value=!1),onSubmit:ye},null,8,["is-open","folder-id"])):B("",!0),w.value?(i(),I(es,{key:2,ref_key:"unlockModalRef",ref:h,"is-open":L.value,"folder-id":w.value.id,onClose:t[7]||(t[7]=m=>L.value=!1),onSubmit:ke},null,8,["is-open","folder-id"])):B("",!0),S(rs,{visible:z.value.visible,position:z.value.position,items:z.value.items,onClose:t[8]||(t[8]=m=>z.value.visible=!1)},null,8,["visible","position","items"])]))}});export{Ps as default};
