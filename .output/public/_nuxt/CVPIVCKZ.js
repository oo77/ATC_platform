import{r as b,f as gt,v as It,g as Ht,L as Tt,c as g,a as t,m as yt,h as K,F as ct,j as pt,n as at,x as Dt,G as Gt,A as Nt,t as R,o as c,l as ut,z as rt,Y as qt,d as it,I as Ot,i as A,k as Ft,b as Mt,w as Zt,K as Wt,X as Qt,W as _t}from"./GLV6bXvn.js";import{u as $t}from"./DlZaGH1J.js";import{_ as te}from"./BKg9m4wI.js";import{A as ee,p as le}from"./CqdpKe-B.js";import{u as Vt}from"./DVL-QcDc.js";import{_ as zt}from"./DlAUqK2U.js";import{s as ne}from"./CRUGdXr-.js";import"./CFbq0LVm.js";const Kt={A4_portrait:{width:794,height:1123},A4_landscape:{width:1123,height:794},letter_portrait:{width:816,height:1056},letter_landscape:{width:1056,height:816}},ht=[{key:"student.fullName",label:"ФИО студента",placeholder:"Иванов Иван Иванович"},{key:"student.shortName",label:"ФИО сокращённо",placeholder:"Иванов И.И."},{key:"student.firstLastName",label:"ФИ (IVANOV IVAN)",placeholder:"IVANOV IVAN"},{key:"student.lastName",label:"Фамилия",placeholder:"Иванов"},{key:"student.firstName",label:"Имя",placeholder:"Иван"},{key:"student.middleName",label:"Отчество",placeholder:"Иванович"},{key:"student.organization",label:"Организация",placeholder:'ООО "Компания"'},{key:"student.organizationUz",label:"Организация (UZ)",placeholder:'MChJ "Kompaniya"'},{key:"student.organizationEn",label:"Organization (EN)",placeholder:'LLC "Company"'},{key:"student.organizationRu",label:"Организация (RU)",placeholder:'ООО "Компания"'},{key:"student.position",label:"Должность",placeholder:"Инженер"},{key:"student.department",label:"Отдел",placeholder:"Отдел разработки"},{key:"student.pinfl",label:"ПИНФЛ",placeholder:"12345678901234"},{key:"course.name",label:"Название курса",placeholder:"Охрана труда и техника безопасности"},{key:"course.shortName",label:"Краткое название курса",placeholder:"ОТиТБ"},{key:"course.code",label:"Код курса",placeholder:"OT-001"},{key:"course.totalHours",label:"Общее кол-во часов",placeholder:"72"},{key:"course.description",label:"Описание курса",placeholder:"Курс по охране труда..."},{key:"group.code",label:"Код группы",placeholder:"GR-2025-001"},{key:"group.startDate",label:"Дата начала обучения",placeholder:"01.12.2025"},{key:"group.endDate",label:"Дата окончания обучения",placeholder:"26.12.2025"},{key:"group.classroom",label:"Аудитория",placeholder:"Ауд. 101"},{key:"certificate.number",label:"Номер сертификата",placeholder:"CERT25-0001"},{key:"certificate.issueDate",label:"Дата выдачи",placeholder:"26.12.2025"},{key:"certificate.issueDateFormatted",label:"Дата выдачи (прописью)",placeholder:"26 декабря 2025 года"},{key:"instructor.fullName",label:"ФИО инструктора",placeholder:"Петров Петр Петрович"},{key:"instructor.shortName",label:"ФИО инструктора (сокращённо)",placeholder:"Петров П.П."},{key:"instructor.position",label:"Должность инструктора",placeholder:"Инструктор-методист"}],oe=ee;function Et(){return`el_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Lt(l="A4_landscape"){const h=Kt[l];return{version:"1.0",layout:l,width:h.width,height:h.height,background:{type:"color",value:"#FFFFFF"},elements:[]}}function ie(l={}){return{id:Et(),type:"text",x:l.x??100,y:l.y??100,width:l.width??300,height:l.height??50,rotation:l.rotation??0,zIndex:l.zIndex??1,locked:l.locked??!1,content:l.content??"Новый текст",fontFamily:l.fontFamily??"Inter",fontSize:l.fontSize??24,fontWeight:l.fontWeight??"normal",fontStyle:l.fontStyle??"normal",textAlign:l.textAlign??"center",color:l.color??"#000000",lineHeight:l.lineHeight??1.2,backgroundColor:l.backgroundColor??"transparent"}}function ae(l,h={}){const x=ht.find(I=>I.key===l);return{id:Et(),type:"variable",x:h.x??100,y:h.y??100,width:h.width??350,height:h.height??40,rotation:h.rotation??0,zIndex:h.zIndex??1,locked:h.locked??!1,variableKey:l,placeholder:x?.placeholder??"[Переменная]",fontFamily:h.fontFamily??"Inter",fontSize:h.fontSize??20,fontWeight:h.fontWeight??"bold",fontStyle:h.fontStyle??"normal",textAlign:h.textAlign??"center",color:h.color??"#1E3A5F",lineHeight:h.lineHeight??1.2,backgroundColor:h.backgroundColor??"transparent"}}function se(l,h={}){return{id:Et(),type:"image",x:h.x??50,y:h.y??50,width:h.width??150,height:h.height??150,rotation:h.rotation??0,zIndex:h.zIndex??0,locked:h.locked??!1,src:l,objectFit:h.objectFit??"contain",opacity:h.opacity??1}}function re(l={}){return{id:Et(),type:"qr",x:l.x??50,y:l.y??50,width:l.width??100,height:l.height??100,rotation:l.rotation??0,zIndex:l.zIndex??1,locked:l.locked??!1,dataSource:l.dataSource??"certificate_url",customData:l.customData,size:l.size??100,color:l.color??"#000000",backgroundColor:l.backgroundColor??"#FFFFFF"}}function de(l,h={}){return{id:Et(),type:"shape",x:h.x??100,y:h.y??100,width:h.width??200,height:h.height??100,rotation:h.rotation??0,zIndex:h.zIndex??0,locked:h.locked??!1,shapeType:l,fillColor:h.fillColor??"transparent",strokeColor:h.strokeColor??"#000000",strokeWidth:h.strokeWidth??2}}function ue(){const l=b(Lt()),h=b(new Set),x=b([]),I=b(-1),Y=50,H=b(!1),B=b(!1),U=b(!1),W=b(1),X=.25,D=2,M=gt(()=>h.value.size===0?[]:l.value.elements.filter(r=>h.value.has(r.id))),N=gt(()=>{const r=Array.from(h.value);return r.length>0?r[0]:null}),O=gt(()=>N.value?l.value.elements.find(r=>r.id===N.value)??null:null),T=gt(()=>I.value>0),P=gt(()=>I.value<x.value.length-1),tt=gt(()=>l.value.elements.length);function L(){I.value<x.value.length-1&&(x.value=x.value.slice(0,I.value+1)),x.value.push(JSON.parse(JSON.stringify(l.value))),x.value.length>Y?x.value.shift():I.value++,H.value=!0}function Q(){T.value&&(I.value--,l.value=JSON.parse(JSON.stringify(x.value[I.value])),H.value=!0)}function _(){P.value&&(I.value++,l.value=JSON.parse(JSON.stringify(x.value[I.value])),H.value=!0)}function V(r){r?l.value=JSON.parse(JSON.stringify(r)):l.value=Lt(),x.value=[JSON.parse(JSON.stringify(l.value))],I.value=0,h.value.clear(),H.value=!1}function lt(r,y,d){if(L(),r==="custom")l.value.layout=r,y!==void 0&&d!==void 0&&(l.value.width=y,l.value.height=d);else{const v=Kt[r];l.value.layout=r,l.value.width=v.width,l.value.height=v.height}}function nt(r,y){L(),l.value.width=Math.max(200,Math.min(5e3,r)),l.value.height=Math.max(200,Math.min(5e3,y)),l.value.layout!=="custom"&&(l.value.layout="custom")}function w(r){L(),l.value.background=r}function k(r){L();const y=Math.max(0,...l.value.elements.map(d=>d.zIndex));r.zIndex=y+1,l.value.elements.push(r),h.value.clear(),h.value.add(r.id)}function a(r,y){const d=l.value.elements.findIndex(v=>v.id===r);d!==-1&&(L(),l.value.elements[d]={...l.value.elements[d],...y})}function e(r){L(),l.value.elements=l.value.elements.filter(y=>y.id!==r),h.value.has(r)&&h.value.delete(r)}function i(){N.value&&e(N.value)}function G(r){const y=l.value.elements.find(v=>v.id===r);if(!y)return;const d={...JSON.parse(JSON.stringify(y)),id:Et(),x:y.x+20,y:y.y+20};k(d)}function dt(r){const y=Math.max(...l.value.elements.map(d=>d.zIndex));a(r,{zIndex:y+1})}function z(r){const y=Math.min(...l.value.elements.map(d=>d.zIndex));a(r,{zIndex:y-1})}function o(r){const y=l.value.elements.find(d=>d.id===r);y&&a(r,{locked:!y.locked})}function F(r,y=!1){if(r===null){h.value.clear();return}y?h.value.has(r)?h.value.delete(r):h.value.add(r):(h.value.clear(),h.value.add(r))}function j(r){h.value.clear(),r.forEach(y=>h.value.add(y))}function ot(r){r.forEach(y=>h.value.add(y))}function xt(){h.value.clear()}function bt(r,y){L(),r.forEach(d=>{const v=l.value.elements.findIndex(E=>E.id===d);v!==-1&&!l.value.elements[v].locked&&(l.value.elements[v]={...l.value.elements[v],...y})})}function st(r,y){if(r.length<2)return;const d=l.value.elements.filter(E=>r.includes(E.id)&&!E.locked);if(d.length<2)return;L();let v;switch(y){case"left":v=Math.min(...d.map(C=>C.x)),d.forEach(C=>{a(C.id,{x:v})});break;case"center-h":const E=d.reduce((C,q)=>C+q.x+q.width/2,0)/d.length;d.forEach(C=>{a(C.id,{x:E-C.width/2})});break;case"right":v=Math.max(...d.map(C=>C.x+C.width)),d.forEach(C=>{a(C.id,{x:v-C.width})});break;case"top":v=Math.min(...d.map(C=>C.y)),d.forEach(C=>{a(C.id,{y:v})});break;case"center-v":const J=d.reduce((C,q)=>C+q.y+q.height/2,0)/d.length;d.forEach(C=>{a(C.id,{y:J-C.height/2})});break;case"bottom":v=Math.max(...d.map(C=>C.y+C.height)),d.forEach(C=>{a(C.id,{y:v-C.height})});break}}function kt(r,y){if(r.length<3)return;const d=l.value.elements.filter(v=>r.includes(v.id)&&!v.locked).sort((v,E)=>y==="horizontal"?v.x-E.x:v.y-E.y);if(!(d.length<3))if(L(),y==="horizontal"){const v=d[0],C=(d[d.length-1].x-(v.x+v.width))/(d.length-1);let q=v.x+v.width+C;for(let Z=1;Z<d.length-1;Z++)a(d[Z].id,{x:q}),q+=d[Z].width+C}else{const v=d[0],C=(d[d.length-1].y-(v.y+v.height))/(d.length-1);let q=v.y+v.height+C;for(let Z=1;Z<d.length-1;Z++)a(d[Z].id,{y:q}),q+=d[Z].height+C}}function mt(r){W.value=Math.min(D,Math.max(X,r))}function wt(){mt(W.value+.1)}function ft(){mt(W.value-.1)}function s(){W.value=1}function m(r,y){const d=l.value.elements.find(C=>C.id===r);if(!d||d.locked)return;const v=l.value.width,E=l.value.height;let J={};switch(y){case"left":J.x=0;break;case"center-h":J.x=(v-d.width)/2;break;case"right":J.x=v-d.width;break;case"top":J.y=0;break;case"center-v":J.y=(E-d.height)/2;break;case"bottom":J.y=E-d.height;break}a(r,J)}function n(){return JSON.parse(JSON.stringify(l.value))}async function u(r,y){const d=new FormData;d.append("background",r);const{authFetch:v}=$t(),E=await v(`/api/certificates/templates/${y}/upload-background`,{method:"POST",body:d});if(!E.success)throw new Error(E.message||"Ошибка загрузки изображения");return E.url}async function $(r,y){const d=new FormData;d.append("image",r);const{authFetch:v}=$t(),E=await v(`/api/certificates/templates/${y}/upload-image`,{method:"POST",body:d});if(!E.success)throw new Error(E.message||"Ошибка загрузки изображения");return E.url}return{templateData:l,selectedElementId:N,selectedElement:O,selectedElementIds:h,selectedElements:M,zoom:W,isDirty:H,isLoading:B,isSaving:U,canUndo:T,canRedo:P,elementsCount:tt,initTemplate:V,exportData:n,undo:Q,redo:_,saveToHistory:L,setLayout:lt,setCustomDimensions:nt,setBackground:w,addElement:k,updateElement:a,updateMultipleElements:bt,deleteElement:e,deleteSelectedElement:i,duplicateElement:G,bringToFront:dt,sendToBack:z,toggleLock:o,selectElement:F,selectMultipleElements:j,addToSelection:ot,clearSelection:xt,alignElement:m,alignMultipleElements:st,distributeElements:kt,setZoom:mt,zoomIn:wt,zoomOut:ft,resetZoom:s,uploadBackgroundImage:u,uploadElementImage:$,minZoom:X,maxZoom:D}}function S(){return"el_"+Math.random().toString(36).substring(2,11)}function Rt(){return{layout:"A4_landscape",width:1123,height:794,background:{type:"color",value:"#FFF8E7"},elements:[{id:S(),type:"shape",x:30,y:30,width:1063,height:734,rotation:0,zIndex:1,locked:!1,shapeType:"rectangle",fillColor:"transparent",strokeColor:"#D4A853",strokeWidth:3},{id:S(),type:"shape",x:45,y:45,width:1033,height:704,rotation:0,zIndex:2,locked:!1,shapeType:"rectangle",fillColor:"transparent",strokeColor:"#D4A853",strokeWidth:1},{id:S(),type:"text",x:1123/2-200,y:100,width:400,height:60,rotation:0,zIndex:10,locked:!1,content:"СЕРТИФИКАТ",fontFamily:"Georgia",fontSize:48,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#8B6914",lineHeight:1.2},{id:S(),type:"text",x:1123/2-200,y:165,width:400,height:30,rotation:0,zIndex:11,locked:!1,content:"о повышении квалификации",fontFamily:"Georgia",fontSize:18,fontWeight:"normal",fontStyle:"italic",textAlign:"center",color:"#666666",lineHeight:1.2},{id:S(),type:"variable",x:1123/2-300,y:240,width:600,height:50,rotation:0,zIndex:12,locked:!1,variableKey:"student.fullName",placeholder:"Иванов Иван Иванович",fontFamily:"Georgia",fontSize:32,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"shape",x:200,y:295,width:723,height:2,rotation:0,zIndex:13,locked:!1,shapeType:"line",fillColor:"transparent",strokeColor:"#D4A853",strokeWidth:1},{id:S(),type:"text",x:1123/2-200,y:320,width:400,height:30,rotation:0,zIndex:14,locked:!1,content:"успешно завершил(а) обучение по программе",fontFamily:"Georgia",fontSize:16,fontWeight:"normal",fontStyle:"normal",textAlign:"center",color:"#444444",lineHeight:1.3},{id:S(),type:"variable",x:100,y:370,width:923,height:60,rotation:0,zIndex:15,locked:!1,variableKey:"course.name",placeholder:"Название курса повышения квалификации",fontFamily:"Georgia",fontSize:22,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.3},{id:S(),type:"text",x:1123/2-150,y:440,width:100,height:30,rotation:0,zIndex:16,locked:!1,content:"в объёме",fontFamily:"Georgia",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"right",color:"#666666",lineHeight:1.3},{id:S(),type:"variable",x:1123/2-40,y:440,width:50,height:30,rotation:0,zIndex:17,locked:!1,variableKey:"course.totalHours",placeholder:"72",fontFamily:"Georgia",fontSize:18,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.3},{id:S(),type:"text",x:1123/2+20,y:440,width:150,height:30,rotation:0,zIndex:18,locked:!1,content:"академических часов",fontFamily:"Georgia",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#666666",lineHeight:1.3},{id:S(),type:"text",x:80,y:674,width:200,height:25,rotation:0,zIndex:20,locked:!1,content:"Сертификат №",fontFamily:"Georgia",fontSize:12,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#666666",lineHeight:1.2},{id:S(),type:"variable",x:80,y:699,width:200,height:25,rotation:0,zIndex:21,locked:!1,variableKey:"certificate.number",placeholder:"ATC24_IT_0001",fontFamily:"Georgia",fontSize:14,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"text",x:1123/2-100,y:674,width:200,height:25,rotation:0,zIndex:22,locked:!1,content:"Дата выдачи",fontFamily:"Georgia",fontSize:12,fontWeight:"normal",fontStyle:"normal",textAlign:"center",color:"#666666",lineHeight:1.2},{id:S(),type:"variable",x:1123/2-100,y:699,width:200,height:25,rotation:0,zIndex:23,locked:!1,variableKey:"certificate.issueDateFormatted",placeholder:"26 декабря 2024 года",fontFamily:"Georgia",fontSize:14,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"qr",x:973,y:644,width:100,height:100,rotation:0,zIndex:30,locked:!1,dataSource:"certificate_url",size:100,color:"#1a1a1a",backgroundColor:"#FFFFFF"}]}}function ce(){return{layout:"A4_landscape",width:1123,height:794,background:{type:"color",value:"#F8FAFC"},elements:[{id:S(),type:"shape",x:0,y:0,width:80,height:794,rotation:0,zIndex:1,locked:!1,shapeType:"rectangle",fillColor:"#4F46E5",strokeColor:"transparent",strokeWidth:0},{id:S(),type:"shape",x:923,y:-100,width:300,height:300,rotation:0,zIndex:2,locked:!1,shapeType:"circle",fillColor:"#EEF2FF",strokeColor:"transparent",strokeWidth:0},{id:S(),type:"text",x:120,y:80,width:500,height:50,rotation:0,zIndex:10,locked:!1,content:"CERTIFICATE",fontFamily:"Inter",fontSize:42,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1E293B",lineHeight:1.2},{id:S(),type:"text",x:120,y:130,width:300,height:30,rotation:0,zIndex:11,locked:!1,content:"OF COMPLETION",fontFamily:"Inter",fontSize:16,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#64748B",lineHeight:1.2},{id:S(),type:"text",x:120,y:200,width:400,height:25,rotation:0,zIndex:12,locked:!1,content:"This is to certify that",fontFamily:"Inter",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#94A3B8",lineHeight:1.2},{id:S(),type:"variable",x:120,y:230,width:600,height:45,rotation:0,zIndex:13,locked:!1,variableKey:"student.fullName",placeholder:"Иванов Иван Иванович",fontFamily:"Inter",fontSize:36,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1E293B",lineHeight:1.2},{id:S(),type:"shape",x:120,y:285,width:600,height:3,rotation:0,zIndex:14,locked:!1,shapeType:"rectangle",fillColor:"#E2E8F0",strokeColor:"transparent",strokeWidth:0},{id:S(),type:"text",x:120,y:310,width:600,height:25,rotation:0,zIndex:15,locked:!1,content:"has successfully completed the training program",fontFamily:"Inter",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#94A3B8",lineHeight:1.2},{id:S(),type:"variable",x:120,y:345,width:823,height:60,rotation:0,zIndex:16,locked:!1,variableKey:"course.name",placeholder:"Название курса",fontFamily:"Inter",fontSize:24,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#4F46E5",lineHeight:1.3},{id:S(),type:"variable",x:120,y:420,width:60,height:35,rotation:0,zIndex:17,locked:!1,variableKey:"course.totalHours",placeholder:"72",fontFamily:"Inter",fontSize:28,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1E293B",lineHeight:1.2},{id:S(),type:"text",x:180,y:428,width:200,height:25,rotation:0,zIndex:18,locked:!1,content:"hours",fontFamily:"Inter",fontSize:16,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#64748B",lineHeight:1.2},{id:S(),type:"text",x:120,y:694,width:100,height:20,rotation:0,zIndex:20,locked:!1,content:"DATE",fontFamily:"Inter",fontSize:10,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#94A3B8",lineHeight:1.2},{id:S(),type:"variable",x:120,y:714,width:200,height:25,rotation:0,zIndex:21,locked:!1,variableKey:"certificate.issueDate",placeholder:"26.12.2024",fontFamily:"Inter",fontSize:16,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1E293B",lineHeight:1.2},{id:S(),type:"text",x:350,y:694,width:100,height:20,rotation:0,zIndex:22,locked:!1,content:"CERTIFICATE NO.",fontFamily:"Inter",fontSize:10,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#94A3B8",lineHeight:1.2},{id:S(),type:"variable",x:350,y:714,width:250,height:25,rotation:0,zIndex:23,locked:!1,variableKey:"certificate.number",placeholder:"ATC24_IT_0001",fontFamily:"Inter",fontSize:16,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1E293B",lineHeight:1.2},{id:S(),type:"qr",x:963,y:634,width:120,height:120,rotation:0,zIndex:30,locked:!1,dataSource:"certificate_url",size:120,color:"#4F46E5",backgroundColor:"#FFFFFF"}]}}function he(){return{layout:"A4_landscape",width:1123,height:794,background:{type:"color",value:"#FFFFFF"},elements:[{id:S(),type:"shape",x:100,y:60,width:923,height:2,rotation:0,zIndex:1,locked:!1,shapeType:"rectangle",fillColor:"#1a1a1a",strokeColor:"transparent",strokeWidth:0},{id:S(),type:"text",x:100,y:100,width:923,height:50,rotation:0,zIndex:10,locked:!1,content:"Сертификат",fontFamily:"Inter",fontSize:36,fontWeight:"normal",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"variable",x:100,y:220,width:923,height:50,rotation:0,zIndex:11,locked:!1,variableKey:"student.fullName",placeholder:"Иванов Иван Иванович",fontFamily:"Inter",fontSize:42,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"text",x:100,y:310,width:923,height:30,rotation:0,zIndex:12,locked:!1,content:"прошёл(а) обучение по программе",fontFamily:"Inter",fontSize:16,fontWeight:"normal",fontStyle:"normal",textAlign:"center",color:"#666666",lineHeight:1.2},{id:S(),type:"variable",x:100,y:360,width:923,height:60,rotation:0,zIndex:13,locked:!1,variableKey:"course.name",placeholder:"Название курса",fontFamily:"Inter",fontSize:24,fontWeight:"bold",fontStyle:"normal",textAlign:"center",color:"#1a1a1a",lineHeight:1.3},{id:S(),type:"text",x:100,y:440,width:923,height:25,rotation:0,zIndex:14,locked:!1,content:"Объём:",fontFamily:"Inter",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"center",color:"#999999",lineHeight:1.2},{id:S(),type:"variable",x:1123/2+30,y:440,width:100,height:25,rotation:0,zIndex:15,locked:!1,variableKey:"course.totalHours",placeholder:"72",fontFamily:"Inter",fontSize:14,fontWeight:"bold",fontStyle:"normal",textAlign:"left",color:"#1a1a1a",lineHeight:1.2},{id:S(),type:"shape",x:100,y:694,width:923,height:1,rotation:0,zIndex:20,locked:!1,shapeType:"rectangle",fillColor:"#E5E7EB",strokeColor:"transparent",strokeWidth:0},{id:S(),type:"variable",x:100,y:714,width:200,height:25,rotation:0,zIndex:21,locked:!1,variableKey:"certificate.issueDate",placeholder:"26.12.2024",fontFamily:"Inter",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"left",color:"#666666",lineHeight:1.2},{id:S(),type:"variable",x:823,y:714,width:200,height:25,rotation:0,zIndex:22,locked:!1,variableKey:"certificate.number",placeholder:"ATC24_IT_0001",fontFamily:"Inter",fontSize:14,fontWeight:"normal",fontStyle:"normal",textAlign:"right",color:"#666666",lineHeight:1.2},{id:S(),type:"qr",x:1123/2-40,y:699,width:80,height:80,rotation:0,zIndex:30,locked:!1,dataSource:"certificate_url",size:80,color:"#1a1a1a",backgroundColor:"#FFFFFF"}]}}function ve(l){switch(l){case"classic":return Rt();case"modern":return ce();case"minimal":return he();default:return Rt()}}const ge={class:"editor-toolbar"},fe={class:"toolbar-section"},pe={class:"tool-dropdown"},me={key:0,class:"dropdown-menu"},we={class:"group-title"},ye=["onClick"],xe={class:"var-label"},be={class:"var-placeholder"},ke={class:"tool-dropdown"},Ce={key:0,class:"dropdown-menu shapes-menu"},Ee={class:"toolbar-section"},Se={class:"layout-options"},$e={class:"custom-size-section"},Ie={class:"custom-checkbox"},ze={key:0,class:"custom-size-panel"},Me={class:"custom-size-inputs"},Fe={class:"size-input-group"},Ae={class:"size-input-group"},Be=["disabled"],De={class:"toolbar-section"},Te={class:"background-options"},We={class:"toolbar-section presets-section"},He=It({__name:"EditorToolbar",props:{currentLayout:{},templateId:{}},emits:["add-text","add-variable","add-image","add-qr","add-shape","set-layout","set-background","apply-preset"],setup(l,{emit:h}){const x=l,I=h,{authFetch:Y}=$t(),{error:H}=Vt(),B=b(!1),U=b(!1),W=b(null),X=b(null),D=b(!1),M=b(!1),N=b(!1),O=b(794),T=b(1123),P=b(!1),tt=gt(()=>[{name:"Студент",variables:ht.filter(z=>z.key.startsWith("student."))},{name:"Курс",variables:ht.filter(z=>z.key.startsWith("course."))},{name:"Группа",variables:ht.filter(z=>z.key.startsWith("group."))},{name:"Сертификат",variables:ht.filter(z=>z.key.startsWith("certificate."))},{name:"Инструктор",variables:ht.filter(z=>z.key.startsWith("instructor."))}]);function L(){B.value=!B.value,U.value=!1}function Q(){U.value=!U.value,B.value=!1}function _(z){I("add-variable",z),B.value=!1}function V(z){I("add-shape",z),U.value=!1}function lt(){W.value?.click()}async function nt(z){const o=z.target,F=o.files?.[0];if(F){D.value=!0;try{const j=new FormData;j.append("image",F);const ot=await Y(`/api/certificates/templates/${x.templateId}/upload-image`,{method:"POST",body:j});if(ot.success)I("add-image",ot.url);else throw new Error(ot.message||"Ошибка загрузки изображения")}catch(j){console.error("Error uploading image:",j),H(j.message||"Ошибка загрузки изображения")}finally{D.value=!1,o.value=""}}}function w(){X.value?.click()}async function k(z){const o=z.target,F=o.files?.[0];if(F){M.value=!0;try{const j=new FormData;j.append("background",F);const ot=await Y(`/api/certificates/templates/${x.templateId}/upload-background`,{method:"POST",body:j});if(ot.success)I("set-background",{type:"image",value:ot.url});else throw new Error(ot.message||"Ошибка загрузки фона")}catch(j){console.error("Error uploading background:",j),H(j.message||"Ошибка загрузки фона")}finally{M.value=!1,o.value=""}}}function a(z){I("set-background",{type:"color",value:z})}function e(z){const o=ve(z);I("apply-preset",o)}function i(){const z=O.value,o=T.value;P.value=z>=200&&z<=5e3&&o>=200&&o<=5e3}function G(){if(!P.value)return;const z=Math.max(200,Math.min(5e3,O.value)),o=Math.max(200,Math.min(5e3,T.value));I("set-layout","custom",z,o)}function dt(z){z.target.closest(".tool-dropdown")||(B.value=!1,U.value=!1)}return Ht(()=>{document.addEventListener("click",dt)}),Tt(()=>{document.removeEventListener("click",dt)}),(z,o)=>(c(),g("div",ge,[t("div",fe,[o[26]||(o[26]=t("h3",{class:"section-title"},"Элементы",-1)),t("button",{class:"tool-btn",onClick:o[0]||(o[0]=F=>z.$emit("add-text")),title:"Добавить текст"},[...o[17]||(o[17]=[yt('<div class="tool-icon" data-v-9aa973d3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9aa973d3><polyline points="4,7 4,4 20,4 20,7" data-v-9aa973d3></polyline><line x1="9" y1="20" x2="15" y2="20" data-v-9aa973d3></line><line x1="12" y1="4" x2="12" y2="20" data-v-9aa973d3></line></svg></div><span class="tool-label" data-v-9aa973d3>Текст</span>',2)])]),t("div",pe,[t("button",{class:"tool-btn",onClick:L,title:"Добавить переменную"},[...o[18]||(o[18]=[yt('<div class="tool-icon variable-icon" data-v-9aa973d3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9aa973d3><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-9aa973d3></path><path d="M8 10h8" data-v-9aa973d3></path><path d="M8 14h4" data-v-9aa973d3></path></svg></div><span class="tool-label" data-v-9aa973d3>Переменная</span><svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-9aa973d3><path d="m6 9 6 6 6-6" data-v-9aa973d3></path></svg>',3)])]),B.value?(c(),g("div",me,[o[19]||(o[19]=t("div",{class:"dropdown-header"},"Выберите переменную",-1)),(c(!0),g(ct,null,pt(tt.value,F=>(c(),g("div",{class:"dropdown-group",key:F.name},[t("div",we,R(F.name),1),(c(!0),g(ct,null,pt(F.variables,j=>(c(),g("button",{key:j.key,class:"dropdown-item",onClick:ot=>_(j.key)},[t("span",xe,R(j.label),1),t("span",be,R(j.placeholder),1)],8,ye))),128))]))),128))])):K("",!0)]),t("button",{class:"tool-btn",onClick:lt,title:"Добавить изображение"},[...o[20]||(o[20]=[yt('<div class="tool-icon" data-v-9aa973d3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9aa973d3><rect width="18" height="18" x="3" y="3" rx="2" ry="2" data-v-9aa973d3></rect><circle cx="9" cy="9" r="2" data-v-9aa973d3></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" data-v-9aa973d3></path></svg></div><span class="tool-label" data-v-9aa973d3>Изображение</span>',2)])]),t("input",{ref_key:"imageInputRef",ref:W,type:"file",accept:"image/*",class:"hidden-input",onChange:nt},null,544),t("button",{class:"tool-btn",onClick:o[1]||(o[1]=F=>z.$emit("add-qr")),title:"Добавить QR-код"},[...o[21]||(o[21]=[yt('<div class="tool-icon" data-v-9aa973d3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9aa973d3><rect width="5" height="5" x="3" y="3" rx="1" data-v-9aa973d3></rect><rect width="5" height="5" x="16" y="3" rx="1" data-v-9aa973d3></rect><rect width="5" height="5" x="3" y="16" rx="1" data-v-9aa973d3></rect><path d="M21 16h-3a2 2 0 0 0-2 2v3" data-v-9aa973d3></path><path d="M21 21v.01" data-v-9aa973d3></path><path d="M12 7v3a2 2 0 0 1-2 2H7" data-v-9aa973d3></path><path d="M3 12h.01" data-v-9aa973d3></path><path d="M12 3h.01" data-v-9aa973d3></path><path d="M12 16v.01" data-v-9aa973d3></path><path d="M16 12h1" data-v-9aa973d3></path><path d="M21 12v.01" data-v-9aa973d3></path><path d="M12 21v-1" data-v-9aa973d3></path></svg></div><span class="tool-label" data-v-9aa973d3>QR-код</span>',2)])]),t("div",ke,[t("button",{class:"tool-btn",onClick:Q,title:"Добавить фигуру"},[...o[22]||(o[22]=[yt('<div class="tool-icon" data-v-9aa973d3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9aa973d3><rect width="14" height="14" x="5" y="5" rx="2" data-v-9aa973d3></rect></svg></div><span class="tool-label" data-v-9aa973d3>Фигуры</span><svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-9aa973d3><path d="m6 9 6 6 6-6" data-v-9aa973d3></path></svg>',3)])]),U.value?(c(),g("div",Ce,[t("button",{class:"dropdown-item shape-item",onClick:o[2]||(o[2]=F=>V("rectangle"))},[...o[23]||(o[23]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"18",height:"14",x:"3",y:"5",rx:"2"})],-1),t("span",null,"Прямоугольник",-1)])]),t("button",{class:"dropdown-item shape-item",onClick:o[3]||(o[3]=F=>V("circle"))},[...o[24]||(o[24]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"12",cy:"12",r:"9"})],-1),t("span",null,"Круг",-1)])]),t("button",{class:"dropdown-item shape-item",onClick:o[4]||(o[4]=F=>V("line"))},[...o[25]||(o[25]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M5 19L19 5"})],-1),t("span",null,"Линия",-1)])])])):K("",!0)])]),t("div",Ee,[o[33]||(o[33]=t("h3",{class:"section-title"},"Макет",-1)),t("div",Se,[t("button",{class:at(["layout-btn",{active:l.currentLayout==="A4_landscape"}]),onClick:o[5]||(o[5]=F=>z.$emit("set-layout","A4_landscape")),title:"A4 альбомная"},[...o[27]||(o[27]=[t("div",{class:"layout-preview landscape"},null,-1),t("span",null,"Альбомная",-1)])],2),t("button",{class:at(["layout-btn",{active:l.currentLayout==="A4_portrait"}]),onClick:o[6]||(o[6]=F=>z.$emit("set-layout","A4_portrait")),title:"A4 книжная"},[...o[28]||(o[28]=[t("div",{class:"layout-preview portrait"},null,-1),t("span",null,"Книжная",-1)])],2)]),t("div",$e,[t("label",Ie,[Dt(t("input",{type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=F=>N.value=F)},null,512),[[Gt,N.value]]),o[29]||(o[29]=t("span",null,"Своя",-1))]),N.value?(c(),g("div",ze,[t("div",Me,[t("div",Fe,[o[30]||(o[30]=t("label",null,"Ширина (px)",-1)),Dt(t("input",{type:"number","onUpdate:modelValue":o[8]||(o[8]=F=>O.value=F),onInput:i,min:"200",max:"5000",placeholder:"794"},null,544),[[Nt,O.value,void 0,{number:!0}]])]),t("div",Ae,[o[31]||(o[31]=t("label",null,"Высота (px)",-1)),Dt(t("input",{type:"number","onUpdate:modelValue":o[9]||(o[9]=F=>T.value=F),onInput:i,min:"200",max:"5000",placeholder:"1123"},null,544),[[Nt,T.value,void 0,{number:!0}]])])]),t("button",{class:"apply-custom-btn",onClick:G,disabled:!P.value}," Сохранить размер ",8,Be),o[32]||(o[32]=t("p",{class:"size-hint"},"Мин: 200px, Макс: 5000px",-1))])):K("",!0)])]),t("div",De,[o[39]||(o[39]=t("h3",{class:"section-title"},"Фон",-1)),t("div",Te,[t("button",{class:"bg-btn",onClick:o[10]||(o[10]=F=>a("#FFFFFF")),title:"Белый фон"},[...o[34]||(o[34]=[t("div",{class:"color-swatch",style:{background:"#ffffff",border:"1px solid #e5e7eb"}},null,-1)])]),t("button",{class:"bg-btn",onClick:o[11]||(o[11]=F=>a("#FFF8E7")),title:"Кремовый фон"},[...o[35]||(o[35]=[t("div",{class:"color-swatch",style:{background:"#fff8e7"}},null,-1)])]),t("button",{class:"bg-btn",onClick:o[12]||(o[12]=F=>a("#F0F9FF")),title:"Голубоватый фон"},[...o[36]||(o[36]=[t("div",{class:"color-swatch",style:{background:"#f0f9ff"}},null,-1)])]),t("button",{class:"bg-btn",onClick:o[13]||(o[13]=F=>a("#F0FDF4")),title:"Зеленоватый фон"},[...o[37]||(o[37]=[t("div",{class:"color-swatch",style:{background:"#f0fdf4"}},null,-1)])]),t("button",{class:"bg-btn upload-bg",onClick:w,title:"Загрузить фон"},[...o[38]||(o[38]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"17 8 12 3 7 8"}),t("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)])])]),t("input",{ref_key:"bgInputRef",ref:X,type:"file",accept:"image/*",class:"hidden-input",onChange:k},null,544)]),t("div",We,[o[43]||(o[43]=t("h3",{class:"section-title"},"Шаблоны",-1)),t("button",{class:"preset-btn",onClick:o[14]||(o[14]=F=>e("classic")),title:"Классический"},[...o[40]||(o[40]=[t("div",{class:"preset-preview classic"},[t("div",{class:"pp-line"}),t("div",{class:"pp-line short"}),t("div",{class:"pp-line"})],-1),t("span",null,"Классический",-1)])]),t("button",{class:"preset-btn",onClick:o[15]||(o[15]=F=>e("modern")),title:"Современный"},[...o[41]||(o[41]=[t("div",{class:"preset-preview modern"},[t("div",{class:"pp-line"}),t("div",{class:"pp-line short"}),t("div",{class:"pp-line"})],-1),t("span",null,"Современный",-1)])]),t("button",{class:"preset-btn",onClick:o[16]||(o[16]=F=>e("minimal")),title:"Минималистичный"},[...o[42]||(o[42]=[t("div",{class:"preset-preview minimal"},[t("div",{class:"pp-line"}),t("div",{class:"pp-line short"})],-1),t("span",null,"Минимальный",-1)])])])]))}}),Ne=Object.assign(zt(He,[["__scopeId","data-v-9aa973d3"]]),{__name:"CertificatesEditorToolbar"}),Le={key:0,class:"guides-layer"},Re={class:"guide-label"},Oe={class:"guide-label"},Ve=["onMousedown","onDblclick"],Ke=["contenteditable","onBlur","onKeydown"],Pe={class:"variable-badge"},je=["src"],Ue=["stroke"],Je=["width","height"],Xe=["width","height","fill","stroke","stroke-width"],Ye=["cx","cy","rx","ry","fill","stroke","stroke-width"],Ge=["x2","y2","stroke","stroke-width"],qe=["onMousedown"],Ze=["onMousedown"],Qe=["onMousedown"],_e=["onMousedown"],tl=["onMousedown"],el=["onMousedown"],ll=["onMousedown"],nl=["onMousedown"],ol={key:6,class:"lock-indicator"},il={key:7,class:"multi-select-indicator"},et=8,al=It({__name:"EditorCanvas",props:{templateData:{},selectedElementIds:{},zoom:{}},emits:["select","select-multiple","update-element","update-multiple","delete-element"],setup(l,{emit:h}){const x=l,I=h,Y=b(null),H=b(null),B=b(!1),U=b(0),W=b(0),X=b(new Map),D=b(!1),M=b(""),N=b(0),O=b(0),T=b(0),P=b(0),tt=b(0),L=b(0),Q=b(null),_=b(!1),V=b(null),lt=b(0),nt=b(0),w=b({vertical:[],horizontal:[],distances:[]}),k=gt(()=>[...x.templateData.elements].sort((s,m)=>s.zIndex-m.zIndex)),a=gt(()=>{const s=x.templateData.background;return s.type==="color"?s.value:s.type==="image"?`url(${s.value}) center/cover no-repeat`:"#FFFFFF"});function e(s){return{left:`${s.x}px`,top:`${s.y}px`,width:`${s.width}px`,height:`${s.height}px`,transform:s.rotation?`rotate(${s.rotation}deg)`:void 0}}function i(s){const m={left:"flex-start",center:"center",right:"flex-end"};return{fontFamily:s.fontFamily,fontSize:`${s.fontSize}px`,fontWeight:s.fontWeight,fontStyle:s.fontStyle,textAlign:s.textAlign,justifyContent:m[s.textAlign]||"flex-start",color:s.color,lineHeight:s.lineHeight,backgroundColor:s.backgroundColor||"transparent"}}function G(s){if(!ht.find($=>$.key===s))return s;const u=s.split(".")[0];return u?u.charAt(0).toUpperCase():"V"}function dt(s,m,n){if(w.value={vertical:[],horizontal:[],distances:[]},s.length===0)return;const u=s[0];if(!u)return;const $=m+u.width,r=n+u.height,y=m+u.width/2,d=n+u.height/2;x.templateData.elements.forEach(v=>{if(s.some(Z=>Z.id===v.id))return;const E=v.x+v.width,J=v.y+v.height,C=v.x+v.width/2,q=v.y+v.height/2;if(Math.abs(m-v.x)<et&&w.value.vertical.push({position:v.x,type:"edge"}),Math.abs($-E)<et&&w.value.vertical.push({position:E,type:"edge"}),Math.abs(y-C)<et&&w.value.vertical.push({position:C,type:"center"}),Math.abs(n-v.y)<et&&w.value.horizontal.push({position:v.y,type:"edge"}),Math.abs(r-J)<et&&w.value.horizontal.push({position:J,type:"edge"}),Math.abs(d-q)<et&&w.value.horizontal.push({position:q,type:"center"}),Math.abs(n-J)<100&&Math.abs(m-v.x)<50){const Z=Math.abs(n-J);w.value.distances.push({x:v.x+v.width/2,y:(n+J)/2,value:Z})}}),Math.abs(m)<et&&w.value.vertical.push({position:0,type:"edge"}),Math.abs(n)<et&&w.value.horizontal.push({position:0,type:"edge"}),Math.abs($-x.templateData.width)<et&&w.value.vertical.push({position:x.templateData.width,type:"edge"}),Math.abs(r-x.templateData.height)<et&&w.value.horizontal.push({position:x.templateData.height,type:"edge"})}function z(s,m,n){let u=s,$=m;const r=s+n.width,y=m+n.height,d=s+n.width/2,v=m+n.height/2;for(const E of w.value.vertical){if(Math.abs(s-E.position)<et){u=E.position;break}if(Math.abs(r-E.position)<et){u=E.position-n.width;break}if(Math.abs(d-E.position)<et){u=E.position-n.width/2;break}}for(const E of w.value.horizontal){if(Math.abs(m-E.position)<et){$=E.position;break}if(Math.abs(y-E.position)<et){$=E.position-n.height;break}if(Math.abs(v-E.position)<et){$=E.position-n.height/2;break}}return{x:u,y:$}}function o(s){if(s.target===s.currentTarget||s.target.classList.contains("canvas-content")){_.value=!0;const m=s.currentTarget.getBoundingClientRect();lt.value=(s.clientX-m.left)/x.zoom,nt.value=(s.clientY-m.top)/x.zoom,!s.ctrlKey&&!s.metaKey&&I("select",null,!1),document.addEventListener("mousemove",F),document.addEventListener("mouseup",j)}}function F(s){if(!_.value)return;const m=document.querySelector(".canvas-wrapper");if(!m)return;const n=m.getBoundingClientRect(),u=(s.clientX-n.left)/x.zoom,$=(s.clientY-n.top)/x.zoom,r=Math.min(lt.value,u),y=Math.min(nt.value,$),d=Math.abs(u-lt.value),v=Math.abs($-nt.value);V.value={x:r,y,width:d,height:v}}function j(){if(_.value&&V.value){const s=V.value,m=[];x.templateData.elements.forEach(n=>{const u=n.x+n.width,$=n.y+n.height,r=s.x+s.width,y=s.y+s.height;n.x<r&&u>s.x&&n.y<y&&$>s.y&&m.push(n.id)}),m.length>0&&I("select-multiple",m)}_.value=!1,V.value=null,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",j)}function ot(s,m){if(m.locked){I("select",m.id,s.ctrlKey||s.metaKey);return}const n=s.ctrlKey||s.metaKey;x.selectedElementIds.has(m.id)||I("select",m.id,n),B.value=!0,U.value=s.clientX,W.value=s.clientY,X.value.clear(),x.templateData.elements.forEach(u=>{x.selectedElementIds.has(u.id)&&!u.locked&&X.value.set(u.id,{x:u.x,y:u.y})}),document.addEventListener("mousemove",xt),document.addEventListener("mouseup",bt)}function xt(s){if(B.value&&X.value.size>0){const m=(s.clientX-U.value)/x.zoom,n=(s.clientY-W.value)/x.zoom,u=Array.from(x.selectedElementIds)[0],$=x.templateData.elements.find(r=>r.id===u);if($){const r=X.value.get($.id);if(r){let y=r.x+m,d=r.y+n;dt([$],y,d);const v=z(y,d,$),E=v.x-y,J=v.y-d;X.value.forEach((C,q)=>{const Z=x.templateData.elements.find(At=>At.id===q);if(!Z)return;let St=C.x+m+E,Ct=C.y+n+J;St=Math.max(0,Math.min(x.templateData.width-Z.width,St)),Ct=Math.max(0,Math.min(x.templateData.height-Z.height,Ct)),I("update-element",q,{x:St,y:Ct})})}}}D.value&&Q.value&&kt(s)}function bt(){B.value=!1,X.value.clear(),D.value=!1,Q.value=null,w.value={vertical:[],horizontal:[],distances:[]},document.removeEventListener("mousemove",xt),document.removeEventListener("mouseup",bt)}function st(s,m,n){D.value=!0,M.value=n,N.value=s.clientX,O.value=s.clientY,T.value=m.width,P.value=m.height,tt.value=m.x,L.value=m.y,Q.value=m,document.addEventListener("mousemove",xt),document.addEventListener("mouseup",bt)}function kt(s){if(!Q.value)return;const m=(s.clientX-N.value)/x.zoom,n=(s.clientY-O.value)/x.zoom;let u=T.value,$=P.value,r=tt.value,y=L.value;const d=20;switch(M.value){case"se":u=Math.max(d,T.value+m),$=Math.max(d,P.value+n);break;case"sw":u=Math.max(d,T.value-m),$=Math.max(d,P.value+n),r=tt.value+(T.value-u);break;case"ne":u=Math.max(d,T.value+m),$=Math.max(d,P.value-n),y=L.value+(P.value-$);break;case"nw":u=Math.max(d,T.value-m),$=Math.max(d,P.value-n),r=tt.value+(T.value-u),y=L.value+(P.value-$);break;case"n":$=Math.max(d,P.value-n),y=L.value+(P.value-$);break;case"s":$=Math.max(d,P.value+n);break;case"e":u=Math.max(d,T.value+m);break;case"w":u=Math.max(d,T.value-m),r=tt.value+(T.value-u);break}w.value.distances=[{x:r+u/2,y:y-20,value:u},{x:r-40,y:y+$/2,value:$}],I("update-element",Q.value.id,{x:r,y,width:u,height:$})}function mt(s){s.type==="text"&&!s.locked&&(Y.value=s.id,Ot(()=>{const m=document.querySelectorAll('.text-content[contenteditable="true"]'),n=m[m.length-1];if(n){n.focus();const u=document.createRange();u.selectNodeContents(n);const $=window.getSelection();$?.removeAllRanges(),$?.addRange(u)}}))}function wt(s,m){if(m.type==="text"){const u=s.target.textContent||"";I("update-element",m.id,{content:u}),Y.value=null}}function ft(){const s=document.querySelector('.text-content[contenteditable="true"]');s&&s.blur()}return(s,m)=>(c(),g("div",{class:"canvas-wrapper",style:ut({width:`${l.templateData.width*l.zoom}px`,height:`${l.templateData.height*l.zoom}px`}),onMousedown:o},[t("div",{class:"canvas-content",style:ut({width:`${l.templateData.width}px`,height:`${l.templateData.height}px`,transform:`scale(${l.zoom})`,transformOrigin:"top left",background:a.value})},[w.value.vertical.length>0||w.value.horizontal.length>0?(c(),g("div",Le,[(c(!0),g(ct,null,pt(w.value.vertical,(n,u)=>(c(),g("div",{key:`v-${u}`,class:"guide guide-vertical",style:ut({left:`${n.position}px`})},[t("span",Re,R(Math.round(n.position)),1)],4))),128)),(c(!0),g(ct,null,pt(w.value.horizontal,(n,u)=>(c(),g("div",{key:`h-${u}`,class:"guide guide-horizontal",style:ut({top:`${n.position}px`})},[t("span",Oe,R(Math.round(n.position)),1)],4))),128)),(c(!0),g(ct,null,pt(w.value.distances,(n,u)=>(c(),g("div",{key:`d-${u}`,class:"distance-label",style:ut({left:`${n.x}px`,top:`${n.y}px`})},R(Math.round(n.value))+"px ",5))),128))])):K("",!0),V.value?(c(),g("div",{key:1,class:"selection-box",style:ut({left:`${V.value.x}px`,top:`${V.value.y}px`,width:`${V.value.width}px`,height:`${V.value.height}px`})},null,4)):K("",!0),(c(!0),g(ct,null,pt(k.value,n=>(c(),g("div",{key:n.id,class:at(["canvas-element",{selected:l.selectedElementIds.has(n.id),locked:n.locked}]),style:ut(e(n)),onMousedown:rt(u=>ot(u,n),["stop"]),onDblclick:rt(u=>mt(n),["stop"])},[n.type==="text"?(c(),g("div",{key:0,class:"text-content",style:ut(i(n)),contenteditable:Y.value===n.id,onBlur:u=>wt(u,n),onKeydown:qt(rt(ft,["prevent"]),["enter"]),ref_for:!0,ref_key:"textEditorRef",ref:H},R(n.content),45,Ke)):n.type==="variable"?(c(),g("div",{key:1,class:"variable-content",style:ut(i(n))},[t("span",Pe,R(G(n.variableKey)),1),it(" "+R(n.placeholder),1)],4)):n.type==="image"?(c(),g("img",{key:2,src:n.src,style:ut({width:"100%",height:"100%",objectFit:n.objectFit,opacity:n.opacity}),draggable:"false"},null,12,je)):n.type==="qr"?(c(),g("div",{key:3,class:"qr-placeholder",style:ut({background:n.backgroundColor})},[(c(),g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"80%",height:"80%",viewBox:"0 0 24 24",fill:"none",stroke:n.color,"stroke-width":"1.5"},[...m[0]||(m[0]=[yt('<rect width="5" height="5" x="3" y="3" rx="1" data-v-5d693d22></rect><rect width="5" height="5" x="16" y="3" rx="1" data-v-5d693d22></rect><rect width="5" height="5" x="3" y="16" rx="1" data-v-5d693d22></rect><path d="M21 16h-3a2 2 0 0 0-2 2v3" data-v-5d693d22></path><path d="M21 21v.01" data-v-5d693d22></path><path d="M12 7v3a2 2 0 0 1-2 2H7" data-v-5d693d22></path><path d="M3 12h.01" data-v-5d693d22></path><path d="M12 3h.01" data-v-5d693d22></path><path d="M12 16v.01" data-v-5d693d22></path><path d="M16 12h1" data-v-5d693d22></path><path d="M21 12v.01" data-v-5d693d22></path><path d="M12 21v-1" data-v-5d693d22></path>',12)])],8,Ue)),m[1]||(m[1]=t("span",{class:"qr-label"},"QR",-1))],4)):n.type==="shape"?(c(),g("svg",{key:4,class:"shape-svg",width:n.width,height:n.height},[n.shapeType==="rectangle"?(c(),g("rect",{key:0,x:"0",y:"0",width:n.width,height:n.height,fill:n.fillColor,stroke:n.strokeColor,"stroke-width":n.strokeWidth},null,8,Xe)):n.shapeType==="circle"?(c(),g("ellipse",{key:1,cx:n.width/2,cy:n.height/2,rx:n.width/2-n.strokeWidth/2,ry:n.height/2-n.strokeWidth/2,fill:n.fillColor,stroke:n.strokeColor,"stroke-width":n.strokeWidth},null,8,Ye)):n.shapeType==="line"?(c(),g("line",{key:2,x1:"0",y1:"0",x2:n.width,y2:n.height,stroke:n.strokeColor,"stroke-width":n.strokeWidth},null,8,Ge)):K("",!0)],8,Je)):K("",!0),l.selectedElementIds.has(n.id)&&l.selectedElementIds.size===1&&!n.locked?(c(),g(ct,{key:5},[t("div",{class:"resize-handle nw",onMousedown:rt(u=>st(u,n,"nw"),["stop"])},null,40,qe),t("div",{class:"resize-handle ne",onMousedown:rt(u=>st(u,n,"ne"),["stop"])},null,40,Ze),t("div",{class:"resize-handle sw",onMousedown:rt(u=>st(u,n,"sw"),["stop"])},null,40,Qe),t("div",{class:"resize-handle se",onMousedown:rt(u=>st(u,n,"se"),["stop"])},null,40,_e),t("div",{class:"resize-handle n",onMousedown:rt(u=>st(u,n,"n"),["stop"])},null,40,tl),t("div",{class:"resize-handle s",onMousedown:rt(u=>st(u,n,"s"),["stop"])},null,40,el),t("div",{class:"resize-handle e",onMousedown:rt(u=>st(u,n,"e"),["stop"])},null,40,ll),t("div",{class:"resize-handle w",onMousedown:rt(u=>st(u,n,"w"),["stop"])},null,40,nl)],64)):K("",!0),n.locked?(c(),g("div",ol,[...m[2]||(m[2]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),t("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])])):K("",!0),l.selectedElementIds.has(n.id)&&l.selectedElementIds.size>1?(c(),g("div",il,R(Array.from(l.selectedElementIds).indexOf(n.id)+1),1)):K("",!0)],46,Ve))),128))],4)],36))}}),sl=Object.assign(zt(al,[["__scopeId","data-v-5d693d22"]]),{__name:"CertificatesEditorCanvas"}),rl={class:"editor-sidebar"},dl={key:0,class:"empty-state"},ul={class:"sidebar-header"},cl={class:"element-type-badge multi"},hl={class:"header-actions"},vl={class:"sidebar-section"},gl={class:"align-section"},fl={class:"align-buttons"},pl={class:"align-buttons"},ml={key:0,class:"align-label mt-3"},wl={key:1,class:"align-buttons"},yl={class:"sidebar-section actions-section"},xl={class:"action-buttons"},bl={class:"sidebar-header"},kl={class:"header-actions"},Cl=["title"],El={key:0,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Sl={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},$l={class:"sidebar-section"},Il={class:"input-grid compact"},zl={class:"input-group"},Ml=["value","disabled"],Fl={class:"input-group"},Al=["value","disabled"],Bl={class:"input-group"},Dl=["value","disabled"],Tl={class:"input-group"},Wl=["value","disabled"],Hl={class:"input-group full"},Nl=["value","disabled"],Ll={class:"range-value"},Rl={class:"sidebar-section"},Ol={class:"align-section"},Vl={class:"align-buttons"},Kl=["disabled"],Pl=["disabled"],jl=["disabled"],Ul=["disabled"],Jl=["disabled"],Xl=["disabled"],Yl={key:0,class:"sidebar-section"},Gl={key:0,class:"input-group full"},ql=["value","disabled"],Zl={key:1,class:"input-group full"},Ql=["value","disabled"],_l=["label"],tn=["value"],en={class:"input-group full"},ln=["value","disabled"],nn=["value"],on={class:"input-grid"},an={class:"input-group"},sn=["value","disabled"],rn={class:"input-group"},dn=["value","disabled"],un={class:"button-group"},cn=["disabled"],hn=["disabled"],vn=["disabled"],gn=["disabled"],fn=["disabled"],pn={class:"input-group full"},mn={class:"color-picker"},wn=["value","disabled"],yn=["value","disabled"],xn={class:"input-group full"},bn={class:"color-picker"},kn=["value","disabled"],Cn=["value","disabled"],En={class:"checkbox-group mt-1"},Sn=["checked","disabled"],$n={key:1,class:"sidebar-section"},In={class:"input-group full"},zn=["value","disabled"],Mn={class:"input-group full"},Fn=["value","disabled"],An={class:"range-value"},Bn=["disabled"],Dn={key:2,class:"sidebar-section"},Tn={class:"input-group full"},Wn=["value","disabled"],Hn={key:0,class:"input-group full"},Nn=["value","disabled","placeholder"],Ln={key:0,class:"help-text mt-1 text-xs text-gray-500"},Rn={class:"input-grid"},On={class:"input-group"},Vn=["value","disabled"],Kn={class:"input-group"},Pn=["value","disabled"],jn={key:3,class:"sidebar-section"},Un={class:"input-group full"},Jn=["value","disabled"],Xn={class:"input-grid"},Yn={class:"input-group"},Gn=["value","disabled"],qn={class:"input-group"},Zn=["value","disabled"],Qn={class:"input-group full"},_n=["value","disabled"],to={class:"range-value"},eo={class:"checkbox-group"},lo=["checked","disabled"],no={class:"sidebar-section actions-section"},oo={class:"action-buttons"},io=["disabled"],ao=It({__name:"EditorSidebar",props:{selectedElement:{},selectedElements:{},templateId:{}},emits:["update","delete","delete-multiple","duplicate","duplicate-multiple","bring-to-front","send-to-back","toggle-lock","align","align-group","distribute"],setup(l,{emit:h}){const x=l,I=h,{authFetch:Y}=$t(),{error:H}=Vt(),B=b(null),U=b(!1),W=gt(()=>[{name:"Студент",variables:ht.filter(a=>a.key.startsWith("student."))},{name:"Курс",variables:ht.filter(a=>a.key.startsWith("course."))},{name:"Группа",variables:ht.filter(a=>a.key.startsWith("group."))},{name:"Сертификат",variables:ht.filter(a=>a.key.startsWith("certificate."))}]);function X(a){return{text:"Текст",variable:"Переменная",image:"Изображение",qr:"QR-код",shape:"Фигура"}[a]||a}function D(a){return x.selectedElement?x.selectedElement[a]:""}function M(a,e){x.selectedElement&&I("update",x.selectedElement.id,{[a]:e})}function N(a,e){const i=parseFloat(e.target.value);isNaN(i)||M(a,i)}function O(a,e){const i=e.target;a==="fontSize"||a==="lineHeight"?M(a,parseFloat(i.value)):M(a,i.value)}function T(a){const e=a.target.value,i=ht.find(G=>G.key===e);I("update",x.selectedElement.id,{variableKey:e,placeholder:i?.placeholder||"[Переменная]"})}function P(){const a=D("fontWeight");M("fontWeight",a==="bold"?"normal":"bold")}function tt(){const a=D("fontStyle");M("fontStyle",a==="italic"?"normal":"italic")}function L(a){M("textAlign",a)}function Q(){if(!x.selectedElement)return"#ffffff";const a=x.selectedElement.backgroundColor;return!a||a==="transparent"?"#ffffff":a}function _(){if(!x.selectedElement)return!0;const a=x.selectedElement.backgroundColor;return!a||a==="transparent"}function V(a){const e=a.target.value;M("backgroundColor",e)}function lt(){const a=x.selectedElement.backgroundColor;M("backgroundColor",!a||a==="transparent"?"#ffffff":"transparent")}function nt(){const a=x.selectedElement.fillColor;M("fillColor",a==="transparent"?"#ffffff":"transparent")}function w(){B.value?.click()}async function k(a){const e=a.target,i=e.files?.[0];if(i){U.value=!0;try{const G=new FormData;G.append("image",i);const dt=await Y(`/api/certificates/templates/${x.templateId}/upload-image`,{method:"POST",body:G});if(dt.success)M("src",dt.url);else throw new Error(dt.message||"Ошибка загрузки изображения")}catch(G){console.error("Error uploading image:",G),H(G.message||"Ошибка загрузки изображения")}finally{U.value=!1,e.value=""}}}return(a,e)=>(c(),g("div",rl,[l.selectedElements.length===0?(c(),g("div",dl,[...e[53]||(e[53]=[yt('<div class="empty-icon" data-v-9e24b3c1><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-9e24b3c1><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48" data-v-9e24b3c1></path></svg></div><p class="empty-title" data-v-9e24b3c1>Выберите элемент</p><p class="empty-text" data-v-9e24b3c1> Кликните на элемент на холсте, чтобы редактировать его свойства </p>',3)])])):l.selectedElements.length>1?(c(),g(ct,{key:1},[t("div",ul,[t("span",cl," Выбрано: "+R(l.selectedElements.length),1),t("div",hl,[t("button",{class:"action-btn delete",onClick:e[0]||(e[0]=i=>a.$emit("delete-multiple")),title:"Удалить все"},[...e[54]||(e[54]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18"}),t("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),t("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)])])])]),t("div",vl,[e[68]||(e[68]=t("h4",{class:"section-title"},"Выравнивание",-1)),t("div",gl,[e[66]||(e[66]=t("p",{class:"align-label"},"Относительно холста",-1)),t("div",fl,[t("button",{class:"align-btn",onClick:e[1]||(e[1]=i=>a.$emit("align","left")),title:"По левому краю"},[...e[55]||(e[55]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"3",x2:"3",y2:"21"}),t("rect",{x:"7",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[2]||(e[2]=i=>a.$emit("align","center-h")),title:"По центру горизонтально"},[...e[56]||(e[56]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"3",x2:"12",y2:"21"}),t("rect",{x:"5",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[3]||(e[3]=i=>a.$emit("align","right")),title:"По правому краю"},[...e[57]||(e[57]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"21",y1:"3",x2:"21",y2:"21"}),t("rect",{x:"3",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[4]||(e[4]=i=>a.$emit("align","top")),title:"По верхнему краю"},[...e[58]||(e[58]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"3",x2:"21",y2:"3"}),t("rect",{x:"6",y:"7",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[5]||(e[5]=i=>a.$emit("align","center-v")),title:"По центру вертикально"},[...e[59]||(e[59]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),t("rect",{x:"6",y:"5",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[6]||(e[6]=i=>a.$emit("align","bottom")),title:"По нижнему краю"},[...e[60]||(e[60]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"21",x2:"21",y2:"21"}),t("rect",{x:"6",y:"3",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])])]),e[67]||(e[67]=t("p",{class:"align-label mt-3"},"Относительно друг друга",-1)),t("div",pl,[t("button",{class:"align-btn",onClick:e[7]||(e[7]=i=>a.$emit("align-group","left")),title:"Выровнять левые края"},[...e[61]||(e[61]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"5",width:"8",height:"4",rx:"1"}),t("rect",{x:"3",y:"11",width:"12",height:"4",rx:"1"}),t("rect",{x:"3",y:"17",width:"6",height:"4",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[8]||(e[8]=i=>a.$emit("align-group","center-h")),title:"Выровнять центры"},[...e[62]||(e[62]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"8",y:"5",width:"8",height:"4",rx:"1"}),t("rect",{x:"6",y:"11",width:"12",height:"4",rx:"1"}),t("rect",{x:"9",y:"17",width:"6",height:"4",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[9]||(e[9]=i=>a.$emit("align-group","right")),title:"Выровнять правые края"},[...e[63]||(e[63]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"13",y:"5",width:"8",height:"4",rx:"1"}),t("rect",{x:"9",y:"11",width:"12",height:"4",rx:"1"}),t("rect",{x:"15",y:"17",width:"6",height:"4",rx:"1"})],-1)])])]),l.selectedElements.length>=3?(c(),g("p",ml," Распределение ")):K("",!0),l.selectedElements.length>=3?(c(),g("div",wl,[t("button",{class:"align-btn",onClick:e[10]||(e[10]=i=>a.$emit("distribute","horizontal")),title:"Распределить по горизонтали"},[...e[64]||(e[64]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"2",y:"8",width:"4",height:"8",rx:"1"}),t("rect",{x:"10",y:"8",width:"4",height:"8",rx:"1"}),t("rect",{x:"18",y:"8",width:"4",height:"8",rx:"1"})],-1)])]),t("button",{class:"align-btn",onClick:e[11]||(e[11]=i=>a.$emit("distribute","vertical")),title:"Распределить по вертикали"},[...e[65]||(e[65]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1"}),t("rect",{x:"8",y:"10",width:"8",height:"4",rx:"1"}),t("rect",{x:"8",y:"18",width:"8",height:"4",rx:"1"})],-1)])])])):K("",!0)])]),t("div",yl,[e[72]||(e[72]=t("h4",{class:"section-title"},"Действия",-1)),t("div",xl,[t("button",{class:"action-button",onClick:e[12]||(e[12]=i=>a.$emit("duplicate-multiple"))},[...e[69]||(e[69]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),t("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})],-1),it(" Дублировать все ",-1)])]),t("button",{class:"action-button",onClick:e[13]||(e[13]=i=>a.$emit("bring-to-front"))},[...e[70]||(e[70]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"8",height:"8",x:"8",y:"8",rx:"1"}),t("path",{d:"M4 16V6a2 2 0 0 1 2-2h10"}),t("path",{d:"M14 22h4a2 2 0 0 0 2-2v-4"})],-1),it(" На передний план ",-1)])]),t("button",{class:"action-button",onClick:e[14]||(e[14]=i=>a.$emit("send-to-back"))},[...e[71]||(e[71]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"8",height:"8",x:"8",y:"8",rx:"1"}),t("path",{d:"M4 8V6a2 2 0 0 1 2-2h2"}),t("path",{d:"M20 16v2a2 2 0 0 1-2 2h-2"})],-1),it(" На задний план ",-1)])])])])],64)):(c(),g(ct,{key:2},[t("div",bl,[t("span",{class:at(["element-type-badge",l.selectedElement.type])},R(X(l.selectedElement.type)),3),t("div",kl,[t("button",{class:at(["action-btn",{active:l.selectedElement.locked}]),onClick:e[15]||(e[15]=i=>a.$emit("toggle-lock")),title:l.selectedElement.locked?"Разблокировать":"Заблокировать"},[l.selectedElement.locked?(c(),g("svg",El,[...e[73]||(e[73]=[t("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"},null,-1),t("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"},null,-1)])])):(c(),g("svg",Sl,[...e[74]||(e[74]=[t("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"},null,-1),t("path",{d:"M7 11V7a5 5 0 0 1 9.9-1"},null,-1)])]))],10,Cl),t("button",{class:"action-btn delete",onClick:e[16]||(e[16]=i=>a.$emit("delete")),title:"Удалить"},[...e[75]||(e[75]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M3 6h18"}),t("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),t("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)])])])]),t("div",$l,[e[81]||(e[81]=t("h4",{class:"section-title"},"Позиция и размер",-1)),t("div",Il,[t("div",zl,[e[76]||(e[76]=t("label",null,"X",-1)),t("input",{type:"number",value:Math.round(l.selectedElement.x),onInput:e[17]||(e[17]=i=>N("x",i)),disabled:l.selectedElement.locked},null,40,Ml)]),t("div",Fl,[e[77]||(e[77]=t("label",null,"Y",-1)),t("input",{type:"number",value:Math.round(l.selectedElement.y),onInput:e[18]||(e[18]=i=>N("y",i)),disabled:l.selectedElement.locked},null,40,Al)]),t("div",Bl,[e[78]||(e[78]=t("label",null,"Ш",-1)),t("input",{type:"number",value:Math.round(l.selectedElement.width),onInput:e[19]||(e[19]=i=>N("width",i)),disabled:l.selectedElement.locked,min:"20"},null,40,Dl)]),t("div",Tl,[e[79]||(e[79]=t("label",null,"В",-1)),t("input",{type:"number",value:Math.round(l.selectedElement.height),onInput:e[20]||(e[20]=i=>N("height",i)),disabled:l.selectedElement.locked,min:"20"},null,40,Wl)])]),t("div",Hl,[e[80]||(e[80]=t("label",null,"Поворот (°)",-1)),t("input",{type:"range",value:l.selectedElement.rotation,onInput:e[21]||(e[21]=i=>N("rotation",i)),disabled:l.selectedElement.locked,min:"0",max:"360"},null,40,Nl),t("span",Ll,R(l.selectedElement.rotation)+"°",1)])]),t("div",Rl,[e[89]||(e[89]=t("h4",{class:"section-title"},"Выравнивание",-1)),t("div",Ol,[e[88]||(e[88]=t("p",{class:"align-label"},"Относительно холста",-1)),t("div",Vl,[t("button",{class:"align-btn",onClick:e[22]||(e[22]=i=>a.$emit("align","left")),disabled:l.selectedElement.locked,title:"По левому краю"},[...e[82]||(e[82]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"3",x2:"3",y2:"21"}),t("rect",{x:"7",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])],8,Kl),t("button",{class:"align-btn",onClick:e[23]||(e[23]=i=>a.$emit("align","center-h")),disabled:l.selectedElement.locked,title:"По центру горизонтально"},[...e[83]||(e[83]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"3",x2:"12",y2:"21"}),t("rect",{x:"5",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])],8,Pl),t("button",{class:"align-btn",onClick:e[24]||(e[24]=i=>a.$emit("align","right")),disabled:l.selectedElement.locked,title:"По правому краю"},[...e[84]||(e[84]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"21",y1:"3",x2:"21",y2:"21"}),t("rect",{x:"3",y:"6",width:"14",height:"5",rx:"1"}),t("rect",{x:"7",y:"13",width:"10",height:"5",rx:"1"})],-1)])],8,jl),t("button",{class:"align-btn",onClick:e[25]||(e[25]=i=>a.$emit("align","top")),disabled:l.selectedElement.locked,title:"По верхнему краю"},[...e[85]||(e[85]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"3",x2:"21",y2:"3"}),t("rect",{x:"6",y:"7",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])],8,Ul),t("button",{class:"align-btn",onClick:e[26]||(e[26]=i=>a.$emit("align","center-v")),disabled:l.selectedElement.locked,title:"По центру вертикально"},[...e[86]||(e[86]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),t("rect",{x:"6",y:"5",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])],8,Jl),t("button",{class:"align-btn",onClick:e[27]||(e[27]=i=>a.$emit("align","bottom")),disabled:l.selectedElement.locked,title:"По нижнему краю"},[...e[87]||(e[87]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"3",y1:"21",x2:"21",y2:"21"}),t("rect",{x:"6",y:"3",width:"5",height:"14",rx:"1"}),t("rect",{x:"13",y:"7",width:"5",height:"10",rx:"1"})],-1)])],8,Xl)])])]),l.selectedElement.type==="text"||l.selectedElement.type==="variable"?(c(),g("div",Yl,[e[104]||(e[104]=t("h4",{class:"section-title"},"Текст",-1)),l.selectedElement.type==="text"?(c(),g("div",Gl,[e[90]||(e[90]=t("label",null,"Содержимое",-1)),t("textarea",{value:l.selectedElement.content,onInput:e[28]||(e[28]=i=>O("content",i)),disabled:l.selectedElement.locked,rows:"2"},null,40,ql)])):K("",!0),l.selectedElement.type==="variable"?(c(),g("div",Zl,[e[91]||(e[91]=t("label",null,"Переменная",-1)),t("select",{value:l.selectedElement.variableKey,onChange:e[29]||(e[29]=i=>T(i)),disabled:l.selectedElement.locked},[(c(!0),g(ct,null,pt(W.value,i=>(c(),g("optgroup",{key:i.name,label:i.name},[(c(!0),g(ct,null,pt(i.variables,G=>(c(),g("option",{key:G.key,value:G.key},R(G.label),9,tn))),128))],8,_l))),128))],40,Ql)])):K("",!0),t("div",en,[e[92]||(e[92]=t("label",null,"Шрифт",-1)),t("select",{value:D("fontFamily"),onChange:e[30]||(e[30]=i=>O("fontFamily",i)),disabled:l.selectedElement.locked},[(c(!0),g(ct,null,pt(A(oe),i=>(c(),g("option",{key:i,value:i},R(i),9,nn))),128))],40,ln)]),t("div",on,[t("div",an,[e[93]||(e[93]=t("label",null,"Размер",-1)),t("input",{type:"number",value:D("fontSize"),onInput:e[31]||(e[31]=i=>O("fontSize",i)),disabled:l.selectedElement.locked,min:"8",max:"200"},null,40,sn)]),t("div",rn,[e[94]||(e[94]=t("label",null,"Межстрочный",-1)),t("input",{type:"number",value:D("lineHeight"),onInput:e[32]||(e[32]=i=>O("lineHeight",i)),disabled:l.selectedElement.locked,min:"0.5",max:"3",step:"0.1"},null,40,dn)])]),t("div",un,[t("button",{class:at(["style-btn",{active:D("fontWeight")==="bold"}]),onClick:P,disabled:l.selectedElement.locked,title:"Жирный"},[...e[95]||(e[95]=[t("strong",null,"B",-1)])],10,cn),t("button",{class:at(["style-btn",{active:D("fontStyle")==="italic"}]),onClick:tt,disabled:l.selectedElement.locked,title:"Курсив"},[...e[96]||(e[96]=[t("em",null,"I",-1)])],10,hn),e[100]||(e[100]=t("div",{class:"separator"},null,-1)),t("button",{class:at(["style-btn",{active:D("textAlign")==="left"}]),onClick:e[33]||(e[33]=i=>L("left")),disabled:l.selectedElement.locked,title:"По левому краю"},[...e[97]||(e[97]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),t("line",{x1:"15",y1:"12",x2:"3",y2:"12"}),t("line",{x1:"17",y1:"18",x2:"3",y2:"18"})],-1)])],10,vn),t("button",{class:at(["style-btn",{active:D("textAlign")==="center"}]),onClick:e[34]||(e[34]=i=>L("center")),disabled:l.selectedElement.locked,title:"По центру"},[...e[98]||(e[98]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),t("line",{x1:"17",y1:"12",x2:"7",y2:"12"}),t("line",{x1:"19",y1:"18",x2:"5",y2:"18"})],-1)])],10,gn),t("button",{class:at(["style-btn",{active:D("textAlign")==="right"}]),onClick:e[35]||(e[35]=i=>L("right")),disabled:l.selectedElement.locked,title:"По правому краю"},[...e[99]||(e[99]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"}),t("line",{x1:"21",y1:"18",x2:"7",y2:"18"})],-1)])],10,fn)]),t("div",pn,[e[101]||(e[101]=t("label",null,"Цвет",-1)),t("div",mn,[t("input",{type:"color",value:D("color"),onInput:e[36]||(e[36]=i=>O("color",i)),disabled:l.selectedElement.locked},null,40,wn),t("input",{type:"text",value:D("color"),onInput:e[37]||(e[37]=i=>O("color",i)),disabled:l.selectedElement.locked,class:"color-text"},null,40,yn)])]),t("div",xn,[e[103]||(e[103]=t("label",null,"Заливка фона",-1)),t("div",bn,[t("input",{type:"color",value:Q(),onInput:e[38]||(e[38]=i=>V(i)),disabled:l.selectedElement.locked||_()},null,40,kn),t("input",{type:"text",value:Q(),onInput:e[39]||(e[39]=i=>V(i)),disabled:l.selectedElement.locked||_(),class:"color-text"},null,40,Cn)]),t("div",En,[t("label",null,[t("input",{type:"checkbox",checked:_(),onChange:lt,disabled:l.selectedElement.locked},null,40,Sn),e[102]||(e[102]=it(" Без заливки ",-1))])])])])):K("",!0),l.selectedElement.type==="image"?(c(),g("div",$n,[e[109]||(e[109]=t("h4",{class:"section-title"},"Изображение",-1)),t("div",In,[e[106]||(e[106]=t("label",null,"Подгонка",-1)),t("select",{value:l.selectedElement.objectFit,onChange:e[40]||(e[40]=i=>M("objectFit",i.target.value)),disabled:l.selectedElement.locked},[...e[105]||(e[105]=[t("option",{value:"contain"},"Вместить",-1),t("option",{value:"cover"},"Заполнить",-1),t("option",{value:"fill"},"Растянуть",-1)])],40,zn)]),t("div",Mn,[e[107]||(e[107]=t("label",null,"Прозрачность",-1)),t("input",{type:"range",value:l.selectedElement.opacity,onInput:e[41]||(e[41]=i=>N("opacity",i)),disabled:l.selectedElement.locked,min:"0",max:"1",step:"0.05"},null,40,Fn),t("span",An,R(Math.round(l.selectedElement.opacity*100))+"%",1)]),t("button",{class:"change-image-btn",onClick:w,disabled:l.selectedElement.locked},[...e[108]||(e[108]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"17 8 12 3 7 8"}),t("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1),it(" Заменить изображение ",-1)])],8,Bn),t("input",{ref_key:"imageInputRef",ref:B,type:"file",accept:"image/*",class:"hidden-input",onChange:k},null,544)])):K("",!0),l.selectedElement.type==="qr"?(c(),g("div",Dn,[e[114]||(e[114]=t("h4",{class:"section-title"},"QR-код",-1)),t("div",Tn,[e[111]||(e[111]=t("label",null,"Источник данных",-1)),t("select",{value:l.selectedElement.dataSource,onChange:e[42]||(e[42]=i=>M("dataSource",i.target.value)),disabled:l.selectedElement.locked},[...e[110]||(e[110]=[t("option",{value:"certificate_url"},"URL сертификата",-1),t("option",{value:"certificate_number"},"Номер сертификата",-1),t("option",{value:"custom"},"Кастомный текст",-1),t("option",{value:"custom_url"},"Кастомный URL",-1)])],40,Wn)]),["custom","custom_url"].includes(l.selectedElement.dataSource)?(c(),g("div",Hn,[t("label",null,R(l.selectedElement.dataSource==="custom_url"?"Базовый URL":"Данные"),1),t("input",{type:"text",value:l.selectedElement.customData,onInput:e[43]||(e[43]=i=>M("customData",i.target.value)),disabled:l.selectedElement.locked,placeholder:l.selectedElement.dataSource==="custom_url"?"https://example.com":"Введите данные для QR"},null,40,Nn),l.selectedElement.dataSource==="custom_url"?(c(),g("p",Ln," Пример: https://domain.com/verify/"+R("{NUMBER}"))):K("",!0)])):K("",!0),t("div",Rn,[t("div",On,[e[112]||(e[112]=t("label",null,"Цвет",-1)),t("input",{type:"color",value:l.selectedElement.color,onInput:e[44]||(e[44]=i=>M("color",i.target.value)),disabled:l.selectedElement.locked},null,40,Vn)]),t("div",Kn,[e[113]||(e[113]=t("label",null,"Фон",-1)),t("input",{type:"color",value:l.selectedElement.backgroundColor,onInput:e[45]||(e[45]=i=>M("backgroundColor",i.target.value)),disabled:l.selectedElement.locked},null,40,Pn)])])])):K("",!0),l.selectedElement.type==="shape"?(c(),g("div",jn,[e[121]||(e[121]=t("h4",{class:"section-title"},"Фигура",-1)),t("div",Un,[e[116]||(e[116]=t("label",null,"Тип",-1)),t("select",{value:l.selectedElement.shapeType,onChange:e[46]||(e[46]=i=>M("shapeType",i.target.value)),disabled:l.selectedElement.locked},[...e[115]||(e[115]=[t("option",{value:"rectangle"},"Прямоугольник",-1),t("option",{value:"circle"},"Круг",-1),t("option",{value:"line"},"Линия",-1)])],40,Jn)]),t("div",Xn,[t("div",Yn,[e[117]||(e[117]=t("label",null,"Заливка",-1)),t("input",{type:"color",value:l.selectedElement.fillColor==="transparent"?"#ffffff":l.selectedElement.fillColor,onInput:e[47]||(e[47]=i=>M("fillColor",i.target.value)),disabled:l.selectedElement.locked},null,40,Gn)]),t("div",qn,[e[118]||(e[118]=t("label",null,"Обводка",-1)),t("input",{type:"color",value:l.selectedElement.strokeColor,onInput:e[48]||(e[48]=i=>M("strokeColor",i.target.value)),disabled:l.selectedElement.locked},null,40,Zn)])]),t("div",Qn,[e[119]||(e[119]=t("label",null,"Толщина обводки",-1)),t("input",{type:"range",value:l.selectedElement.strokeWidth,onInput:e[49]||(e[49]=i=>N("strokeWidth",i)),disabled:l.selectedElement.locked,min:"0",max:"20"},null,40,_n),t("span",to,R(l.selectedElement.strokeWidth)+"px",1)]),t("div",eo,[t("label",null,[t("input",{type:"checkbox",checked:l.selectedElement.fillColor==="transparent",onChange:nt,disabled:l.selectedElement.locked},null,40,lo),e[120]||(e[120]=it(" Без заливки ",-1))])])])):K("",!0),t("div",no,[e[125]||(e[125]=t("h4",{class:"section-title"},"Действия",-1)),t("div",oo,[t("button",{class:"action-button",onClick:e[50]||(e[50]=i=>a.$emit("duplicate")),disabled:l.selectedElement.locked},[...e[122]||(e[122]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),t("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})],-1),it(" Дублировать ",-1)])],8,io),t("button",{class:"action-button",onClick:e[51]||(e[51]=i=>a.$emit("bring-to-front"))},[...e[123]||(e[123]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"8",height:"8",x:"8",y:"8",rx:"1"}),t("path",{d:"M4 16V6a2 2 0 0 1 2-2h10"}),t("path",{d:"M14 22h4a2 2 0 0 0 2-2v-4"})],-1),it(" На передний план ",-1)])]),t("button",{class:"action-button",onClick:e[52]||(e[52]=i=>a.$emit("send-to-back"))},[...e[124]||(e[124]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{width:"8",height:"8",x:"8",y:"8",rx:"1"}),t("path",{d:"M4 10v10a2 2 0 0 0 2 2h10"}),t("path",{d:"M10 4H6a2 2 0 0 0-2 2v4"})],-1),it(" На задний план ",-1)])])])])],64))]))}}),so=Object.assign(zt(ao,[["__scopeId","data-v-9e24b3c1"]]),{__name:"CertificatesEditorSidebar"}),ro={class:"certificate-editor"},uo={class:"editor-header"},co={class:"header-left"},ho={class:"editor-title"},vo={class:"header-center"},go=["disabled"],fo=["disabled"],po={class:"zoom-label"},mo=["disabled"],wo=["disabled"],yo={class:"header-right"},xo=["disabled"],bo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ko={key:1,class:"animate-spin",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Co={class:"editor-main"},Eo=It({__name:"CertificateEditor",props:{templateId:{},templateName:{},initialData:{}},emits:["save","preview"],setup(l,{emit:h}){const x=l,I=h,Y=b(null),{templateData:H,selectedElementId:B,selectedElement:U,selectedElementIds:W,selectedElements:X,zoom:D,isDirty:M,isSaving:N,canUndo:O,canRedo:T,minZoom:P,maxZoom:tt,initTemplate:L,exportData:Q,undo:_,redo:V,setLayout:lt,setBackground:nt,addElement:w,updateElement:k,deleteElement:a,deleteSelectedElement:e,duplicateElement:i,bringToFront:G,sendToBack:dt,toggleLock:z,selectElement:o,selectMultipleElements:F,clearSelection:j,alignElement:ot,alignMultipleElements:xt,distributeElements:bt,zoomIn:st,zoomOut:kt,resetZoom:mt}=ue(),wt=b(!1),ft=b(null),s=b(null),m=()=>`certificate_template_draft_${x.templateId}`;function n(){if(M.value)try{const p=Q();localStorage.setItem(m(),JSON.stringify(p)),console.log("✅ Автосохранение выполнено")}catch(p){console.error("Ошибка автосохранения:",p)}}function u(){try{const p=localStorage.getItem(m());if(p)return JSON.parse(p)}catch(p){console.error("Ошибка загрузки из localStorage:",p)}return null}Ht(()=>{const p=u();p?(console.log("📂 Загружена сохраненная версия из localStorage"),L(p)):L(x.initialData),le(),window.addEventListener("keydown",$);const f=ne(n,5e3);Tt(()=>{clearInterval(f)})}),Tt(()=>{window.removeEventListener("keydown",$)});function $(p){if(p.ctrlKey&&p.key==="z"&&!p.shiftKey&&(p.preventDefault(),_()),(p.ctrlKey&&p.key==="y"||p.ctrlKey&&p.shiftKey&&p.key==="z")&&(p.preventDefault(),V()),p.key==="Delete"&&B.value&&(p.preventDefault(),e()),p.ctrlKey&&p.key==="d"&&B.value&&(p.preventDefault(),i(B.value)),p.ctrlKey&&p.key==="c"&&B.value){p.preventDefault();const f=H.value.elements.find(Bt=>Bt.id===B.value);f&&(s.value=JSON.parse(JSON.stringify(f)),console.log("📋 Элемент скопирован в буфер обмена"))}if(p.ctrlKey&&p.key==="v"&&s.value){p.preventDefault();const f={...JSON.parse(JSON.stringify(s.value)),id:`el_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x:s.value.x+20,y:s.value.y+20};w(f),console.log("📌 Элемент вставлен из буфера обмена")}p.key==="Escape"&&o(null),p.ctrlKey&&(p.key==="s"||p.key==="S")&&(p.preventDefault(),p.stopPropagation(),M.value&&(n(),I("save",Q())))}function r(){const p=ie({x:H.value.width/2-150,y:H.value.height/2-25});w(p)}function y(p){const f=ae(p,{x:H.value.width/2-175,y:H.value.height/2-20});w(f)}function d(p){const f=se(p,{x:50,y:50});w(f)}function v(){const p=re({x:H.value.width-150,y:H.value.height-150});w(p)}function E(p){const f=de(p,{x:H.value.width/2-100,y:H.value.height/2-50});w(f)}function J(p,f){k(p,f)}function C(){B.value&&z(B.value)}function q(p){B.value&&ot(B.value,p)}function Z(p){if(H.value.elements.length>0){ft.value=p,wt.value=!0;return}L(p)}function St(){ft.value&&L(ft.value),wt.value=!1,ft.value=null}function Ct(){wt.value=!1,ft.value=null}function At(){Array.from(W.value).forEach(f=>a(f)),j()}function Pt(){Array.from(W.value).forEach(f=>i(f))}function jt(p){const f=Array.from(W.value);xt(f,p)}function Ut(p){const f=Array.from(W.value);bt(f,p)}function Jt(){B.value&&i(B.value)}function Xt(){(W.value.size>0?Array.from(W.value):B.value?[B.value]:[]).forEach(f=>G(f))}function Yt(){(W.value.size>0?Array.from(W.value):B.value?[B.value]:[]).forEach(f=>dt(f))}return(p,f)=>{const Bt=te;return c(),g("div",ro,[t("div",uo,[t("div",co,[Mt(Bt,{to:`/certificates/templates/${l.templateId}`,class:"back-button"},{default:Zt(()=>[...f[7]||(f[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"m15 18-6-6 6-6"})],-1),it(" Назад ",-1)])]),_:1},8,["to"]),t("h1",ho,R(l.templateName||"Редактор шаблона"),1)]),t("div",vo,[t("button",{class:"toolbar-btn",disabled:!A(O),onClick:f[0]||(f[0]=(...vt)=>A(_)&&A(_)(...vt)),title:"Отменить (Ctrl+Z)"},[...f[8]||(f[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M3 7v6h6"}),t("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"})],-1)])],8,go),t("button",{class:"toolbar-btn",disabled:!A(T),onClick:f[1]||(f[1]=(...vt)=>A(V)&&A(V)(...vt)),title:"Повторить (Ctrl+Y)"},[...f[9]||(f[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 7v6h-6"}),t("path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"})],-1)])],8,fo),f[13]||(f[13]=t("div",{class:"toolbar-divider"},null,-1)),t("span",po,R(Math.round(A(D)*100))+"%",1),t("button",{class:"toolbar-btn",onClick:f[2]||(f[2]=(...vt)=>A(kt)&&A(kt)(...vt)),disabled:A(D)<=A(P),title:"Уменьшить"},[...f[10]||(f[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"m21 21-4.3-4.3"}),t("path",{d:"M8 11h6"})],-1)])],8,mo),t("button",{class:"toolbar-btn",onClick:f[3]||(f[3]=(...vt)=>A(st)&&A(st)(...vt)),disabled:A(D)>=A(tt),title:"Увеличить"},[...f[11]||(f[11]=[yt('<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-680ea3fe><circle cx="11" cy="11" r="8" data-v-680ea3fe></circle><path d="m21 21-4.3-4.3" data-v-680ea3fe></path><path d="M11 8v6" data-v-680ea3fe></path><path d="M8 11h6" data-v-680ea3fe></path></svg>',1)])],8,wo),t("button",{class:"toolbar-btn",onClick:f[4]||(f[4]=(...vt)=>A(mt)&&A(mt)(...vt)),title:"Сбросить масштаб"},[...f[12]||(f[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.85.83 6.72 2.24"}),t("path",{d:"M21 3v6h-6"})],-1)])])]),t("div",yo,[t("button",{class:"btn-preview",onClick:f[5]||(f[5]=vt=>p.$emit("preview"))},[...f[14]||(f[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1),it(" Предпросмотр ",-1)])]),t("button",{class:"btn-save",disabled:A(N)||!A(M),onClick:f[6]||(f[6]=vt=>p.$emit("save",A(Q)()))},[A(N)?(c(),g("svg",ko,[...f[16]||(f[16]=[t("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,-1)])])):(c(),g("svg",bo,[...f[15]||(f[15]=[t("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),t("polyline",{points:"17,21 17,13 7,13 7,21"},null,-1),t("polyline",{points:"7,3 7,8 15,8"},null,-1)])])),it(" "+R(A(N)?"Сохранение...":"Сохранить"),1)],8,xo)])]),t("div",Co,[Mt(Ne,{onAddText:r,onAddVariable:y,onAddImage:d,onAddQr:v,onAddShape:E,onSetLayout:A(lt),onSetBackground:A(nt),onApplyPreset:Z,"current-layout":A(H).layout,"template-id":l.templateId},null,8,["onSetLayout","onSetBackground","current-layout","template-id"]),t("div",{class:"canvas-container",ref_key:"canvasContainerRef",ref:Y},[Mt(sl,{"template-data":A(H),"selected-element-ids":A(W),zoom:A(D),onSelect:A(o),onSelectMultiple:A(F),onUpdateElement:A(k),onDeleteElement:A(a)},null,8,["template-data","selected-element-ids","zoom","onSelect","onSelectMultiple","onUpdateElement","onDeleteElement"])],512),Mt(so,{"selected-element":A(U),"selected-elements":A(X),"template-id":l.templateId,onUpdate:J,onDelete:A(e),onDeleteMultiple:At,onDuplicate:Jt,onDuplicateMultiple:Pt,onBringToFront:Xt,onSendToBack:Yt,onToggleLock:C,onAlign:q,onAlignGroup:jt,onDistribute:Ut},null,8,["selected-element","selected-elements","template-id","onDelete"])]),(c(),Ft(Wt,{to:"body"},[wt.value?(c(),g("div",{key:0,class:"preset-confirm-overlay",onClick:rt(Ct,["self"])},[t("div",{class:"preset-confirm-modal"},[f[17]||(f[17]=t("div",{class:"modal-icon"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M12 9v4"}),t("path",{d:"M12 17h.01"}),t("path",{d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"})])],-1)),f[18]||(f[18]=t("h3",null,"Применить шаблон?",-1)),f[19]||(f[19]=t("p",null," Все текущие элементы будут заменены на элементы выбранного шаблона. Это действие нельзя отменить. ",-1)),t("div",{class:"modal-actions"},[t("button",{class:"btn-cancel",onClick:Ct},"Отмена"),t("button",{class:"btn-confirm",onClick:St}," Применить ")])])])):K("",!0)]))])}}}),So=Object.assign(zt(Eo,[["__scopeId","data-v-680ea3fe"]]),{__name:"CertificatesEditorCertificateEditor"}),$o={class:"editor-page"},Io={key:1,class:"loading-state"},zo={key:2,class:"error-state"},Mo={class:"preview-content"},Fo={class:"preview-header"},Ao={key:0,class:"preview-info"},Bo={class:"info-badge"},Do={class:"info-badge"},To={class:"preview-body"},Wo={key:0,class:"preview-loading"},Ho={key:1,class:"preview-error"},No=["srcdoc"],Lo={key:3,class:"preview-empty"},Ro={class:"preview-footer"},Oo={class:"footer-left"},Vo={class:"footer-right"},Ko=["disabled"],Po={key:0,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},jo={key:1,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Uo=It({__name:"editor",setup(l){const h=Qt();_t();const{authFetch:x}=$t(),I=gt(()=>h.params.id),Y=b(null),H=b(!0),B=b(!1),U=b(null),W=b(null),X=b(!1),D=b(!1),M=b(null),N=b(null),O=b(null),T=b(.75),P=b(null);async function tt(){H.value=!0,U.value=null;try{const w=await x(`/api/certificates/templates/${I.value}`);if(w.success)Y.value=w.template,console.log("[CertificateEditor] Шаблон загружен:",Y.value?.name);else throw new Error("Шаблон не найден")}catch(w){console.error("[CertificateEditor] Ошибка загрузки шаблона:",w),U.value=w instanceof Error?w.message:"Неизвестная ошибка"}finally{H.value=!1}}async function L(w){B.value=!0;try{if(Q(w)){console.warn("[CertificateEditor] ⚠️  Обнаружены base64-изображения в templateData"),console.warn("   Рекомендуется заменить их на загруженные файлы для уменьшения размера данных"),nt("error","Обнаружены встроенные изображения. Замените их через кнопку 'Загрузить фон' или 'Изображение' для оптимизации."),B.value=!1;return}const a=await x(`/api/certificates/templates/${I.value}`,{method:"PUT",body:{templateData:w,layout:w.layout}});if(a.success)Y.value=a.template,localStorage.removeItem(`certificate_template_draft_${I.value}`),nt("success","Шаблон успешно сохранён"),console.log("[CertificateEditor] Шаблон сохранён, localStorage очищен");else throw new Error("Ошибка сохранения")}catch(k){console.error("[CertificateEditor] Ошибка сохранения:",k),nt("error","Ошибка сохранения шаблона")}finally{B.value=!1}}function Q(w){if(w.background?.type==="image"&&w.background.value?.startsWith("data:image/"))return!0;for(const k of w.elements)if(k.type==="image"&&k.src?.startsWith("data:image/"))return!0;return!1}async function _(){X.value=!0,await Ot(),await V()}async function V(){D.value=!0,M.value=null;try{const w=await x(`/api/certificates/templates/${I.value}/preview`);w.success&&w.hasTemplate&&w.preview?(N.value=w.preview.html,O.value={width:w.preview.width,height:w.preview.height,elementsCount:w.preview.elementsCount}):M.value=w.message||"Шаблон не настроен"}catch(w){console.error("[CertificateEditor] Ошибка загрузки preview:",w),M.value="Ошибка генерации предпросмотра"}finally{D.value=!1}}function lt(){X.value=!1,N.value=null,O.value=null,M.value=null}function nt(w,k){W.value={type:w,message:k},setTimeout(()=>{W.value=null},3e3)}return Ht(()=>{tt()}),(w,k)=>(c(),g("div",$o,[Y.value?(c(),Ft(So,{key:0,"template-id":I.value,"template-name":Y.value.name,"initial-data":Y.value.templateData||void 0,onSave:L,onPreview:_},null,8,["template-id","template-name","initial-data"])):H.value?(c(),g("div",Io,[...k[3]||(k[3]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Загрузка шаблона...",-1)])])):U.value?(c(),g("div",zo,[k[4]||(k[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"m15 9-6 6"}),t("path",{d:"m9 9 6 6"})],-1)),k[5]||(k[5]=t("h2",null,"Ошибка загрузки",-1)),t("p",null,R(U.value),1),t("button",{onClick:tt},"Повторить")])):K("",!0),(c(),Ft(Wt,{to:"body"},[X.value?(c(),g("div",{key:0,class:"preview-modal",onClick:rt(lt,["self"])},[t("div",Mo,[t("div",Fo,[k[7]||(k[7]=t("h3",null,"Предпросмотр сертификата",-1)),O.value?(c(),g("div",Ao,[t("span",Bo,R(O.value.width)+"×"+R(O.value.height)+"px",1),t("span",Do,R(O.value.elementsCount)+" элементов",1)])):K("",!0),t("button",{class:"close-btn",onClick:lt},[...k[6]||(k[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6 6 18"}),t("path",{d:"m6 6 12 12"})],-1)])])]),t("div",To,[D.value?(c(),g("div",Wo,[...k[8]||(k[8]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Генерация предпросмотра...",-1)])])):M.value?(c(),g("div",Ho,[k[9]||(k[9]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("path",{d:"M12 8v4"}),t("path",{d:"M12 16h.01"})],-1)),t("p",null,R(M.value),1)])):N.value?(c(),g("div",{key:2,class:"preview-certificate",style:ut({width:`${(O.value?.width||1123)*T.value}px`,height:`${(O.value?.height||794)*T.value}px`})},[t("iframe",{ref_key:"previewIframeRef",ref:P,srcdoc:N.value,class:"preview-iframe",sandbox:"allow-same-origin"},null,8,No)],4)):(c(),g("div",Lo,[...k[10]||(k[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),t("circle",{cx:"9",cy:"9",r:"2"}),t("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})],-1),t("p",null,'Нажмите "Обновить" для генерации предпросмотра',-1)])]))]),t("div",Ro,[t("div",Oo,[k[11]||(k[11]=t("span",{class:"scale-label"},"Масштаб:",-1)),t("button",{class:at(["scale-btn",{active:T.value===.5}]),onClick:k[0]||(k[0]=a=>T.value=.5)}," 50% ",2),t("button",{class:at(["scale-btn",{active:T.value===.75}]),onClick:k[1]||(k[1]=a=>T.value=.75)}," 75% ",2),t("button",{class:at(["scale-btn",{active:T.value===1}]),onClick:k[2]||(k[2]=a=>T.value=1)}," 100% ",2)]),t("div",Vo,[t("button",{class:"btn-refresh",onClick:V,disabled:D.value},[...k[12]||(k[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.85.83 6.72 2.24"}),t("path",{d:"M21 3v6h-6"})],-1),it(" Обновить ",-1)])],8,Ko),t("button",{class:"btn-secondary",onClick:lt}," Закрыть ")])])])])):K("",!0)])),(c(),Ft(Wt,{to:"body"},[W.value?(c(),g("div",{key:0,class:at(["notification",W.value.type])},[W.value.type==="success"?(c(),g("svg",Po,[...k[13]||(k[13]=[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),t("path",{d:"m9 11 3 3L22 4"},null,-1)])])):(c(),g("svg",jo,[...k[14]||(k[14]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("path",{d:"M12 8v4"},null,-1),t("path",{d:"M12 16h.01"},null,-1)])])),t("span",null,R(W.value.message),1)],2)):K("",!0)]))]))}}),ti=zt(Uo,[["__scopeId","data-v-b11c673c"]]);export{ti as default};
