import{_ as pt}from"./CHLymgqe.js";import{r as v,f as P,q as Q,c as s,o as e,a as t,h as $,m as at,x as q,A as G,n as U,t as n,F as O,j as W,d as R,z as K,k as J,b as Z,w as Y,T as tt,K as gt,D as nt,l as mt,u as ft,B as ht}from"./GLV6bXvn.js";import{_ as E}from"./DlAUqK2U.js";import{s as kt}from"./CRUGdXr-.js";const wt={class:"tg-registration-form"},_t={key:0,class:"tg-form-step"},yt={class:"tg-form-group"},bt={key:0,class:"tg-error-text"},$t={key:1,class:"tg-form-step"},Ct={class:"tg-form-group"},xt={class:"tg-phone-input-wrapper"},zt={key:0,class:"tg-error-text"},Mt={key:2,class:"tg-form-step"},Dt={class:"tg-form-group"},It={class:"tg-autocomplete"},Nt={key:0,class:"tg-organizations-dropdown"},Tt=["onClick"],At={class:"tg-org-name"},St={key:0,class:"tg-error-text"},jt={class:"tg-form-actions"},Bt=["disabled"],Lt={key:0,class:"flex items-center gap-2"},Ut={key:1,class:"tg-btn-loading"},Vt={key:3,class:"tg-general-error"},Ot={__name:"TgAppRegistrationForm",props:{telegramData:{type:Object,required:!0}},emits:["registered"],setup(D,{emit:I}){const N=D,d=I,m=v(1),T=v(null),o=v(""),h=v({fullName:"",phone:"",organizationName:"",organizationId:null}),x=v({fullName:"",phone:"",organizationName:""}),A=v(""),S=v(!1),j=v([]),w=v(!1),z=v(null),_=v(!1),c=P(()=>{if(!h.value.organizationName)return[];const b=h.value.organizationName.toLowerCase();return j.value.filter(i=>i.name.toLowerCase().includes(b)).slice(0,10)});function p(b){let i=b.target.value.replace(/\D/g,"");i.length>9&&(i=i.substring(0,9));let L="";i.length>0&&(L=i.substring(0,2)),i.length>2&&(L+=" "+i.substring(2,5)),i.length>5&&(L+=" "+i.substring(5,7)),i.length>7&&(L+=" "+i.substring(7,9)),o.value=L}function k(b){[8,9,27,13,46,37,38,39,40].includes(b.keyCode)||(b.keyCode<48||b.keyCode>57)&&(b.keyCode<96||b.keyCode>105)&&b.preventDefault()}function M(b){const i=b.trim();return i?i.length<3?"–§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞":/^[–∞-—è—ë–ê-–Ø–Åa-zA-Z\s\-]+$/u.test(i)?"":"–§–ò–û –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã":"–§–ò–û –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è"}function y(){const b=o.value.replace(/\D/g,"");return b?b.length!==9?"–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä (9 —Ü–∏—Ñ—Ä)":"":"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}function r(){return h.value.organizationName.trim()?"":"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"}function V(){if(x.value={fullName:"",phone:"",organizationName:""},A.value="",m.value===1){const b=M(h.value.fullName);if(b){x.value.fullName=b;return}}else if(m.value===2){const b=y();if(b){x.value.phone=b;return}const i=o.value.replace(/\D/g,"");h.value.phone="+998"+i,H()}m.value++}function B(){m.value--,x.value={fullName:"",phone:"",organizationName:""},A.value=""}async function H(){if(!(j.value.length>0)){_.value=!0;try{const b=await $fetch("/api/tg-app/organizations",{query:{limit:1e3}});j.value=b.data||[]}catch(b){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:",b),A.value="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π"}finally{_.value=!1}}}function g(){z.value=null,h.value.organizationId=null,w.value=!0}function a(b){z.value=b,h.value.organizationId=b.id,h.value.organizationName=b.name,w.value=!1}async function u(){const b=r();if(b){x.value.organizationName=b;return}S.value=!0,A.value="";try{const i=await $fetch("/api/tg-app/register",{method:"POST",body:{initData:N.telegramData.initData,fullName:h.value.fullName.trim(),phone:h.value.phone,organizationId:h.value.organizationId,organizationName:h.value.organizationName.trim(),username:N.telegramData.user?.username||null}});d("registered",i)}catch(i){console.error("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:",i),A.value=i.data?.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."}finally{S.value=!1}}return Q(()=>N.telegramData,b=>{if(b?.user){const i=b.user.first_name||"",L=b.user.last_name||"";i&&!h.value.fullName&&(h.value.fullName=`${L} ${i}`.trim())}},{immediate:!0}),(b,i)=>(e(),s("div",wt,[t("form",{onSubmit:K(u,["prevent"])},[m.value===1?(e(),s("div",_t,[i[5]||(i[5]=at('<div class="tg-step-indicator" data-v-87302619><div class="tg-step-progress" data-v-87302619><div class="tg-step-dot active" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" data-v-87302619></path></svg></div><div class="tg-step-line" data-v-87302619></div><div class="tg-step-dot" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" data-v-87302619></path></svg></div><div class="tg-step-line" data-v-87302619></div><div class="tg-step-dot" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" data-v-87302619></path></svg></div></div><span class="tg-step-text" data-v-87302619>–®–∞–≥ 1 –∏–∑ 3</span></div><div class="tg-form-header" data-v-87302619><h2 data-v-87302619>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û</h2><p data-v-87302619>–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p></div>',2)),t("div",yt,[q(t("input",{"onUpdate:modelValue":i[0]||(i[0]=L=>h.value.fullName=L),type:"text",placeholder:"–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ",class:U(["tg-input",{error:x.value.fullName}]),autocomplete:"name"},null,2),[[G,h.value.fullName]]),x.value.fullName?(e(),s("p",bt,n(x.value.fullName),1)):$("",!0)]),t("button",{type:"button",onClick:V,class:"tg-btn-next"},[...i[4]||(i[4]=[t("span",null,"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",-1),t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])):$("",!0),m.value===2?(e(),s("div",$t,[i[9]||(i[9]=at('<div class="tg-step-indicator" data-v-87302619><div class="tg-step-progress" data-v-87302619><div class="tg-step-dot completed" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" data-v-87302619></path></svg></div><div class="tg-step-line filled" data-v-87302619></div><div class="tg-step-dot active" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" data-v-87302619></path></svg></div><div class="tg-step-line" data-v-87302619></div><div class="tg-step-dot" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" data-v-87302619></path></svg></div></div><span class="tg-step-text" data-v-87302619>–®–∞–≥ 2 –∏–∑ 3</span></div><div class="tg-form-header" data-v-87302619><h2 data-v-87302619>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h2><p data-v-87302619>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞</p></div>',2)),t("div",Ct,[t("div",xt,[i[6]||(i[6]=t("span",{class:"tg-phone-prefix"},"+998",-1)),q(t("input",{ref_key:"phoneInput",ref:T,"onUpdate:modelValue":i[1]||(i[1]=L=>o.value=L),type:"tel",placeholder:"XX XXX XX XX",class:U(["tg-input tg-phone-input",{error:x.value.phone}]),autocomplete:"tel",maxlength:"12",onInput:p,onKeydown:k},null,34),[[G,o.value]])]),x.value.phone?(e(),s("p",zt,n(x.value.phone),1)):$("",!0)]),t("div",{class:"tg-form-actions"},[t("button",{type:"button",onClick:B,class:"tg-btn-back"},[...i[7]||(i[7]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),t("span",null,"–ù–∞–∑–∞–¥",-1)])]),t("button",{type:"button",onClick:V,class:"tg-btn-next"},[...i[8]||(i[8]=[t("span",null,"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",-1),t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])])):$("",!0),m.value===3?(e(),s("div",Mt,[i[15]||(i[15]=at('<div class="tg-step-indicator" data-v-87302619><div class="tg-step-progress" data-v-87302619><div class="tg-step-dot completed" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" data-v-87302619></path></svg></div><div class="tg-step-line filled" data-v-87302619></div><div class="tg-step-dot completed" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" data-v-87302619></path></svg></div><div class="tg-step-line filled" data-v-87302619></div><div class="tg-step-dot active" data-v-87302619><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-87302619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" data-v-87302619></path></svg></div></div><span class="tg-step-text" data-v-87302619>–®–∞–≥ 3 –∏–∑ 3</span></div><div class="tg-form-header" data-v-87302619><h2 data-v-87302619>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</h2><p data-v-87302619>–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</p></div>',2)),t("div",Dt,[t("div",It,[q(t("input",{"onUpdate:modelValue":i[2]||(i[2]=L=>h.value.organizationName=L),type:"text",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",class:U(["tg-input",{error:x.value.organizationName}]),onInput:g,onFocus:i[3]||(i[3]=L=>w.value=!0),autocomplete:"off"},null,34),[[G,h.value.organizationName]]),w.value&&c.value.length>0?(e(),s("div",Nt,[(e(!0),s(O,null,W(c.value,L=>(e(),s("button",{key:L.id,type:"button",onClick:et=>a(L),class:"tg-org-item"},[i[10]||(i[10]=t("svg",{class:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),t("span",At,n(L.name),1),i[11]||(i[11]=t("svg",{class:"w-4 h-4 tg-org-check",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1))],8,Tt))),128))])):$("",!0)]),x.value.organizationName?(e(),s("p",St,n(x.value.organizationName),1)):$("",!0)]),t("div",jt,[t("button",{type:"button",onClick:B,class:"tg-btn-back"},[...i[12]||(i[12]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),t("span",null,"–ù–∞–∑–∞–¥",-1)])]),t("button",{type:"submit",disabled:S.value,class:"tg-btn-submit"},[S.value?(e(),s("span",Ut,[...i[14]||(i[14]=[t("span",{class:"tg-spinner-small"},null,-1),R(" –û—Ç–ø—Ä–∞–≤–∫–∞... ",-1)])])):(e(),s("span",Lt,[...i[13]||(i[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),R(" –û—Ç–ø—Ä–∞–≤–∏—Ç—å ",-1)])]))],8,Bt)])])):$("",!0),A.value?(e(),s("div",Vt,[i[16]||(i[16]=t("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("p",null,n(A.value),1)])):$("",!0)],32)]))}},Ht=E(Ot,[["__scopeId","data-v-87302619"]]),Wt={class:"tg-modal-container"},Pt={class:"tg-modal-header"},qt={class:"tg-modal-title"},Ft={class:"tg-student-avatar-lg"},Gt={class:"tg-subtitle"},Rt={class:"tg-modal-content"},Et={key:0,class:"tg-loading-block"},Xt={key:1,class:"tg-error-block"},Kt={class:"tg-info-section"},Zt={class:"tg-info-grid"},Jt={class:"tg-info-item"},Qt={class:"tg-info-value"},Yt={key:0,class:"tg-info-item"},te={class:"tg-info-value"},ee={class:"tg-info-item"},se={class:"tg-info-value"},ae={key:1,class:"tg-info-item"},ne={class:"tg-info-value tg-pinfl"},oe={key:2,class:"tg-info-item"},le={class:"tg-info-value"},ie={class:"tg-stats-section"},re={class:"tg-stat-card tg-stat-total"},ue={class:"tg-stat-value"},de={class:"tg-stat-card tg-stat-issued"},ce={class:"tg-stat-value"},ve={key:0,class:"tg-stat-card tg-stat-expired"},pe={class:"tg-stat-value"},ge={key:1,class:"tg-stat-card tg-stat-revoked"},me={class:"tg-stat-value"},fe={class:"tg-certificates-section"},he={key:0,class:"tg-empty-certs"},ke={key:1,class:"tg-certificates-list"},we={class:"tg-cert-header"},_e={class:"tg-cert-info"},ye={class:"tg-cert-number"},be={class:"tg-cert-badges"},$e={key:0,class:"tg-badge tg-badge-expired"},Ce={key:1,class:"tg-badge tg-badge-revoked"},xe={key:2,class:"tg-badge tg-badge-active"},ze={key:3,class:"tg-badge tg-badge-ai"},Me={class:"tg-cert-details"},De={class:"tg-cert-meta"},Ie={key:0,class:"tg-meta-item"},Ne={key:1,class:"tg-meta-item"},Te={key:2,class:"tg-meta-item"},Ae={key:3,class:"tg-meta-item"},Se=["onClick","disabled"],je={key:0,class:"tg-spinner-small"},Be={__name:"TgAppStudentDetailModal",props:{show:{type:Boolean,default:!1},studentId:{type:String,default:null},student:{type:Object,default:null},organizationId:{type:String,required:!0},representativeChatId:{type:String,default:null}},emits:["close"],setup(D,{emit:I}){const N=D,d=I,m=v(!1),T=v(null),o=v(null),h=v([]),x=v({total:0,issued:0,expired:0,revoked:0}),A=v(null);Q(()=>[N.show,N.studentId],([_,c])=>{_&&c?w():_||(o.value=null,h.value=[],T.value=null)},{immediate:!0});function S(_){if(!_)return"?";const c=_.trim().split(" ");return c.length>=2?c[0][0]+c[1][0]:_[0]}function j(){d("close")}async function w(){if(N.studentId){m.value=!0,T.value=null;try{const _=await $fetch(`/api/tg-app/students/${N.studentId}`,{params:{organizationId:N.organizationId}});o.value=_.student,h.value=_.certificates||[],x.value=_.stats||{total:0,issued:0,expired:0,revoked:0}}catch(_){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–ª—É—à–∞—Ç–µ–ª—è:",_),T.value=_.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"}finally{m.value=!1}}}async function z(_){if(!(!_.hasPdf||!N.representativeChatId)){A.value=_.id;try{(await $fetch("/api/tg-app/send-certificate",{method:"POST",body:{certificateId:_.id,chatId:N.representativeChatId,pdfUrl:_.pdfFileUrl,studentName:o.value?.fullName,certificateNumber:_.certificateNumber}})).success&&window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç!")}catch(c){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:",c),window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞")}finally{A.value=null}}}return(_,c)=>(e(),J(gt,{to:"body"},[Z(tt,{name:"tg-modal-fade"},{default:Y(()=>[D.show?(e(),s("div",{key:0,class:"tg-modal-overlay",onClick:K(j,["self"])},[t("div",Wt,[t("div",Pt,[t("div",qt,[t("div",Ft,n(S(D.student?.fullName)),1),t("div",null,[t("h2",null,n(D.student?.fullName),1),t("p",Gt,n(D.student?.position),1)])]),t("button",{class:"tg-modal-close",onClick:j},[...c[0]||(c[0]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Rt,[m.value?(e(),s("div",Et,[...c[1]||(c[1]=[t("div",{class:"tg-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",-1)])])):T.value?(e(),s("div",Xt,[c[2]||(c[2]=t("span",{class:"tg-error-icon"},"‚ö†Ô∏è",-1)),t("p",null,n(T.value),1),t("button",{onClick:w,class:"tg-btn-retry"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")])):o.value?(e(),s(O,{key:2},[t("div",Kt,[c[8]||(c[8]=t("h3",{class:"tg-section-title"},[t("span",{class:"tg-section-icon"},"üë§"),R(" –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ")],-1)),t("div",Zt,[t("div",Jt,[c[3]||(c[3]=t("span",{class:"tg-info-label"},"–î–æ–ª–∂–Ω–æ—Å—Ç—å",-1)),t("span",Qt,n(o.value.position),1)]),o.value.department?(e(),s("div",Yt,[c[4]||(c[4]=t("span",{class:"tg-info-label"},"–û—Ç–¥–µ–ª",-1)),t("span",te,n(o.value.department),1)])):$("",!0),t("div",ee,[c[5]||(c[5]=t("span",{class:"tg-info-label"},"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è",-1)),t("span",se,n(o.value.organizationName),1)]),o.value.pinfl?(e(),s("div",ae,[c[6]||(c[6]=t("span",{class:"tg-info-label"},"–ü–ò–ù–§–õ",-1)),t("span",ne,n(o.value.pinfl),1)])):$("",!0),o.value.registeredAt?(e(),s("div",oe,[c[7]||(c[7]=t("span",{class:"tg-info-label"},"–í —Å–∏—Å—Ç–µ–º–µ —Å",-1)),t("span",le,n(o.value.registeredAt),1)])):$("",!0)])]),t("div",ie,[t("div",re,[t("span",ue,n(x.value.total),1),c[9]||(c[9]=t("span",{class:"tg-stat-label"},"–í—Å–µ–≥–æ",-1))]),t("div",de,[t("span",ce,n(x.value.issued),1),c[10]||(c[10]=t("span",{class:"tg-stat-label"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö",-1))]),x.value.expired>0?(e(),s("div",ve,[t("span",pe,n(x.value.expired),1),c[11]||(c[11]=t("span",{class:"tg-stat-label"},"–ò—Å—Ç—ë–∫ —Å—Ä–æ–∫",-1))])):$("",!0),x.value.revoked>0?(e(),s("div",ge,[t("span",me,n(x.value.revoked),1),c[12]||(c[12]=t("span",{class:"tg-stat-label"},"–û—Ç–æ–∑–≤–∞–Ω–æ",-1))])):$("",!0)]),t("div",fe,[c[16]||(c[16]=t("h3",{class:"tg-section-title"},[t("span",{class:"tg-section-icon"},"üìú"),R(" –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã ")],-1)),h.value.length===0?(e(),s("div",he,[...c[13]||(c[13]=[t("span",{class:"tg-empty-icon"},"üì≠",-1),t("p",null,"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):(e(),s("div",ke,[(e(!0),s(O,null,W(h.value,p=>(e(),s("div",{key:p.id,class:U(["tg-cert-card",{"tg-cert-expired":p.isExpired,"tg-cert-revoked":p.status==="revoked"}])},[t("div",we,[t("div",_e,[t("h4",null,n(p.courseName),1),t("span",ye,n(p.certificateNumber),1)]),t("div",be,[p.isExpired?(e(),s("span",$e," –ò—Å—Ç—ë–∫ ")):p.status==="revoked"?(e(),s("span",Ce," –û—Ç–æ–∑–≤–∞–Ω ")):(e(),s("span",xe," –ê–∫—Ç–∏–≤–µ–Ω ")),p.importSource==="ai_scan"?(e(),s("span",ze," AI ")):$("",!0)])]),t("div",Me,[t("div",De,[p.issueDate?(e(),s("span",Ie," üìÖ –í—ã–¥–∞–Ω: "+n(p.issueDate),1)):$("",!0),p.expiryDate?(e(),s("span",Ne," ‚è∞ –î–æ: "+n(p.expiryDate),1)):$("",!0),p.courseHours?(e(),s("span",Te," üïê "+n(p.courseHours)+" —á. ",1)):$("",!0),p.groupCode?(e(),s("span",Ae," üë• "+n(p.groupCode),1)):$("",!0)])]),p.hasPdf&&p.status==="issued"?(e(),s("button",{key:0,class:"tg-btn-download",onClick:k=>z(p),disabled:A.value===p.id},[A.value===p.id?(e(),s("div",je)):(e(),s(O,{key:1},[c[14]||(c[14]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),c[15]||(c[15]=R(" –°–∫–∞—á–∞—Ç—å ",-1))],64))],8,Se)):$("",!0)],2))),128))]))])],64)):$("",!0)])])])):$("",!0)]),_:1})]))}},Le=E(Be,[["__scopeId","data-v-5774dfcf"]]),Ue={class:"tg-students-tab"},Ve={key:0,class:"tg-no-permission"},Oe={key:1},He={class:"tg-view-switcher"},We={class:"tg-filters"},Pe={class:"tg-search-wrapper"},qe=["value"],Fe={key:0,class:"tg-loading-block"},Ge={key:1,class:"tg-error-block"},Re={key:0,class:"tg-all-students"},Ee={class:"tg-list-header"},Xe={class:"tg-count"},Ke={class:"tg-students-grid"},Ze=["onClick"],Je={class:"tg-student-avatar"},Qe={class:"tg-student-main"},Ye={class:"tg-position"},ts={class:"tg-student-meta"},es={key:0,class:"tg-meta-badge tg-certs-badge"},ss={key:1,class:"tg-meta-date"},as={key:1,class:"tg-empty-state"},ns={key:0},os={key:1},ls={key:0,class:"tg-students-list"},is={class:"tg-list-header"},rs={class:"tg-count"},us=["onClick"],ds={class:"tg-group-info"},cs={class:"tg-group-title-row"},vs={key:0},ps={key:1,class:"tg-group-dates"},gs={class:"tg-group-toggle"},ms={class:"tg-student-count"},fs={key:0,class:"tg-students-in-group"},hs=["onClick"],ks={class:"tg-student-avatar"},ws={class:"tg-student-info"},_s={key:1,class:"tg-empty-state"},ys={key:0},bs={key:1},$s={__name:"TgAppStudentsTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,default:null}},setup(D){const I=D,N=v(!1),d=v(null),m=v("all"),T=v(""),o=v(""),h=v({}),x=v([]),A=v([]),S=v(!1),j=v(null),w=v(null);Q(()=>I.organizationId,g=>{g&&z()},{immediate:!0});async function z(){N.value=!0,d.value=null;try{const[g,a]=await Promise.all([$fetch("/api/tg-app/students",{params:{organizationId:I.organizationId,mode:"all"}}),$fetch("/api/tg-app/students",{params:{organizationId:I.organizationId,mode:"groups"}}).catch(()=>({students:[]}))]);if(x.value=g.students||[],A.value=a.students||[],Object.keys(k.value).length>0){const u=Object.keys(k.value)[0];h.value[u]=!0}}catch(g){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª—É—à–∞—Ç–µ–ª–µ–π:",g),d.value=g.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª—É—à–∞—Ç–µ–ª–µ–π"}finally{N.value=!1}}const _=P(()=>{let g=x.value;if(T.value){const a=T.value.toLowerCase();g=g.filter(u=>u.fullName.toLowerCase().includes(a)||u.position&&u.position.toLowerCase().includes(a))}return g}),c=P(()=>{let g=A.value;if(o.value&&(g=g.filter(a=>a.courseName===o.value)),T.value){const a=T.value.toLowerCase();g=g.filter(u=>u.fullName.toLowerCase().includes(a))}return g}),p=P(()=>{const g=new Set;return A.value.forEach(a=>{a.courseName&&g.add(a.courseName)}),Array.from(g).sort()}),k=P(()=>{const g={};return c.value.forEach(a=>{const u=a.groupName||"–ë–µ–∑ –≥—Ä—É–ø–ø—ã";g[u]||(g[u]={courseName:a.courseName,startDate:a.startDate,endDate:a.endDate,students:[]}),g[u].students.push(a)}),g});function M(g){if(!g)return"?";const a=g.trim().split(" ");return a.length>=2?a[0][0]+a[1][0]:g[0]}function y(g){h.value[g]=!h.value[g]}function r(g){if(!g)return{label:"–ê–∫—Ç–∏–≤–Ω–∞",class:"status-active"};const[a,u,b]=g.split(".").map(Number),i=new Date(b,u-1,a),L=new Date;return L.setHours(0,0,0,0),i<L?{label:"–ó–∞–≤–µ—Ä—à–µ–Ω–∞",class:"status-completed"}:{label:"–ê–∫—Ç–∏–≤–Ω–∞",class:"status-active"}}function V(g){j.value=g.id,w.value=g,S.value=!0}function B(g,a=null){if(a){const b=x.value.find(i=>i.id===a);if(b){V(b);return}j.value=a,w.value={id:a,fullName:g},S.value=!0;return}const u=x.value.find(b=>b.fullName.toLowerCase()===g.toLowerCase());if(u)V(u);else{const b=A.value.find(i=>i.fullName.toLowerCase()===g.toLowerCase());b?.id?(j.value=b.id,w.value={id:b.id,fullName:g},S.value=!0):window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–°–ª—É—à–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")}}function H(){S.value=!1,j.value=null,w.value=null}return(g,a)=>(e(),s("div",Ue,[D.permissions?.can_view_students?(e(),s("div",Oe,[t("div",He,[t("button",{class:U(["tg-view-btn",{active:m.value==="all"}]),onClick:a[0]||(a[0]=u=>m.value="all")},[...a[5]||(a[5]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})],-1),R(" –í—Å–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ ",-1)])],2),t("button",{class:U(["tg-view-btn",{active:m.value==="groups"}]),onClick:a[1]||(a[1]=u=>m.value="groups")},[...a[6]||(a[6]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),R(" –ü–æ –≥—Ä—É–ø–ø–∞–º ",-1)])],2)]),t("div",We,[t("div",Pe,[a[7]||(a[7]=t("div",{class:"tg-search-icon"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),q(t("input",{"onUpdate:modelValue":a[2]||(a[2]=u=>T.value=u),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏...",class:"tg-search-input"},null,512),[[G,T.value]])]),m.value==="groups"?q((e(),s("select",{key:0,"onUpdate:modelValue":a[3]||(a[3]=u=>o.value=u),class:"tg-select"},[a[8]||(a[8]=t("option",{value:""},"–í—Å–µ –∫—É—Ä—Å—ã",-1)),(e(!0),s(O,null,W(p.value,u=>(e(),s("option",{key:u,value:u},n(u),9,qe))),128))],512)),[[nt,o.value]]):$("",!0)]),N.value?(e(),s("div",Fe,[...a[9]||(a[9]=[t("div",{class:"tg-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π...",-1)])])):d.value?(e(),s("div",Ge,[a[10]||(a[10]=t("div",{class:"tg-icon-wrapper tg-error-icon-wrapper"},[t("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t("p",null,n(d.value),1),t("button",{onClick:z,class:"tg-btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):m.value==="all"?(e(),s(O,{key:2},[_.value.length>0?(e(),s("div",Re,[t("div",Ee,[a[11]||(a[11]=t("h3",null,"–°–ª—É—à–∞—Ç–µ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",-1)),t("span",Xe,n(_.value.length),1)]),t("div",Ke,[(e(!0),s(O,null,W(_.value,u=>(e(),s("div",{key:u.id,class:"tg-student-card",onClick:b=>V(u)},[t("div",Je,n(M(u.fullName)),1),t("div",Qe,[t("h4",null,n(u.fullName),1),t("p",Ye,n(u.position),1),t("div",ts,[u.certificatesCount>0?(e(),s("span",es," üìú "+n(u.certificatesCount),1)):$("",!0),u.lastCertificateDate?(e(),s("span",ss,n(u.lastCertificateDate),1)):$("",!0)])]),a[12]||(a[12]=t("div",{class:"tg-student-arrow"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))],8,Ze))),128))])])):(e(),s("div",as,[a[13]||(a[13]=t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),a[14]||(a[14]=t("h3",null,"–ù–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π",-1)),T.value?(e(),s("p",ns,"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å")):(e(),s("p",os,"–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π –æ—Ç –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"))]))],64)):m.value==="groups"?(e(),s(O,{key:3},[c.value.length>0?(e(),s("div",ls,[t("div",is,[a[15]||(a[15]=t("h3",null,"–°–ª—É—à–∞—Ç–µ–ª–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö",-1)),t("span",rs,n(c.value.length),1)]),(e(!0),s(O,null,W(k.value,(u,b)=>(e(),s("div",{key:b,class:"tg-group-section"},[t("div",{class:"tg-group-header",onClick:i=>y(b)},[t("div",ds,[t("div",cs,[t("h4",null,n(b),1),t("span",{class:U(["tg-group-status",r(u.endDate).class])},n(r(u.endDate).label),3)]),u.courseName?(e(),s("p",vs,n(u.courseName),1)):$("",!0),u.startDate&&u.endDate?(e(),s("div",ps," üìÖ "+n(u.startDate)+" - "+n(u.endDate),1)):$("",!0)]),t("div",gs,[t("span",ms,n(u.students.length),1),t("span",{class:U(["tg-toggle-icon",{expanded:h.value[b]}])},[...a[16]||(a[16]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)])],2)])],8,us),Z(tt,{name:"tg-collapse"},{default:Y(()=>[h.value[b]?(e(),s("div",fs,[(e(!0),s(O,null,W(u.students,(i,L)=>(e(),s("div",{key:i.id||L,class:"tg-student-item",onClick:et=>B(i.fullName,i.id)},[t("div",ks,n(M(i.fullName)),1),t("div",ws,[t("h5",null,n(i.fullName),1)]),a[17]||(a[17]=t("div",{class:"tg-student-arrow-small"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))],8,hs))),128))])):$("",!0)]),_:2},1024)]))),128))])):(e(),s("div",_s,[a[18]||(a[18]=t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})])],-1)),a[19]||(a[19]=t("h3",null,"–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø",-1)),T.value||o.value?(e(),s("p",ys," –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ")):(e(),s("p",bs," –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–µ–±–Ω—ã—Ö –≥—Ä—É–ø–ø —Å –≤–∞—à–∏–º–∏ —Å–ª—É—à–∞—Ç–µ–ª—è–º–∏ "))]))],64)):$("",!0)])):(e(),s("div",Ve,[...a[4]||(a[4]=[t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})])],-1),t("h3",null,"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",-1),t("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π",-1)])])),Z(Le,{show:S.value,"student-id":j.value,student:w.value,"organization-id":D.organizationId,"representative-chat-id":D.representative?.telegramChatId,onClose:H},null,8,["show","student-id","student","organization-id","representative-chat-id"])]))}},ot=E($s,[["__scopeId","data-v-4202c452"]]),Cs={class:"tg-schedule-tab"},xs={key:0,class:"tg-no-permission"},zs={key:1},Ms={key:0,class:"tg-loading-block"},Ds={key:1,class:"tg-error-block"},Is={key:2,class:"tg-schedule-list"},Ns={class:"tg-date-header"},Ts={class:"tg-date-info"},As={class:"tg-events-count"},Ss={class:"tg-events"},js={class:"tg-event-time"},Bs={class:"tg-time"},Ls={class:"tg-time"},Us={class:"tg-event-content"},Vs={class:"tg-type-icon"},Os={class:"tg-type-label"},Hs={class:"tg-event-discipline"},Ws={class:"tg-event-details"},Ps={class:"tg-event-detail"},qs={class:"tg-event-detail"},Fs={key:0,class:"tg-event-detail"},Gs={key:3,class:"tg-empty-state"},Rs={__name:"TgAppScheduleTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0}},setup(D){const I=D,N=v(!1),d=v(null),m=v([]),T=P(()=>{const w={};return m.value.forEach(z=>{const _=z.date;w[_]||(w[_]={date:_,events:[]}),w[_].events.push(z)}),Object.values(w).sort((z,_)=>new Date(z.date)-new Date(_.date))});function o(w){if(typeof w=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(w)){const[z,_,c]=w.split("-").map(Number);return new Date(z,_-1,c)}return new Date(w)}function h(w){return o(w).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})}function x(w){return o(w).toLocaleDateString("ru-RU",{weekday:"long"})}function A(w){return{theory:"üìñ",practice:"üíª",knowledge_check:"üìù",retake:"üîÑ"}[w]||"üìö"}function S(w){return{theory:"–¢–µ–æ—Ä–∏—è",practice:"–ü—Ä–∞–∫—Ç–∏–∫–∞",knowledge_check:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π",retake:"–ü–µ—Ä–µ—Å–¥–∞—á–∞"}[w]||w}async function j(){N.value=!0,d.value=null;try{const w=await $fetch("/api/tg-app/schedule",{params:{organizationId:I.organizationId}});m.value=w.schedule||[]}catch(w){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:",w),d.value=w.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ"}finally{N.value=!1}}return Q(()=>I.organizationId,w=>{w&&j()},{immediate:!0}),(w,z)=>(e(),s("div",Cs,[D.permissions?.can_view_schedule?(e(),s("div",zs,[N.value?(e(),s("div",Ms,[...z[1]||(z[1]=[t("div",{class:"tg-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...",-1)])])):d.value?(e(),s("div",Ds,[z[2]||(z[2]=t("span",{class:"tg-icon"},"‚ö†Ô∏è",-1)),t("p",null,n(d.value),1),t("button",{onClick:j,class:"tg-btn-retry"},"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å")])):T.value.length>0?(e(),s("div",Is,[(e(!0),s(O,null,W(T.value,_=>(e(),s("div",{key:_.date,class:"tg-date-group"},[t("div",Ns,[z[3]||(z[3]=t("span",{class:"tg-date-icon"},"üìÖ",-1)),t("div",Ts,[t("h3",null,n(h(_.date)),1),t("p",null,n(x(_.date)),1)]),t("span",As,n(_.events.length),1)]),t("div",Ss,[(e(!0),s(O,null,W(_.events,(c,p)=>(e(),s("div",{key:p,class:"tg-event-card"},[t("div",js,[t("span",Bs,n(c.startTime),1),z[4]||(z[4]=t("span",{class:"tg-time-separator"},"-",-1)),t("span",Ls,n(c.endTime),1)]),t("div",Us,[t("div",{class:U(["tg-event-type",`tg-type-${c.eventType}`])},[t("span",Vs,n(A(c.eventType)),1),t("span",Os,n(S(c.eventType)),1)],2),t("h4",Hs,n(c.disciplineName),1),t("div",Ws,[t("div",Ps,[z[5]||(z[5]=t("span",{class:"tg-detail-icon"},"üë®‚Äçüè´",-1)),t("span",null,n(c.instructorName),1)]),t("div",qs,[z[6]||(z[6]=t("span",{class:"tg-detail-icon"},"üë•",-1)),t("span",null,n(c.groupName),1)]),c.location?(e(),s("div",Fs,[z[7]||(z[7]=t("span",{class:"tg-detail-icon"},"üö™",-1)),t("span",null,n(c.location),1)])):$("",!0)])])]))),128))])]))),128))])):(e(),s("div",Gs,[...z[8]||(z[8]=[t("span",{class:"tg-empty-icon"},"üìÖ",-1),t("h3",null,"–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π",-1),t("p",null," –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π –¥–ª—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ ",-1)])]))])):(e(),s("div",xs,[...z[0]||(z[0]=[t("span",{class:"tg-icon"},"üö´",-1),t("h3",null,"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",-1),t("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è",-1)])]))]))}},Es=E(Rs,[["__scopeId","data-v-1d2bceed"]]),Xs={class:"tg-certificates-tab"},Ks={key:0,class:"tg-no-permission"},Zs={key:1},Js={class:"tg-filters"},Qs={class:"tg-search-wrapper"},Ys={class:"tg-filter-row"},ta=["value"],ea=["value"],sa={key:0,class:"tg-loading-block"},aa={key:1,class:"tg-error-block"},na={key:2},oa={class:"tg-list-header"},la={class:"tg-header-info"},ia={class:"tg-count"},ra=["disabled"],ua={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},da={key:1,class:"tg-spinner-small"},ca={class:"tg-table-wrapper"},va={class:"tg-table"},pa={class:"tg-cell-info"},ga={class:"tg-student-name"},ma={class:"tg-cert-details"},fa={class:"tg-course-name"},ha={class:"tg-cert-meta"},ka={class:"tg-date"},wa={class:"tg-group-badge-small"},_a={class:"tg-cell-actions"},ya=["onClick","disabled"],ba={key:0,class:"tg-spinner-small"},$a={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ca={key:1,class:"tg-revoked-badge"},xa={key:3,class:"tg-empty-state"},za={key:0},Ma={key:1},Da={__name:"TgAppCertificatesTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,required:!0}},setup(D){const I=D,N=v(!1),d=v(null),m=v([]),T=v(""),o=v(""),h=v(""),x=v(null),A=v(!1),S=P(()=>{const p=new Set;return m.value.forEach(k=>{if(k.issueDate){const M=k.issueDate.split(".");if(M.length===3){const y=M[1],r=M[2];p.add(`${y}.${r}`)}}}),Array.from(p).sort((k,M)=>{const[y,r]=k.split(".").map(Number),[V,B]=M.split(".").map(Number);return r!==B?B-r:V-y})}),j=P(()=>{const p=new Set;return m.value.forEach(k=>{k.groupCode&&p.add(k.groupCode)}),Array.from(p).sort()}),w=P(()=>{let p=m.value;if(T.value){const k=T.value.toLowerCase();p=p.filter(M=>M.studentName.toLowerCase().includes(k))}return o.value&&(p=p.filter(k=>{if(!k.issueDate)return!1;const M=k.issueDate.split(".");return M.length!==3?!1:`${M[1]}.${M[2]}`===o.value})),h.value&&(p=p.filter(k=>k.groupCode===h.value)),p});async function z(p){if(p.pdfFileUrl){x.value=p.id;try{(await $fetch("/api/tg-app/send-certificate",{method:"POST",body:{certificateId:p.id,chatId:I.representative.telegramChatId,pdfUrl:p.pdfFileUrl,studentName:p.studentName,certificateNumber:p.certificateNumber}})).success&&window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç!")}catch(k){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:",k),window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞")}finally{x.value=null}}}async function _(){if(h.value){A.value=!0;try{(await $fetch("/api/tg-app/download-group-certificates",{method:"POST",body:{groupCode:h.value,organizationId:I.organizationId,chatId:I.representative.telegramChatId}})).success&&window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("ZIP –∞—Ä—Ö–∏–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç!")}catch(p){console.error("–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ZIP:",p),window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞")}finally{A.value=!1}}}async function c(){N.value=!0,d.value=null;try{const p=await $fetch("/api/tg-app/certificates",{params:{organizationId:I.organizationId}});m.value=p.certificates||[]}catch(p){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:",p),d.value=p.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"}finally{N.value=!1}}return Q(()=>I.organizationId,p=>{p&&c()},{immediate:!0}),(p,k)=>(e(),s("div",Xs,[D.permissions?.can_view_certificates?(e(),s("div",Zs,[t("div",Js,[t("div",Qs,[k[4]||(k[4]=t("svg",{class:"tg-search-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),q(t("input",{"onUpdate:modelValue":k[0]||(k[0]=M=>T.value=M),type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞...",class:"tg-search-input"},null,512),[[G,T.value]])]),t("div",Ys,[q(t("select",{"onUpdate:modelValue":k[1]||(k[1]=M=>o.value=M),class:"tg-select"},[k[5]||(k[5]=t("option",{value:""},"–í—Å–µ –ø–µ—Ä–∏–æ–¥—ã",-1)),(e(!0),s(O,null,W(S.value,M=>(e(),s("option",{key:M,value:M},n(M),9,ta))),128))],512),[[nt,o.value]]),q(t("select",{"onUpdate:modelValue":k[2]||(k[2]=M=>h.value=M),class:"tg-select"},[k[6]||(k[6]=t("option",{value:""},"–í—Å–µ –≥—Ä—É–ø–ø—ã",-1)),(e(!0),s(O,null,W(j.value,M=>(e(),s("option",{key:M,value:M},n(M),9,ea))),128))],512),[[nt,h.value]])])]),N.value?(e(),s("div",sa,[...k[7]||(k[7]=[t("div",{class:"tg-spinner"},null,-1),t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤...",-1)])])):d.value?(e(),s("div",aa,[k[8]||(k[8]=t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t("p",null,n(d.value),1),t("button",{onClick:c,class:"tg-btn-retry"}," –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ")])):w.value.length>0?(e(),s("div",na,[t("div",oa,[t("div",la,[k[9]||(k[9]=t("h3",null,"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã",-1)),t("span",ia,n(w.value.length),1)]),h.value&&w.value.length>0?(e(),s("button",{key:0,onClick:_,disabled:A.value,class:"tg-btn-zip"},[A.value?(e(),s("div",da)):(e(),s("svg",ua,[...k[10]||(k[10]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])),t("span",null,n(A.value?"–ó–∞–≥—Ä—É–∑–∫–∞...":"ZIP"),1)],8,ra)):$("",!0)]),t("div",ca,[t("table",va,[k[13]||(k[13]=t("thead",null,[t("tr",null,[t("th",{style:{width:"80%"}},"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"),t("th",{style:{width:"20%","text-align":"center"}},"–î–µ–π—Å—Ç–≤–∏—è")])],-1)),t("tbody",null,[(e(!0),s(O,null,W(w.value,(M,y)=>(e(),s("tr",{key:y,class:U({revoked:M.status==="revoked"})},[t("td",pa,[t("div",ga,n(M.studentName),1),t("div",ma,[t("span",fa,n(M.courseName),1)]),t("div",ha,[t("span",ka,n(M.issueDate),1),k[11]||(k[11]=t("span",{class:"tg-separator"},"‚Ä¢",-1)),t("span",wa,n(M.groupCode),1)])]),t("td",_a,[M.pdfFileUrl&&M.status==="issued"?(e(),s("button",{key:0,onClick:r=>z(M),disabled:x.value===M.id,class:"tg-btn-send",title:"–°–∫–∞—á–∞—Ç—å (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç)"},[x.value===M.id?(e(),s("div",ba)):(e(),s("svg",$a,[...k[12]||(k[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])]))],8,ya)):M.status==="revoked"?(e(),s("span",Ca," –û—Ç–æ–∑–≤–∞–Ω ")):$("",!0)])],2))),128))])])])])):(e(),s("div",xa,[k[14]||(k[14]=t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})])],-1)),k[15]||(k[15]=t("h3",null,"–ù–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)),T.value||o.value||h.value?(e(),s("p",za," –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã ")):(e(),s("p",Ma,"–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –≤—ã–¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤"))]))])):(e(),s("div",Ks,[...k[3]||(k[3]=[t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})])],-1),t("h3",null,"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",-1),t("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)])]))]))}},Ia=E(Da,[["__scopeId","data-v-deaf5613"]]),Na={class:"tg-ai-upload-tab"},Ta={key:0,class:"tg-no-permission"},Aa={key:1},Sa={key:0,class:"tg-success-block"},ja={key:1},Ba={class:"tg-wizard-progress"},La={class:"tg-step-number"},Ua={class:"tg-step-label"},Va={key:0,class:"tg-step-content"},Oa={key:0,class:"tg-upload-placeholder"},Ha={key:1,class:"tg-files-preview"},Wa=["src"],Pa={key:1,class:"tg-file-icon"},qa={class:"tg-file-info"},Fa={class:"tg-file-name"},Ga={class:"tg-file-size"},Ra=["onClick"],Ea={key:0,class:"tg-error-message"},Xa=["disabled"],Ka={key:0,class:"tg-btn-spinner"},Za={key:1,class:"tg-step-content"},Ja={class:"tg-analysis-progress"},Qa={class:"tg-progress-bar"},Ya={class:"tg-progress-text"},tn={class:"tg-analysis-items"},en={class:"tg-item-icon"},sn={class:"tg-item-name"},an={key:0,class:"tg-item-badge tg-badge-warning"},nn={key:2,class:"tg-step-content"},on={class:"tg-results-list"},ln=["onClick"],rn={class:"tg-card-info"},un={class:"tg-card-meta"},dn={class:"tg-card-status"},cn={key:0,class:"tg-status-badge tg-status-ready"},vn={key:1,class:"tg-status-badge tg-status-pending"},pn={key:0,class:"tg-card-body"},gn={class:"tg-extracted-data"},mn={class:"tg-data-row"},fn={class:"tg-data-value"},hn={class:"tg-data-row"},kn={class:"tg-data-value"},wn={key:0,class:"tg-data-row"},_n={class:"tg-data-value"},yn={class:"tg-student-select"},bn={key:0,class:"tg-alternatives"},$n=["onClick"],Cn={class:"tg-alt-radio"},xn={key:0},zn={key:1},Mn={class:"tg-alt-info"},Dn={class:"tg-alt-name"},In={class:"tg-alt-position"},Nn={class:"tg-alt-score"},Tn={key:0,class:"tg-best-match"},An={key:1,class:"tg-no-matches"},Sn={key:0,class:"tg-duplicates-section"},jn={class:"tg-duplicate-list"},Bn={class:"tg-dup-name"},Ln={class:"tg-dup-reason"},Un={class:"tg-step-actions"},Vn=["disabled"],On={key:3,class:"tg-step-content"},Hn={class:"tg-confirm-summary"},Wn={class:"tg-summary-card"},Pn={class:"tg-summary-value"},qn={class:"tg-summary-card tg-card-warning"},Fn={class:"tg-summary-value"},Gn={class:"tg-summary-card tg-card-error"},Rn={class:"tg-summary-value"},En={key:0,class:"tg-error-message"},Xn={class:"tg-step-actions"},Kn=["disabled"],Zn={key:0,class:"tg-btn-spinner"},Jn={__name:"TgAppCertificateAIUploadTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,default:null}},setup(D){const I=D,N=P(()=>I.permissions?.can_request_certificates||I.permissions?.can_upload_certificates),d=v(1),m=v([]),T=v(null),o=v(!1),h=v(!1),x=v(""),A=v([]),S=v(0),j=v([]),w=v(!1),z=v({}),_=v({}),c=v(!1),p=v(""),k=v(!1),M=v(""),y=P(()=>j.value.filter(C=>C.success&&!C.extractedData?._isDuplicate)),r=P(()=>j.value.filter(C=>C.success&&C.extractedData?._isDuplicate)),V=P(()=>j.value.filter(C=>!C.success)),B=P(()=>y.value.filter(C=>_.value[C.fileId]).length),H=P(()=>B.value>0);function g(C){return["–ó–∞–≥—Ä—É–∑–∫–∞","–ê–Ω–∞–ª–∏–∑","–ü—Ä–æ–≤–µ—Ä–∫–∞","–ò–º–ø–æ—Ä—Ç"][C-1]||""}function a(C){return C<1024?C+" –ë":C<1024*1024?Math.round(C/1024)+" –ö–ë":(C/(1024*1024)).toFixed(1)+" –ú–ë"}function u(){T.value?.click()}function b(C){const l=Array.from(C.target.files||[]);L(l),C.target.value=""}function i(C){o.value=!1;const l=Array.from(C.dataTransfer?.files||[]);L(l)}function L(C){if(x.value="",m.value.length+C.length>10){x.value="–ú–∞–∫—Å–∏–º—É–º 10 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑";return}for(const l of C){if(!["image/jpeg","image/png","application/pdf"].includes(l.type)){x.value=`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${l.name}`;continue}if(l.size>10*1024*1024){x.value=`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${l.name}`;continue}const X={file:l,name:l.name,size:l.size,preview:null};if(l.type.startsWith("image/")){const F=new FileReader;F.onload=st=>{X.preview=st.target?.result},F.readAsDataURL(l)}m.value.push(X)}}function et(C){m.value.splice(C,1)}async function lt(){if(m.value.length!==0){h.value=!0,x.value="";try{const C=new FormData;C.append("organizationId",I.organizationId),C.append("representativeId",I.representative?.id||"");for(const f of m.value)C.append("files",f.file);const l=await $fetch("/api/tg-app/certificates/ai-batch/upload",{method:"POST",body:C});l.success?(A.value=l.files.filter(f=>f.success).map(f=>f.fileId),d.value=2,await it()):x.value=l.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:",C),x.value=C.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã"}finally{h.value=!1}}}async function it(){if(A.value.length!==0){w.value=!0,S.value=10;try{const C=kt(()=>{if(S.value<90){const f=Math.random()*8;S.value=Math.min(90,Math.round(S.value+f))}},500),l=await $fetch("/api/tg-app/certificates/ai-batch/analyze",{method:"POST",body:{fileIds:A.value,organizationId:I.organizationId}});if(clearInterval(C),S.value=100,l.success){j.value=l.results;for(const f of l.results)if(f.success&&!f.extractedData?._isDuplicate&&f.matchResult?.topAlternatives?.length>0){const X=f.matchResult.topAlternatives[0];X.matchScore>=70&&(_.value[f.fileId]=X.student.id),Object.keys(z.value).length===0&&(z.value[f.fileId]=!0)}setTimeout(()=>{d.value=3},500)}}catch(C){console.error("–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:",C),x.value=C.data?.message||"–û—à–∏–±–∫–∞ AI-–∞–Ω–∞–ª–∏–∑–∞",d.value=1}finally{w.value=!1}}}function rt(C){z.value[C]=!z.value[C]}function ut(C,l){_.value[C]=l.id}function dt(C){return C>=90?"tg-score-excellent":C>=70?"tg-score-good":C>=50?"tg-score-medium":"tg-score-low"}async function ct(){c.value=!0,p.value="";try{const C=y.value.filter(f=>_.value[f.fileId]).map(f=>({fileId:f.fileId,studentId:_.value[f.fileId],extractedData:f.extractedData})),l=await $fetch("/api/tg-app/certificates/ai-batch/confirm",{method:"POST",body:{items:C,organizationId:I.organizationId,representativeId:I.representative?.id}});l.success?(k.value=!0,M.value=l.message,window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${l.created} —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤`)):p.value=l.message||"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞"}catch(C){console.error("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:",C),p.value=C.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"}finally{c.value=!1}}function vt(){d.value=1,m.value=[],A.value=[],S.value=0,j.value=[],z.value={},_.value={},k.value=!1,M.value="",x.value="",p.value=""}return(C,l)=>(e(),s("div",Na,[N.value?(e(),s("div",Aa,[k.value?(e(),s("div",Sa,[l[6]||(l[6]=t("div",{class:"tg-success-icon"},[t("svg",{class:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),l[7]||(l[7]=t("h3",null,"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!",-1)),t("p",null,n(M.value),1),t("button",{onClick:vt,class:"tg-btn-primary"}," –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë ")])):(e(),s("div",ja,[t("div",Ba,[(e(),s(O,null,W(4,f=>t("div",{key:f,class:U(["tg-wizard-step",{active:d.value===f,completed:d.value>f}])},[t("span",La,n(f),1),t("span",Ua,n(g(f)),1)],2)),64))]),d.value===1?(e(),s("div",Va,[l[9]||(l[9]=t("h2",{class:"tg-step-title"},"üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤",-1)),l[10]||(l[10]=t("p",{class:"tg-step-subtitle"}," –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è ",-1)),t("div",{class:U(["tg-upload-zone",{"tg-dragging":o.value,"tg-has-files":m.value.length>0}]),onDrop:K(i,["prevent"]),onDragover:l[0]||(l[0]=K(f=>o.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=K(f=>o.value=!1,["prevent"])),onClick:u},[m.value.length===0?(e(),s("div",Oa,[...l[8]||(l[8]=[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),t("p",{class:"tg-upload-text"},"–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤",-1),t("p",{class:"tg-upload-hint"},"–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞",-1)])])):(e(),s("div",Ha,[(e(!0),s(O,null,W(m.value,(f,X)=>(e(),s("div",{key:X,class:"tg-file-item"},[f.preview?(e(),s("img",{key:0,src:f.preview,class:"tg-file-thumb",alt:""},null,8,Wa)):(e(),s("div",Pa,"üìÑ")),t("div",qa,[t("span",Fa,n(f.name),1),t("span",Ga,n(a(f.size)),1)]),t("button",{type:"button",class:"tg-file-remove",onClick:K(F=>et(X),["stop"])}," ‚úï ",8,Ra)]))),128))]))],34),t("input",{ref_key:"fileInputRef",ref:T,type:"file",accept:"image/jpeg,image/png,application/pdf",multiple:"",class:"tg-hidden-input",onChange:b},null,544),l[11]||(l[11]=t("div",{class:"tg-upload-info"},[t("span",{class:"tg-info-badge"},"üìÑ –î–æ 10 —Ñ–∞–π–ª–æ–≤"),t("span",{class:"tg-info-badge"},"üìè –î–æ 10 –ú–ë –∫–∞–∂–¥—ã–π"),t("span",{class:"tg-info-badge"},"üìã JPG, PNG, PDF")],-1)),x.value?(e(),s("div",Ea,n(x.value),1)):$("",!0),t("button",{class:"tg-btn-primary",disabled:m.value.length===0||h.value,onClick:lt},[h.value?(e(),s("span",Ka)):(e(),s(O,{key:1},[R(" –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å ("+n(m.value.length)+") ",1)],64))],8,Xa)])):$("",!0),d.value===2?(e(),s("div",Za,[l[12]||(l[12]=t("h2",{class:"tg-step-title"},"ü§ñ AI –ê–Ω–∞–ª–∏–∑",-1)),l[13]||(l[13]=t("p",{class:"tg-step-subtitle"},"–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)),t("div",Ja,[t("div",Qa,[t("div",{class:"tg-progress-fill",style:mt({width:S.value+"%"})},null,4)]),t("p",Ya,n(S.value)+"% ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞... ",1)]),t("div",tn,[(e(!0),s(O,null,W(j.value,f=>(e(),s("div",{key:f.fileId,class:U(["tg-analysis-item",{"tg-item-success":f.success,"tg-item-error":!f.success,"tg-item-duplicate":f.extractedData?._isDuplicate}])},[t("span",en,n(f.success?f.extractedData?._isDuplicate?"‚ö†Ô∏è":"‚úÖ":"‚ùå"),1),t("span",sn,n(f.filename),1),f.extractedData?._isDuplicate?(e(),s("span",an," –î—É–±–ª–∏–∫–∞—Ç ")):$("",!0)],2))),128))])])):$("",!0),d.value===3?(e(),s("div",nn,[l[20]||(l[20]=t("h2",{class:"tg-step-title"},"üë• –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö",-1)),l[21]||(l[21]=t("p",{class:"tg-step-subtitle"}," –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π ",-1)),t("div",on,[(e(!0),s(O,null,W(y.value,(f,X)=>(e(),s("div",{key:f.fileId,class:U(["tg-result-card",{"tg-card-expanded":z.value[f.fileId]}])},[t("div",{class:"tg-card-header",onClick:F=>rt(f.fileId)},[t("div",rn,[t("h4",null,n(f.extractedData?.fullName||"–ò–º—è –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ"),1),t("p",un," ‚Ññ "+n(f.extractedData?.certificateNumber||"‚Äî"),1)]),t("div",dn,[_.value[f.fileId]?(e(),s("span",cn," ‚úì –ì–æ—Ç–æ–≤ ")):(e(),s("span",vn," –í—ã–±–µ—Ä–∏—Ç–µ "))]),t("span",{class:U(["tg-card-arrow",{"tg-arrow-up":z.value[f.fileId]}])}," ‚ñº ",2)],8,ln),Z(tt,{name:"tg-expand"},{default:Y(()=>[z.value[f.fileId]?(e(),s("div",pn,[t("div",gn,[t("div",mn,[l[14]||(l[14]=t("span",{class:"tg-data-label"},"–ö—É—Ä—Å:",-1)),t("span",fn,n(f.extractedData?.courseName||"–ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ"),1)]),t("div",hn,[l[15]||(l[15]=t("span",{class:"tg-data-label"},"–î–∞—Ç–∞:",-1)),t("span",kn,n(f.extractedData?.issueDate||"–ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ"),1)]),f.extractedData?.issuingOrganization?(e(),s("div",wn,[l[16]||(l[16]=t("span",{class:"tg-data-label"},"–¶–µ–Ω—Ç—Ä:",-1)),t("span",_n,n(f.extractedData.issuingOrganization),1)])):$("",!0)]),t("div",yn,[l[18]||(l[18]=t("label",{class:"tg-select-label"},"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª—É—à–∞—Ç–µ–ª—è:",-1)),f.matchResult?.topAlternatives?.length?(e(),s("div",bn,[(e(!0),s(O,null,W(f.matchResult.topAlternatives.slice(0,5),(F,st)=>(e(),s("div",{key:F.student.id,class:U(["tg-alternative-item",{"tg-item-selected":_.value[f.fileId]===F.student.id}]),onClick:Pl=>ut(f.fileId,F.student)},[t("div",Cn,[_.value[f.fileId]===F.student.id?(e(),s("span",xn,"‚óè")):(e(),s("span",zn,"‚óã"))]),t("div",Mn,[t("span",Dn,n(F.student.fullName),1),t("span",In,n(F.student.position),1)]),t("div",Nn,[t("span",{class:U(["tg-score-badge",dt(F.matchScore)])},n(Math.round(F.matchScore))+"% ",3),st===0?(e(),s("span",Tn,"üèÜ")):$("",!0)])],10,$n))),128))])):(e(),s("div",An,[...l[17]||(l[17]=[t("p",null,"–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",-1),t("p",{class:"tg-hint"}," –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–ª—É—à–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é ",-1)])]))])])):$("",!0)]),_:2},1024)],2))),128))]),r.value.length>0?(e(),s("div",Sn,[l[19]||(l[19]=t("h4",{class:"tg-section-title"},"‚ö†Ô∏è –î—É–±–ª–∏–∫–∞—Ç—ã (–±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã)",-1)),t("div",jn,[(e(!0),s(O,null,W(r.value,f=>(e(),s("div",{key:f.fileId,class:"tg-duplicate-item"},[t("span",Bn,n(f.filename),1),t("span",Ln,n(f.extractedData?._duplicateInfo),1)]))),128))])])):$("",!0),t("div",Un,[t("button",{class:"tg-btn-secondary",onClick:l[2]||(l[2]=f=>d.value=1)},"‚Üê –ù–∞–∑–∞–¥"),t("button",{class:"tg-btn-primary",disabled:!H.value,onClick:l[3]||(l[3]=f=>d.value=4)}," –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å ("+n(B.value)+") ",9,Vn)])])):$("",!0),d.value===4?(e(),s("div",On,[l[25]||(l[25]=t("h2",{class:"tg-step-title"},"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",-1)),l[26]||(l[26]=t("p",{class:"tg-step-subtitle"},"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∏–º–ø–æ—Ä—Ç",-1)),t("div",Hn,[t("div",Wn,[t("span",Pn,n(B.value),1),l[22]||(l[22]=t("span",{class:"tg-summary-label"},"–ö –∏–º–ø–æ—Ä—Ç—É",-1))]),t("div",qn,[t("span",Fn,n(r.value.length),1),l[23]||(l[23]=t("span",{class:"tg-summary-label"},"–î—É–±–ª–∏–∫–∞—Ç–æ–≤",-1))]),t("div",Gn,[t("span",Rn,n(V.value.length),1),l[24]||(l[24]=t("span",{class:"tg-summary-label"},"–û—à–∏–±–æ–∫",-1))])]),p.value?(e(),s("div",En,n(p.value),1)):$("",!0),t("div",Xn,[t("button",{class:"tg-btn-secondary",onClick:l[4]||(l[4]=f=>d.value=3)},"‚Üê –ù–∞–∑–∞–¥"),t("button",{class:"tg-btn-primary tg-btn-success",disabled:c.value||B.value===0,onClick:ct},[c.value?(e(),s("span",Zn)):(e(),s(O,{key:1},[R(" –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å "+n(B.value)+" —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ ",1)],64))],8,Kn)])])):$("",!0)]))])):(e(),s("div",Ta,[...l[5]||(l[5]=[t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})])],-1),t("h3",null,"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",-1),t("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)])]))]))}},Qn=E(Jn,[["__scopeId","data-v-495044bd"]]),Yn={class:"tg-upload-tab"},to={key:0,class:"tg-no-permission"},eo={key:1},so={key:0,class:"tg-success-block"},ao={class:"tg-form-group"},no={class:"tg-autocomplete"},oo={class:"tg-search-input-wrapper"},lo={key:0,class:"tg-input-spinner"},io={key:0,class:"tg-dropdown"},ro=["onClick"],uo={class:"tg-dropdown-avatar"},co={class:"tg-dropdown-info"},vo={class:"tg-dropdown-name"},po={class:"tg-dropdown-meta"},go={key:0,class:"tg-dropdown-badge"},mo={key:1,class:"tg-selected-student"},fo={class:"tg-selected-avatar"},ho={class:"tg-selected-info"},ko={class:"tg-selected-name"},wo={class:"tg-selected-meta"},_o={key:0,class:"tg-error-text"},yo={class:"tg-form-group"},bo={key:0,class:"tg-error-text"},$o={class:"tg-form-group"},Co={key:0,class:"tg-error-text"},xo={class:"tg-form-row"},zo={class:"tg-form-group tg-form-half"},Mo={key:0,class:"tg-error-text"},Do={class:"tg-form-group tg-form-half"},Io={class:"tg-collapsible"},No={key:0,class:"tg-collapsible-content"},To={class:"tg-form-group"},Ao={class:"tg-form-group"},So={class:"tg-form-group"},jo={key:0,class:"tg-submit-error"},Bo=["disabled"],Lo={key:0,class:"tg-btn-spinner"},Uo={__name:"TgAppCertificateManualUploadTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,default:null}},setup(D){const I=D,N=P(()=>I.permissions?.can_request_certificates||I.permissions?.can_upload_certificates),d=v({certificateNumber:"",courseName:"",issueDate:"",expiryDate:"",issuingOrganization:"",courseHours:"",notes:""}),m=v({}),T=v(!1),o=v(""),h=v(!1),x=v(""),A=v(!1),S=v(""),j=v([]),w=v(null),z=v(!1),_=v(!1);let c=null;function p(){if(w.value&&(w.value=null),clearTimeout(c),S.value.length<2){j.value=[];return}c=setTimeout(async()=>{await k()},300)}async function k(){if(!(S.value.length<2)){z.value=!0;try{const g=await $fetch("/api/tg-app/students/search",{params:{organizationId:I.organizationId,q:S.value,limit:5}});j.value=g.students||[],_.value=!0}catch(g){console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π:",g),j.value=[]}finally{z.value=!1}}}function M(g){w.value=g,S.value="",j.value=[],_.value=!1,m.value.studentId=""}function y(){w.value=null,S.value=""}function r(g){if(!g)return"?";const a=g.trim().split(" ");return a.length>=2?a[0][0]+a[1][0]:g[0]}function V(){return m.value={},w.value||(m.value.studentId="–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª—É—à–∞—Ç–µ–ª—è"),(!d.value.certificateNumber||d.value.certificateNumber.trim().length<3)&&(m.value.certificateNumber="–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞"),(!d.value.courseName||d.value.courseName.trim().length<3)&&(m.value.courseName="–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞"),d.value.issueDate||(m.value.issueDate="–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É"),Object.keys(m.value).length===0}async function B(){if(V()){T.value=!0,o.value="";try{const g=await $fetch("/api/tg-app/certificates/manual",{method:"POST",body:{organizationId:I.organizationId,representativeId:I.representative?.id,studentId:w.value.id,certificateNumber:d.value.certificateNumber,courseName:d.value.courseName,issueDate:d.value.issueDate,expiryDate:d.value.expiryDate||null,issuingOrganization:d.value.issuingOrganization||null,courseHours:d.value.courseHours?Number(d.value.courseHours):null,notes:d.value.notes||null}});g.success&&(h.value=!0,x.value=`–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç "${g.certificate.certificateNumber}" –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è ${w.value.fullName}`,window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!"))}catch(g){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:",g),o.value=g.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"}finally{T.value=!1}}}function H(){d.value={certificateNumber:"",courseName:"",issueDate:"",expiryDate:"",issuingOrganization:"",courseHours:"",notes:""},m.value={},w.value=null,S.value="",h.value=!1,x.value="",o.value="",A.value=!1}return typeof window<"u"&&document.addEventListener("click",g=>{const a=document.querySelector(".tg-autocomplete");a&&!a.contains(g.target)&&(_.value=!1)}),(g,a)=>(e(),s("div",Yn,[N.value?(e(),s("div",eo,[h.value?(e(),s("div",so,[a[11]||(a[11]=t("div",{class:"tg-success-icon"},[t("svg",{class:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),a[12]||(a[12]=t("h3",null,"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!",-1)),t("p",null,n(x.value),1),t("button",{onClick:H,class:"tg-btn-primary"},"–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë")])):(e(),s("form",{key:1,onSubmit:K(B,["prevent"]),class:"tg-upload-form"},[a[27]||(a[27]=t("h2",{class:"tg-form-title"},"üìú –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞",-1)),a[28]||(a[28]=t("p",{class:"tg-form-subtitle"}," –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Å–ª—É—à–∞—Ç–µ–ª—è –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ ",-1)),t("div",ao,[a[14]||(a[14]=t("label",{class:"tg-label"},"–°–ª—É—à–∞—Ç–µ–ª—å *",-1)),t("div",no,[t("div",oo,[q(t("input",{"onUpdate:modelValue":a[0]||(a[0]=u=>S.value=u),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–ª—É—à–∞—Ç–µ–ª—è...",class:U(["tg-input",{"tg-input-error":m.value.studentId}]),onInput:p,onFocus:a[1]||(a[1]=u=>_.value=!0)},null,34),[[G,S.value]]),z.value?(e(),s("div",lo)):$("",!0)]),_.value&&j.value.length>0?(e(),s("div",io,[(e(!0),s(O,null,W(j.value,u=>(e(),s("div",{key:u.id,class:"tg-dropdown-item",onClick:b=>M(u)},[t("div",uo,n(r(u.fullName)),1),t("div",co,[t("span",vo,n(u.fullName),1),t("span",po,n(u.position),1)]),u.certificatesCount>0?(e(),s("span",go," üìú "+n(u.certificatesCount),1)):$("",!0)],8,ro))),128))])):$("",!0),w.value?(e(),s("div",mo,[t("div",fo,n(r(w.value.fullName)),1),t("div",ho,[t("span",ko,n(w.value.fullName),1),t("span",wo,n(w.value.position),1)]),t("button",{type:"button",class:"tg-btn-clear",onClick:y},[...a[13]||(a[13]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):$("",!0)]),m.value.studentId?(e(),s("span",_o,n(m.value.studentId),1)):$("",!0)]),t("div",yo,[a[15]||(a[15]=t("label",{class:"tg-label"},"–ù–æ–º–µ—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ *",-1)),q(t("input",{"onUpdate:modelValue":a[2]||(a[2]=u=>d.value.certificateNumber=u),type:"text",placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: ATC25_001",class:U(["tg-input",{"tg-input-error":m.value.certificateNumber}])},null,2),[[G,d.value.certificateNumber]]),m.value.certificateNumber?(e(),s("span",bo,n(m.value.certificateNumber),1)):$("",!0)]),t("div",$o,[a[16]||(a[16]=t("label",{class:"tg-label"},"–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ *",-1)),q(t("input",{"onUpdate:modelValue":a[3]||(a[3]=u=>d.value.courseName=u),type:"text",placeholder:"–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",class:U(["tg-input",{"tg-input-error":m.value.courseName}])},null,2),[[G,d.value.courseName]]),m.value.courseName?(e(),s("span",Co,n(m.value.courseName),1)):$("",!0)]),t("div",xo,[t("div",zo,[a[17]||(a[17]=t("label",{class:"tg-label"},"–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ *",-1)),q(t("input",{"onUpdate:modelValue":a[4]||(a[4]=u=>d.value.issueDate=u),type:"date",class:U(["tg-input",{"tg-input-error":m.value.issueDate}])},null,2),[[G,d.value.issueDate]]),m.value.issueDate?(e(),s("span",Mo,n(m.value.issueDate),1)):$("",!0)]),t("div",Do,[a[18]||(a[18]=t("label",{class:"tg-label"},"–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è",-1)),q(t("input",{"onUpdate:modelValue":a[5]||(a[5]=u=>d.value.expiryDate=u),type:"date",class:"tg-input"},null,512),[[G,d.value.expiryDate]])])]),t("div",Io,[t("button",{type:"button",class:"tg-collapsible-header",onClick:a[6]||(a[6]=u=>A.value=!A.value)},[a[20]||(a[20]=t("span",null,"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",-1)),(e(),s("svg",{class:U(["w-4 h-4",{"tg-rotated":A.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[19]||(a[19]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),Z(tt,{name:"tg-slide"},{default:Y(()=>[A.value?(e(),s("div",No,[t("div",To,[a[21]||(a[21]=t("label",{class:"tg-label"},"–£—á–µ–±–Ω—ã–π —Ü–µ–Ω—Ç—Ä",-1)),q(t("input",{"onUpdate:modelValue":a[7]||(a[7]=u=>d.value.issuingOrganization=u),type:"text",placeholder:"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –≤—ã–¥–∞–≤—à–∞—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç",class:"tg-input"},null,512),[[G,d.value.issuingOrganization]])]),t("div",Ao,[a[22]||(a[22]=t("label",{class:"tg-label"},"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤",-1)),q(t("input",{"onUpdate:modelValue":a[8]||(a[8]=u=>d.value.courseHours=u),type:"number",placeholder:"72",min:"1",class:"tg-input"},null,512),[[G,d.value.courseHours]])]),t("div",So,[a[23]||(a[23]=t("label",{class:"tg-label"},"–ü—Ä–∏–º–µ—á–∞–Ω–∏—è",-1)),q(t("textarea",{"onUpdate:modelValue":a[9]||(a[9]=u=>d.value.notes=u),placeholder:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è...",rows:"2",class:"tg-input tg-textarea"},null,512),[[G,d.value.notes]])])])):$("",!0)]),_:1})]),o.value?(e(),s("div",jo,[a[24]||(a[24]=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",null,n(o.value),1)])):$("",!0),t("button",{type:"submit",class:"tg-btn-submit",disabled:T.value},[T.value?(e(),s("div",Lo)):(e(),s(O,{key:1},[a[25]||(a[25]=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),a[26]||(a[26]=R(" –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç ",-1))],64))],8,Bo)],32))])):(e(),s("div",to,[...a[10]||(a[10]=[t("div",{class:"tg-icon-wrapper"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})])],-1),t("h3",null,"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞",-1),t("p",null,"–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)])]))]))}},Vo=E(Uo,[["__scopeId","data-v-432ee6a6"]]),Oo={class:"tg-upload-wrapper"},Ho={class:"tg-mode-switch"},Wo={__name:"TgAppCertificateUploadWrapper",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,default:null}},setup(D){const I=v("ai");return(N,d)=>(e(),s("div",Oo,[t("div",Ho,[t("button",{class:U(["tg-mode-btn",{active:I.value==="ai"}]),onClick:d[0]||(d[0]=m=>I.value="ai")},[...d[2]||(d[2]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})],-1),t("span",{class:"tg-mode-label"},"AI –∏–º–ø–æ—Ä—Ç",-1),t("span",{class:"tg-mode-badge"},"–ù–æ–≤–æ–µ",-1)])],2),t("button",{class:U(["tg-mode-btn",{active:I.value==="manual"}]),onClick:d[1]||(d[1]=m=>I.value="manual")},[...d[3]||(d[3]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),t("span",{class:"tg-mode-label"},"–í—Ä—É—á–Ω—É—é",-1)])],2)]),I.value==="ai"?(e(),J(Qn,{key:0,"organization-id":D.organizationId,permissions:D.permissions,representative:D.representative},null,8,["organization-id","permissions","representative"])):(e(),J(Vo,{key:1,"organization-id":D.organizationId,permissions:D.permissions,representative:D.representative},null,8,["organization-id","permissions","representative"]))]))}},Po=E(Wo,[["__scopeId","data-v-6517c544"]]),qo={__name:"TgAppCertificateUploadTab",props:{organizationId:{type:String,required:!0},permissions:{type:Object,required:!0},representative:{type:Object,default:null}},setup(D){return(I,N)=>(e(),J(Po,{"organization-id":D.organizationId,permissions:D.permissions,representative:D.representative},null,8,["organization-id","permissions","representative"]))}},Fo={class:"tg-settings-tab"},Go={class:"tg-settings-section"},Ro={class:"tg-settings-card"},Eo={class:"tg-setting-item"},Xo={class:"tg-setting-value"},Ko={class:"tg-setting-item"},Zo={class:"tg-setting-value"},Jo={class:"tg-setting-item"},Qo={class:"tg-setting-value"},Yo={class:"tg-setting-item"},tl={key:0,class:"tg-setting-item"},el={class:"tg-setting-value"},sl={class:"tg-settings-section"},al={class:"tg-settings-card"},nl={class:"tg-permission-item"},ol={class:"tg-permission-status"},ll={key:0,class:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},il={key:1,class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},rl={class:"tg-permission-item"},ul={class:"tg-permission-status"},dl={key:0,class:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cl={key:1,class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vl={class:"tg-permission-item"},pl={class:"tg-permission-status"},gl={key:0,class:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ml={key:1,class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fl={class:"tg-settings-section"},hl={class:"tg-settings-card"},kl={class:"tg-about-item"},wl={class:"tg-about-value"},_l={__name:"TgAppSettingsTab",props:{representative:{type:Object,required:!0}},setup(D){function I(T){return{pending:"–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏",approved:"–ê–∫—Ç–∏–≤–µ–Ω",blocked:"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"}[T]||T}function N(T){return T.toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})}function d(){window.Telegram?.WebApp?window.Telegram.WebApp.showAlert("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...",()=>{window.location.reload()}):window.location.reload()}function m(){window.Telegram?.WebApp&&window.Telegram.WebApp.openTelegramLink("https://t.me/support")}return(T,o)=>(e(),s("div",Fo,[t("div",Go,[o[5]||(o[5]=t("h3",{class:"tg-section-title"},"–ü—Ä–æ—Ñ–∏–ª—å",-1)),t("div",Ro,[t("div",Eo,[o[0]||(o[0]=t("span",{class:"tg-setting-label"},"–§–ò–û",-1)),t("span",Xo,n(D.representative.fullName),1)]),t("div",Ko,[o[1]||(o[1]=t("span",{class:"tg-setting-label"},"–¢–µ–ª–µ—Ñ–æ–Ω",-1)),t("span",Zo,n(D.representative.phone),1)]),t("div",Jo,[o[2]||(o[2]=t("span",{class:"tg-setting-label"},"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è",-1)),t("span",Qo,n(D.representative.organizationName),1)]),t("div",Yo,[o[3]||(o[3]=t("span",{class:"tg-setting-label"},"–°—Ç–∞—Ç—É—Å",-1)),t("span",{class:U(["tg-setting-value",`tg-status-${D.representative.status}`])},n(I(D.representative.status)),3)]),D.representative.telegramUsername?(e(),s("div",tl,[o[4]||(o[4]=t("span",{class:"tg-setting-label"},"Telegram",-1)),t("span",el,"@"+n(D.representative.telegramUsername),1)])):$("",!0)])]),t("div",sl,[o[18]||(o[18]=t("h3",{class:"tg-section-title"},"–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞",-1)),t("div",al,[t("div",nl,[t("div",{class:U(["tg-permission-icon",{"tg-active":D.representative.permissions?.can_view_students}])},[...o[6]||(o[6]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)])],2),o[9]||(o[9]=t("span",{class:"tg-permission-label"},"–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª—É—à–∞—Ç–µ–ª–µ–π",-1)),t("div",ol,[D.representative.permissions?.can_view_students?(e(),s("svg",ll,[...o[7]||(o[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(e(),s("svg",il,[...o[8]||(o[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])]))])]),t("div",rl,[t("div",{class:U(["tg-permission-icon",{"tg-active":D.representative.permissions?.can_view_schedule}])},[...o[10]||(o[10]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],2),o[13]||(o[13]=t("span",{class:"tg-permission-label"},"–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è",-1)),t("div",ul,[D.representative.permissions?.can_view_schedule?(e(),s("svg",dl,[...o[11]||(o[11]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(e(),s("svg",cl,[...o[12]||(o[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])]))])]),t("div",vl,[t("div",{class:U(["tg-permission-icon",{"tg-active":D.representative.permissions?.can_view_certificates}])},[...o[14]||(o[14]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])],2),o[17]||(o[17]=t("span",{class:"tg-permission-label"},"–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤",-1)),t("div",pl,[D.representative.permissions?.can_view_certificates?(e(),s("svg",gl,[...o[15]||(o[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(e(),s("svg",ml,[...o[16]||(o[16]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])]))])])])]),t("div",fl,[o[22]||(o[22]=t("h3",{class:"tg-section-title"},"–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏",-1)),t("div",hl,[o[20]||(o[20]=t("div",{class:"tg-about-item"},[t("h4",null,"–ê–¢–¶ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞"),t("p",null,"–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ–±–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º")],-1)),o[21]||(o[21]=t("div",{class:"tg-about-item"},[t("span",{class:"tg-about-label"},"–í–µ—Ä—Å–∏—è"),t("span",{class:"tg-about-value"},"1.0.0")],-1)),t("div",kl,[o[19]||(o[19]=t("span",{class:"tg-about-label"},"–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",-1)),t("span",wl,n(N(new Date)),1)])])]),t("div",{class:"tg-settings-section"},[t("button",{onClick:d,class:"tg-action-btn primary"},[...o[23]||(o[23]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("span",null,"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",-1)])]),t("button",{onClick:m,class:"tg-action-btn secondary"},[...o[24]||(o[24]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),t("span",null,"–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É",-1)])])]),o[25]||(o[25]=t("div",{class:"tg-copyright"},[t("p",null,"¬© 2026 –ê–¢–¶ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞"),t("p",{class:"tg-copyright-sub"},"–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã")],-1))]))}},yl=E(_l,[["__scopeId","data-v-cc19062b"]]),bl={class:"tg-app-root"},$l={key:0,class:"tg-loading"},Cl={key:1,class:"tg-auth-error"},xl={class:"tg-actions"},zl={key:0,class:"tg-debug-info"},Ml={key:2,class:"tg-registration"},Dl={key:3,class:"tg-main-app"},Il={class:"tg-header"},Nl={class:"tg-header-content"},Tl={class:"tg-user-info"},Al={class:"tg-avatar"},Sl={class:"tg-user-details"},jl={key:0,class:"tg-pending-notice"},Bl={key:1,class:"tg-blocked-notice"},Ll={key:2,class:"tg-content"},Ul={key:3,class:"tg-nav"},Vl=["onClick"],Ol=["innerHTML"],Hl={class:"tg-nav-label"},Wl={__name:"index",setup(D){ft({script:[{src:"https://telegram.org/js/telegram-web-app.js",onload:()=>{console.log("TG SDK Loaded"),setTimeout(j,100)},defer:!0}]});const I={students:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>',schedule:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>',certificates:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>',upload:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>',settings:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>'},N=v("loading"),d=v("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."),m=v(""),T=v(!1),o=v(null),h=v(null),x=v("students"),A=v("");function S(y){try{console.log("[TG] Parsing hash, length:",y.length);const r=y.startsWith("#")?y.substring(1):y;console.log("[TG] Clean hash (first 300):",r.substring(0,300));const V=r.match(/tgWebAppData=([^&]*(?:&(?!tgWebApp)[^&]*)*)/);if(!V)return console.warn("[TG] No tgWebAppData found in hash"),null;let B=V[1];console.log("[TG] Extracted tgWebAppData length:",B.length),console.log("[TG] Extracted tgWebAppData (first 300):",B.substring(0,300));const H=new URLSearchParams(r);["auth_date","hash","signature"].forEach(i=>{const L=H.get(i);L&&!B.includes(`${i}=`)&&(console.log(`[TG] Adding ${i} from hash:`,L.substring(0,20)+"..."),B+=`&${i}=${L}`)}),console.log("[TG] Final initData length:",B.length),console.log("[TG] Final initData (first 300):",B.substring(0,300));const a=B.includes("user="),u=B.includes("hash="),b=B.includes("auth_date=");return console.log("[TG] Validation:",{hasUser:a,hasHash:u,hasAuthDate:b}),!a||!u?(console.error("[TG] Missing required parameters in initData"),null):B}catch(r){return console.error("[TG] Error parsing hash:",r),null}}async function j(){N.value="init",d.value="–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram...";try{const y=window.Telegram?.WebApp;if(!y)throw new Error("Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram.");y.expand();let r=y.initData||"";if(console.log("[TG] SDK initData:",r?`length ${r.length}`:"empty"),(!r||r.length<50)&&window.location.hash){console.warn("[TG] SDK initData –ø—É—Å—Ç –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π, –ø–∞—Ä—Å–∏–º –∏–∑ hash...");const H=S(window.location.hash);H&&H.length>50?(r=H,console.log("[TG] ‚úÖ initData —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ hash"),console.log("[TG] initData length:",r.length),console.log("[TG] initData sample:",r.substring(0,150))):console.error("[TG] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å initData –∏–∑ hash")}const V=y.platform||"unknown";if(z(y,r),!r)throw new Error("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (initData –ø—É—Å—Ç).");let B=y.initDataUnsafe?.user||null;if(!B&&r)try{const g=new URLSearchParams(r).get("user");g&&(B=JSON.parse(decodeURIComponent(g)))}catch(H){console.warn("[TG] Could not parse user from initData:",H)}o.value={initData:r,user:B||{}},await w()}catch(y){console.error("Init Error:",y),N.value="error",m.value=y.message}}async function w(){N.value="loading",d.value="–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞...";try{const y={initData:o.value.initData};console.log("[TG Client] Sending Auth with initData length:",y.initData.length);const r=await $fetch("/api/tg-app/auth",{method:"POST",body:y});r.representative&&(h.value=r.representative,N.value="ready")}catch(y){console.error("Auth Failed:",y),console.log("Error statusCode:",y.statusCode),console.log("Error data:",y.data),y.statusCode===404?(console.log("[TG] ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"),N.value="registration"):(console.error("[TG] ‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –æ—à–∏–±–∫–∏"),N.value="error",m.value=y.data?.message||y.message||"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º")}}function z(y,r){let V=null;if(r)try{const H=new URLSearchParams(r).get("user");H&&(V=JSON.parse(decodeURIComponent(H)))}catch(B){console.warn("[TG] Could not extract user from parsedInitData:",B)}A.value=JSON.stringify({version:y.version,platform:y.platform,locationHash:window.location.hash.substring(0,300)+"...",locationSearch:window.location.search,sdkInitDataLen:y.initData?.length||0,parsedInitDataLen:r?.length||0,initDataSample:r?r.substring(0,150)+"...":"empty",sdkUser:y.initDataUnsafe?.user,extractedUser:V,hasHash:r?.includes("hash=")||!1,hasAuthDate:r?.includes("auth_date=")||!1,hasUser:r?.includes("user=")||!1},null,2)}function _(y){h.value=y.representative,N.value="ready"}function c(y){return y?y.split(" ").map(r=>r[0]).join("").substring(0,2).toUpperCase():"?"}function p(y){return{pending:"–û–∂–∏–¥–∞–Ω–∏–µ",approved:"–ê–∫—Ç–∏–≤–µ–Ω",blocked:"–ë–ª–æ–∫"}[y]||y}const k=P(()=>{switch(x.value){case"students":return ot;case"schedule":return Es;case"certificates":return Ia;case"upload":return qo;case"settings":return yl;default:return ot}}),M=P(()=>{if(!h.value)return[];const y=h.value.permissions||{},r=[];return y.can_view_students&&r.push({id:"students",label:"–°—Ç—É–¥–µ–Ω—Ç—ã",icon:I.students}),y.can_view_schedule&&r.push({id:"schedule",label:"–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ",icon:I.schedule}),y.can_view_certificates&&r.push({id:"certificates",label:"–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã",icon:I.certificates}),(y.can_request_certificates||y.can_upload_certificates)&&r.push({id:"upload",label:"–ó–∞–≥—Ä—É–∑–∏—Ç—å",icon:I.upload}),r.push({id:"settings",label:"–ú–µ–Ω—é",icon:I.settings}),r});return(y,r)=>(e(),s("div",bl,[N.value==="loading"||N.value==="init"?(e(),s("div",$l,[r[1]||(r[1]=t("div",{class:"tg-spinner"},null,-1)),r[2]||(r[2]=t("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞...",-1)),t("small",null,n(d.value),1)])):N.value==="error"?(e(),s("div",Cl,[r[5]||(r[5]=t("div",{class:"tg-error-icon"},[t("svg",{class:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),r[6]||(r[6]=t("h2",null,"–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞",-1)),t("p",null,n(m.value),1),t("div",xl,[t("button",{onClick:j,class:"tg-btn-primary"},[...r[3]||(r[3]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),R(" –ü–æ–≤—Ç–æ—Ä–∏—Ç—å ",-1)])]),t("button",{onClick:r[0]||(r[0]=V=>T.value=!T.value),class:"tg-btn-secondary"},n(T.value?"–°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏":"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏"),1)]),T.value?(e(),s("div",zl,[r[4]||(r[4]=t("h3",null,"Debug Info:",-1)),t("pre",null,n(A.value),1)])):$("",!0)])):N.value==="registration"?(e(),s("div",Ml,[r[7]||(r[7]=t("div",{class:"tg-welcome"},[t("div",{class:"tg-logo"},[t("img",{src:pt,alt:"Logo"})]),t("h1",null,"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å"),t("p",null,"–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É")],-1)),Z(Ht,{"telegram-data":o.value,onRegistered:_},null,8,["telegram-data"])])):N.value==="ready"?(e(),s("div",Dl,[t("header",Il,[t("div",Nl,[t("div",Tl,[t("div",Al,n(c(h.value?.fullName)),1),t("div",Sl,[t("h3",null,n(h.value?.fullName),1),t("p",null,n(h.value?.organizationName),1)])]),t("div",{class:U(["tg-status",`tg-status-${h.value?.status}`])},n(p(h.value?.status)),3)])]),h.value?.status==="pending"?(e(),s("div",jl,[...r[8]||(r[8]=[t("div",{class:"tg-notice-icon"},[t("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1),t("h3",null,"–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏",-1),t("p",null,"–û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",-1)])])):h.value?.status==="blocked"?(e(),s("div",Bl,[r[9]||(r[9]=t("div",{class:"tg-notice-icon"},[t("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})])],-1)),r[10]||(r[10]=t("h3",null,"–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω",-1)),t("p",null,n(h.value?.blockedReason||"–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"),1)])):h.value?.status==="approved"?(e(),s("div",Ll,[(e(),J(ht(k.value),{"organization-id":h.value.organizationId,permissions:h.value.permissions,representative:h.value},null,8,["organization-id","permissions","representative"]))])):$("",!0),h.value?.status==="approved"?(e(),s("nav",Ul,[(e(!0),s(O,null,W(M.value,V=>(e(),s("button",{key:V.id,class:U(["tg-nav-btn",{active:x.value===V.id}]),onClick:B=>x.value=V.id},[t("span",{class:"tg-nav-icon",innerHTML:V.icon},null,8,Ol),t("span",Hl,n(V.label),1)],10,Vl))),128))])):$("",!0)])):$("",!0)]))}},El=E(Wl,[["__scopeId","data-v-109a7c8b"]]);export{El as default};
