import{E as C,a as T}from"./BylynD0E.js";import"./GLV6bXvn.js";async function p(o){const a=await(await fetch(o)).arrayBuffer();let s="";const n=new Uint8Array(a),m=n.byteLength;for(let r=0;r<m;r++)s+=String.fromCharCode(n[r]);return window.btoa(s)}function M(o){if(!o)return"";const t=new Date(o),a=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${a}.${s}.${n}`}async function P(o){const t=new C({orientation:"landscape",unit:"mm",format:"a4"});try{const e=await p("https://raw.githubusercontent.com/JulietaUla/Montserrat/master/fonts/ttf/Montserrat-Regular.ttf"),i=await p("https://raw.githubusercontent.com/JulietaUla/Montserrat/master/fonts/ttf/Montserrat-Bold.ttf"),h=await p("https://raw.githubusercontent.com/JulietaUla/Montserrat/master/fonts/ttf/Montserrat-Italic.ttf");t.addFileToVFS("Montserrat-Regular.ttf",e),t.addFont("Montserrat-Regular.ttf","Montserrat","normal"),t.addFileToVFS("Montserrat-Bold.ttf",i),t.addFont("Montserrat-Bold.ttf","Montserrat","bold"),t.addFileToVFS("Montserrat-Italic.ttf",h),t.addFont("Montserrat-Italic.ttf","Montserrat","italic"),t.setFont("Montserrat","normal")}catch(e){console.error("Ошибка загрузки шрифта:",e)}let a=null;try{a=await p("/logo.png")}catch(e){console.error("Ошибка загрузки логотипа:",e)}const s=t.internal.pageSize.getWidth(),n=15,m=[0,0,0];let r=n;if(a)try{const e=t.getImageProperties(a),i=50,h=e.height*i/e.width;t.addImage(a,"PNG",n,r,i,h)}catch(e){console.error("Ошибка при отрисовке логотипа:",e),t.addImage(a,"PNG",n,r,50,30)}t.setFontSize(14),t.setFont("Montserrat","bold"),t.setTextColor(...m),t.text("ВЕДОМОСТЬ ВЫДАЧИ СЕРТИФИКАТОВ",s/2,r+15,{align:"center"}),r+=35,t.setFontSize(9),t.setTextColor(...m);const u=n,f=s/2,g=40,b=90;let c=r;t.setFont("Montserrat","bold"),t.text("Учебная программа:",u,c),t.setFont("Montserrat","normal");const x=t.splitTextToSize(o.courseName,b);t.text(x,u+g,c),c+=Math.max(x.length*4,5),t.setFont("Montserrat","bold"),t.text("Группа:",u,c),t.setFont("Montserrat","normal");const y=t.splitTextToSize(o.groupCode,b);t.text(y,u+g,c),c+=5;let l=r;if(t.setFont("Montserrat","bold"),t.text("Инструкторы:",f,l),t.setFont("Montserrat","normal"),o.instructors.length>0){const e=o.instructors.join(", "),i=t.splitTextToSize(e,b);t.text(i,f+g,l),l+=Math.max(i.length*4,5)}else t.text("Не указаны",f+g,l),l+=5;o.startDate&&o.endDate&&(t.setFont("Montserrat","bold"),t.text("Период:",f,l),t.setFont("Montserrat","normal"),t.text(`${M(o.startDate)} — ${M(o.endDate)}`,f+g,l),l+=5),r=Math.max(c,l)+5;const S=[{content:"№"},{content:"ФИО слушателя"},{content:"Организация"},{content:`Посещ.
%`},{content:`Ср.
балл`},{content:`Дисц.
пройдено`},{content:"Допуск"},{content:`Статус
сертификата`},{content:`Дата
выдачи`},{content:`№
сертификата`}],F=[],w={draft:"Черновик",issued:"Выдан",revoked:"Отозван"};o.students.forEach((e,i)=>{const h=[i+1,e.fullName,e.organization||"—",e.totalAttendancePercent.toFixed(0)+"%",e.averageGrade!==null?e.averageGrade.toFixed(1):"—",`${e.eligibility.completedDisciplines}/${e.eligibility.totalDisciplines}`,e.eligibility.isEligible?"Допущен":"Не допущен",e.certificate?w[e.certificate.status]:"Не выдан",e.certificate?.issueDate?M(e.certificate.issueDate):"—",e.certificate?.certificateNumber||"—"];F.push(h)}),T(t,{head:[S],body:F,startY:r,theme:"grid",styles:{font:"Montserrat",fontSize:8,cellPadding:1.5,lineColor:[0,0,0],textColor:[0,0,0],lineWidth:.1,halign:"center",valign:"middle"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",lineWidth:.1,lineColor:[0,0,0],valign:"middle",minCellHeight:10},columnStyles:{0:{cellWidth:10},1:{cellWidth:45,halign:"left",overflow:"linebreak"},2:{cellWidth:40,halign:"left",overflow:"linebreak"},3:{cellWidth:15},4:{cellWidth:15},5:{cellWidth:18},6:{cellWidth:20},7:{cellWidth:22},8:{cellWidth:20},9:{cellWidth:25}}});let d=t.lastAutoTable.finalY+10;t.setFontSize(7),t.setFont("Montserrat","normal"),t.text("* Статусы: Выдан — сертификат выдан студенту, Отозван — сертификат аннулирован, Не выдан — сертификат не был выдан.",n,d),d+=15,t.setDrawColor(0,0,0),t.setLineWidth(.2),t.line(n,d,n+80,d),t.setFontSize(9),t.setFont("Montserrat","normal"),t.text(`Ведомость сформирована: ${o.generatedBy}`,n,d+5);const D=M(new Date().toISOString());t.text(`Дата: ${D}`,s-n,d+5,{align:"right"});const W=`Vedomost_Certificates_${o.groupCode}.pdf`;t.save(W)}export{P as generateCertificateReport};
