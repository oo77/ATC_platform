import{_ as S}from"./BMofnORk.js";import{v as z,r as I,C as V,f as L,g as O,k as X,b as A,w as h,T as _,K as R,c as l,h as i,z as U,a as r,t as b,x as f,d as y,A as g,n as u,G as D,e as H,o as n}from"./GLV6bXvn.js";import{u as q}from"./DVL-QcDc.js";const G={key:0,class:"fixed inset-0 z-999999 flex items-center justify-center bg-black/80 px-4 py-5"},K={class:"border-b border-stroke px-6 py-4 dark:border-strokedark flex items-center justify-between"},Y={class:"text-xl font-semibold text-black dark:text-white"},J={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},Q={class:"sm:col-span-2"},W={key:0,class:"mt-1 text-sm text-danger"},Z={class:"mb-3 block text-sm font-medium text-black dark:text-white"},ee={key:0,class:"text-danger"},te={key:0,class:"mt-1 text-sm text-danger"},re={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},se={key:0,class:"mt-1 text-sm text-danger"},oe={key:0,class:"mt-1 text-sm text-danger"},ae={key:0,class:"mt-1 text-sm text-danger"},ne={class:"sm:col-span-2"},le={key:0,class:"mt-1 text-sm text-danger"},ie={class:"sm:col-span-2"},de={class:"flex items-center gap-3 cursor-pointer"},ce={key:0,class:"sm:col-span-2 mt-4 pt-4 border-t border-stroke dark:border-strokedark"},ue={class:"flex items-center gap-3 cursor-pointer"},me={key:0,class:"mt-4"},pe={key:0,class:"mt-1 text-sm text-danger"},fe={key:1,class:"sm:col-span-2 mt-4 pt-4 border-t border-stroke dark:border-strokedark"},be={class:"flex items-center gap-3 cursor-pointer"},ke={key:0,class:"grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4"},ge={key:0,class:"mt-1 text-sm text-danger"},xe={key:0,class:"mt-1 text-sm text-danger"},ye={key:2,class:"sm:col-span-2 mt-4 pt-4 border-t border-stroke dark:border-strokedark"},we={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},ve={key:1,class:"mt-4"},he={key:0,class:"mt-1 text-sm text-danger"},Pe={class:"mt-6 flex justify-end gap-4"},Ae=z({__name:"InstructorFormModal",props:{instructor:{}},emits:["close","saved"],setup($,{emit:C}){const c=$,E=C,k=I(!1),P=I(!1),o=V({}),d=q(),t=V({fullName:"",email:"",phone:"",hireDate:"",contractInfo:"",maxHours:0,isActive:!0,createAccount:!0,accountPassword:"",changePassword:!1,newPassword:"",confirmNewPassword:"",createAccountForExisting:!1}),F=w=>{const e=w.getFullYear(),a=String(w.getMonth()+1).padStart(2,"0"),s=String(w.getDate()).padStart(2,"0");return`${e}-${a}-${s}`},x=L(()=>!!c.instructor),M=(w,e)=>{switch(w){case"fullName":if(!e||typeof e=="string"&&e.trim().length<2)return"ФИО должно содержать минимум 2 символа";break;case"email":if(e&&typeof e=="string"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return"Введите корректный email адрес";break;case"phone":if(e&&typeof e=="string"&&!/^\+998\d{9}$/.test(e))return"Номер телефона должен быть в формате +998XXXXXXXXX";break;case"maxHours":if(typeof e=="number"&&e<0)return"Максимальные часы не могут быть отрицательными";break}return null},N=()=>{P.value=!1,setTimeout(()=>{E("close")},300)},T=async()=>{if(k.value)return;Object.keys(o).forEach(a=>delete o[a]);const w=["fullName","email","phone","maxHours"];let e=!1;for(const a of w){const s=t[a];if(typeof s=="boolean")continue;const m=M(a,s);m&&(o[a]=[m],d.error(m,"Ошибка валидации"),e=!0)}if(!x.value&&t.createAccount&&((!t.email||t.email.trim()==="")&&(o.email=["Email обязателен для создания учётной записи"],d.error("Email обязателен для создания учётной записи","Ошибка валидации"),e=!0),(!t.accountPassword||t.accountPassword.length<8)&&(o.accountPassword=["Пароль должен быть минимум 8 символов"],d.error("Пароль должен быть минимум 8 символов","Ошибка валидации"),e=!0)),!e){k.value=!0;try{if(x.value){const{token:a}=H();let s={};if(t.changePassword&&c.instructor?.userId){if(!t.newPassword||t.newPassword.length<8){o.newPassword=["Пароль должен быть минимум 8 символов"],d.error("Пароль должен быть минимум 8 символов","Ошибка"),k.value=!1;return}if(t.newPassword!==t.confirmNewPassword){o.confirmNewPassword=["Пароли не совпадают"],d.error("Пароли не совпадают","Ошибка"),k.value=!1;return}s={changePassword:!0,newPassword:t.newPassword}}let m={};if(t.createAccountForExisting&&!c.instructor?.userId){if(!t.accountPassword||t.accountPassword.length<8){o.accountPassword=["Пароль должен быть минимум 8 символов"],d.error("Пароль должен быть минимум 8 символов","Ошибка"),k.value=!1;return}m={createAccount:!0,accountEmail:t.email||void 0,accountPassword:t.accountPassword}}const p=await $fetch(`/api/instructors/${c.instructor.id}`,{method:"PUT",headers:{Authorization:`Bearer ${a.value}`},body:{fullName:t.fullName,email:t.email||void 0,phone:t.phone||void 0,hireDate:t.hireDate||void 0,contractInfo:t.contractInfo||void 0,maxHours:t.maxHours,isActive:t.isActive,...s,...m}});if(!p.success){p.errors&&Array.isArray(p.errors)?p.errors.forEach(v=>{v.field&&(o[v.field]=[v.message]),d.error(v.message,"Ошибка валидации")}):p.field?(o[p.field]=[p.message||"Ошибка"],d.error(p.message||"Ошибка","Ошибка валидации")):d.error(p.message||"Произошла ошибка при обновлении инструктора","Ошибка"),k.value=!1;return}t.changePassword?d.success("Пароль успешно изменён","Успех"):t.createAccountForExisting?d.success("Учётная запись создана","Успех"):d.success("Инструктор успешно обновлен","Успех")}else{const{token:a}=H(),s=await $fetch("/api/instructors",{method:"POST",headers:{Authorization:`Bearer ${a.value}`},body:{fullName:t.fullName,email:t.email||void 0,phone:t.phone||void 0,hireDate:t.hireDate||void 0,contractInfo:t.contractInfo||void 0,maxHours:t.maxHours,isActive:t.isActive,createAccount:t.createAccount,accountEmail:t.createAccount&&t.email||void 0,accountPassword:t.createAccount?t.accountPassword:void 0}});if(!s.success){s.errors&&Array.isArray(s.errors)?s.errors.forEach(m=>{m.field&&(o[m.field]=[m.message]),d.error(m.message,"Ошибка валидации")}):s.field?(o[s.field]=[s.message||"Ошибка"],d.error(s.message||"Ошибка","Ошибка валидации")):d.error(s.message||"Произошла ошибка при создании инструктора","Ошибка"),k.value=!1;return}t.createAccount?d.success("Инструктор и учётная запись успешно созданы","Успех"):d.success("Инструктор успешно создан","Успех")}E("saved"),N()}catch(a){if(console.error("Error saving instructor:",a),a.data?.errors){const s=a.data.errors;Object.assign(o,s),Object.entries(s).forEach(([m,p])=>{const j={fullName:"ФИО",email:"Email",phone:"Телефон",hireDate:"Дата приема",contractInfo:"Данные договора",maxHours:"Максимальные часы"}[m]||m,B=Array.isArray(p)?p[0]:p;d.error(`${j}: ${B}`,"Ошибка валидации")})}else{const s=a.data?.message||"Произошла ошибка при сохранении";d.error(s,"Ошибка")}}finally{k.value=!1}}};return O(()=>{setTimeout(()=>{P.value=!0},10),c.instructor&&(t.fullName=c.instructor.fullName,t.email=c.instructor.email||"",t.phone=c.instructor.phone||"",t.hireDate=c.instructor.hireDate?typeof c.instructor.hireDate=="string"?c.instructor.hireDate.split("T")[0]:F(c.instructor.hireDate):"",t.contractInfo=c.instructor.contractInfo||"",t.maxHours=c.instructor.maxHours||0,t.isActive=c.instructor.isActive)}),(w,e)=>{const a=S;return n(),X(R,{to:"body"},[A(_,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:h(()=>[P.value?(n(),l("div",G,[A(_,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 -translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 -translate-y-4"},{default:h(()=>[P.value?(n(),l("div",{key:0,class:"w-full max-w-3xl rounded-lg bg-white dark:bg-boxdark shadow-xl",onClick:e[14]||(e[14]=U(()=>{},["stop"]))},[r("div",K,[r("h3",Y,b(x.value?"Редактировать":"Добавить")+" инструктора ",1),r("button",{onClick:N,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"},[...e[15]||(e[15]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),r("form",{onSubmit:U(T,["prevent"]),class:"p-6"},[r("div",J,[r("div",Q,[e[16]||(e[16]=r("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"},[y(" ФИО "),r("span",{class:"text-danger"},"*")],-1)),f(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.fullName=s),type:"text",placeholder:"Введите полное имя",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.fullName}]),required:""},null,2),[[g,t.fullName]]),o.fullName?(n(),l("p",W,b(o.fullName[0]),1)):i("",!0)]),r("div",null,[r("label",Z,[e[17]||(e[17]=y(" Email ",-1)),!x.value&&t.createAccount?(n(),l("span",ee,"*")):i("",!0)]),f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.email=s),type:"email",placeholder:"email@example.com",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.email}])},null,2),[[g,t.email]]),o.email?(n(),l("p",te,b(o.email[0]),1)):!x.value&&t.createAccount?(n(),l("p",re," Будет использоваться для входа в систему ")):i("",!0)]),r("div",null,[e[18]||(e[18]=r("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Номер телефона ",-1)),f(r("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.phone=s),type:"tel",placeholder:"+998901234567",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.phone}])},null,2),[[g,t.phone]]),o.phone?(n(),l("p",se,b(o.phone[0]),1)):i("",!0),e[19]||(e[19]=r("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Формат: +998XXXXXXXXX ",-1))]),r("div",null,[e[20]||(e[20]=r("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Прием на работу ",-1)),f(r("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.hireDate=s),type:"date",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.hireDate}])},null,2),[[g,t.hireDate]]),o.hireDate?(n(),l("p",oe,b(o.hireDate[0]),1)):i("",!0)]),r("div",null,[e[21]||(e[21]=r("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Максимальные часы ",-1)),f(r("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.maxHours=s),type:"number",min:"0",placeholder:"0",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.maxHours}])},null,2),[[g,t.maxHours,void 0,{number:!0}]]),o.maxHours?(n(),l("p",ae,b(o.maxHours[0]),1)):i("",!0),e[22]||(e[22]=r("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Для отчетности о количестве часов обучения ",-1))]),r("div",ne,[e[23]||(e[23]=r("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Данные о трудовом договоре ",-1)),f(r("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.contractInfo=s),rows:"4",placeholder:"Номер договора, дата заключения, условия и прочая информация",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary resize-none",{"border-danger":o.contractInfo}])},null,2),[[g,t.contractInfo]]),o.contractInfo?(n(),l("p",le,b(o.contractInfo[0]),1)):i("",!0)]),r("div",ie,[r("label",de,[f(r("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>t.isActive=s),type:"checkbox",class:"sr-only"},null,512),[[D,t.isActive]]),r("div",{class:u(["relative h-6 w-11 rounded-full transition-colors",t.isActive?"bg-success":"bg-gray-300 dark:bg-gray-600"])},[r("div",{class:u(["absolute top-0.5 h-5 w-5 rounded-full bg-white transition-transform",t.isActive?"translate-x-5":"translate-x-0.5"])},null,2)],2),e[24]||(e[24]=r("span",{class:"text-sm font-medium text-black dark:text-white"}," Активен ",-1))])]),x.value?i("",!0):(n(),l("div",ce,[r("label",ue,[f(r("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>t.createAccount=s),type:"checkbox",class:"sr-only"},null,512),[[D,t.createAccount]]),r("div",{class:u(["relative h-6 w-11 rounded-full transition-colors",t.createAccount?"bg-primary":"bg-gray-300 dark:bg-gray-600"])},[r("div",{class:u(["absolute top-0.5 h-5 w-5 rounded-full bg-white transition-transform",t.createAccount?"translate-x-5":"translate-x-0.5"])},null,2)],2),e[25]||(e[25]=r("span",{class:"text-sm font-medium text-black dark:text-white"}," Создать учётную запись для входа ",-1))]),t.createAccount?(n(),l("div",me,[e[26]||(e[26]=r("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"},[y(" Пароль "),r("span",{class:"text-danger"},"*")],-1)),f(r("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>t.accountPassword=s),type:"password",placeholder:"Минимум 8 символов",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.accountPassword}])},null,2),[[g,t.accountPassword]]),o.accountPassword?(n(),l("p",pe,b(o.accountPassword[0]),1)):i("",!0)])):i("",!0)])),x.value&&c.instructor?.userId?(n(),l("div",fe,[r("label",be,[f(r("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.changePassword=s),type:"checkbox",class:"sr-only"},null,512),[[D,t.changePassword]]),r("div",{class:u(["relative h-6 w-11 rounded-full transition-colors",t.changePassword?"bg-warning":"bg-gray-300 dark:bg-gray-600"])},[r("div",{class:u(["absolute top-0.5 h-5 w-5 rounded-full bg-white transition-transform",t.changePassword?"translate-x-5":"translate-x-0.5"])},null,2)],2),e[27]||(e[27]=r("span",{class:"text-sm font-medium text-black dark:text-white"}," Изменить пароль ",-1))]),t.changePassword?(n(),l("div",ke,[r("div",null,[e[28]||(e[28]=r("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"},[y(" Новый пароль "),r("span",{class:"text-danger"},"*")],-1)),f(r("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>t.newPassword=s),type:"password",placeholder:"Минимум 8 символов",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.newPassword}])},null,2),[[g,t.newPassword]]),o.newPassword?(n(),l("p",ge,b(o.newPassword[0]),1)):i("",!0)]),r("div",null,[e[29]||(e[29]=r("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"},[y(" Подтвердите пароль "),r("span",{class:"text-danger"},"*")],-1)),f(r("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>t.confirmNewPassword=s),type:"password",placeholder:"Повторите пароль",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.confirmNewPassword}])},null,2),[[g,t.confirmNewPassword]]),o.confirmNewPassword?(n(),l("p",xe,b(o.confirmNewPassword[0]),1)):i("",!0)])])):i("",!0)])):i("",!0),x.value&&!c.instructor?.userId?(n(),l("div",ye,[r("div",we,[e[33]||(e[33]=r("p",{class:"text-gray-600 dark:text-gray-400 mb-3 text-center"}," У инструктора нет учётной записи ",-1)),t.createAccountForExisting?i("",!0):(n(),X(a,{key:0,variant:"primary",size:"sm",onClick:e[12]||(e[12]=s=>t.createAccountForExisting=!0),class:"w-full"},{default:h(()=>[...e[30]||(e[30]=[y(" Создать учётную запись ",-1)])]),_:1})),t.createAccountForExisting?(n(),l("div",ve,[e[31]||(e[31]=r("label",{class:"mb-2 block text-sm font-medium text-black dark:text-white"},[y(" Пароль "),r("span",{class:"text-danger"},"*")],-1)),f(r("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>t.accountPassword=s),type:"password",placeholder:"Минимум 8 символов",class:u(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.accountPassword}])},null,2),[[g,t.accountPassword]]),o.accountPassword?(n(),l("p",he,b(o.accountPassword[0]),1)):i("",!0),e[32]||(e[32]=r("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Email инструктора будет использоваться для входа ",-1))])):i("",!0)])])):i("",!0)]),r("div",Pe,[A(a,{variant:"danger",onClick:N,disabled:k.value},{default:h(()=>[...e[34]||(e[34]=[y(" Отмена ",-1)])]),_:1},8,["disabled"]),A(a,{variant:"success",type:"submit",loading:k.value},{default:h(()=>[y(b(x.value?"Сохранить":"Создать"),1)]),_:1},8,["loading"])])],32)])):i("",!0)]),_:1})])):i("",!0)]),_:1})])}}}),Ie=Object.assign(Ae,{__name:"UsersInstructorFormModal"});export{Ie as _};
