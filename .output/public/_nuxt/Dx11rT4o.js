import{_ as q}from"./BMofnORk.js";import{_ as Z}from"./BKg9m4wI.js";import{_ as ee}from"./CyDLpZDf.js";import{v as I,C as A,r as v,q as te,k as H,w as b,a as e,x as S,c as a,h as y,A as T,i as n,n as U,t as p,d as m,b as C,z as K,o as s,u as re,g as oe,m as Y,F as L,j as P,l as _,O as W}from"./GLV6bXvn.js";import{u as R}from"./DlZaGH1J.js";import{u as G}from"./DVL-QcDc.js";import{_ as se}from"./BNigTcCY.js";import{u as ae}from"./DW2J_Y_n.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const ne={key:0,class:"mt-1 text-sm text-danger"},ie={class:"flex justify-end gap-3 pt-4"},le=I({__name:"TemplateFormModal",props:{isOpen:{type:Boolean}},emits:["close","created"],setup(B,{emit:M}){const z=B,h=M,{authFetch:j}=R(),{success:D,error:k}=G(),d=A({name:"",description:"",numberFormat:"ATC{YY}_{CODE}_{NUM}"}),c=A({name:""}),g=v(!1),f=()=>{d.name="",d.description="",d.numberFormat="ATC{YY}_{CODE}_{NUM}",c.name=""},w=()=>{g.value||(f(),h("close"))},$=async()=>{if(!g.value){if(c.name="",!d.name.trim()){c.name="Название обязательно";return}g.value=!0;try{const u=await j("/api/certificates/templates",{method:"POST",body:{name:d.name.trim(),description:d.description.trim()||void 0,numberFormat:d.numberFormat.trim()||void 0}});u.success?(D("Шаблон успешно создан"),f(),h("created",u.template)):k(u.message||"Ошибка создания шаблона")}catch(u){console.error("Error creating template:",u),k(u.data?.message||u.message||"Ошибка создания шаблона")}finally{g.value=!1}}};return te(()=>z.isOpen,u=>{u&&f()}),(u,i)=>{const V=q,F=ee;return s(),H(F,{"is-open":B.isOpen,title:"Создание шаблона сертификата",size:"sm",onClose:w},{default:b(()=>[e("form",{onSubmit:K($,["prevent"]),class:"space-y-4"},[e("div",null,[i[3]||(i[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Название шаблона * ",-1)),S(e("input",{"onUpdate:modelValue":i[0]||(i[0]=x=>n(d).name=x),type:"text",placeholder:"Например: Стандартный сертификат",class:U(["w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2.5 text-gray-900 dark:text-white focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20",{"border-danger":n(c).name}]),required:""},null,2),[[T,n(d).name]]),n(c).name?(s(),a("p",ne,p(n(c).name),1)):y("",!0)]),e("div",null,[i[4]||(i[4]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Описание ",-1)),S(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=x=>n(d).description=x),rows:"3",placeholder:"Краткое описание шаблона...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2.5 text-gray-900 dark:text-white focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 resize-none"},null,512),[[T,n(d).description]])]),e("div",null,[i[5]||(i[5]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Формат номера сертификата ",-1)),S(e("input",{"onUpdate:modelValue":i[2]||(i[2]=x=>n(d).numberFormat=x),type:"text",placeholder:"ATC{YY}_{CODE}_{NUM}",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2.5 text-gray-900 dark:text-white font-mono text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"},null,512),[[T,n(d).numberFormat]]),i[6]||(i[6]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},[m(" Переменные: "),e("code",{class:"bg-gray-100 dark:bg-gray-700 px-1 rounded"},"{YY}"),m(" — год, "),e("code",{class:"bg-gray-100 dark:bg-gray-700 px-1 rounded"},"{CODE}"),m(" — код курса, "),e("code",{class:"bg-gray-100 dark:bg-gray-700 px-1 rounded"},"{NUM}"),m(" — порядковый номер ")],-1))]),e("div",ie,[C(V,{type:"button",variant:"outline",onClick:w,disabled:n(g)},{default:b(()=>[...i[7]||(i[7]=[m(" Отмена ",-1)])]),_:1},8,["disabled"]),C(V,{type:"submit",loading:n(g)},{default:b(()=>[...i[8]||(i[8]=[m(" Создать ",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["is-open"])}}}),de=Object.assign(le,{__name:"CertificatesTemplateFormModal"}),ce={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},ue={class:"mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ge={key:0,class:"flex justify-center items-center py-20"},me={key:1,class:"rounded-xl bg-white dark:bg-boxdark shadow-md p-12 text-center"},pe={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},fe={class:"relative h-48 bg-linear-to-br from-primary/10 to-primary/5 flex items-center justify-center overflow-hidden"},xe={key:0,class:"absolute inset-0 overflow-hidden bg-gray-100 flex items-center justify-center"},ve=["src"],ye={key:3,class:"w-full h-full bg-black/10 flex items-center justify-center"},be={key:1,class:"absolute inset-0"},he=["src","alt"],ke={key:2,class:"absolute inset-0 flex flex-col items-center justify-center"},we={key:3,class:"text-center px-4"},_e={key:0,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Ce={key:1,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},Me={class:"absolute top-3 left-3 flex gap-2"},ze={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3"},je=["onClick"],$e=["onClick"],Ve={class:"p-5"},Be={class:"font-semibold text-gray-900 dark:text-white mb-2 truncate"},De={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mb-3 line-clamp-2"},Fe={class:"flex flex-wrap gap-3 text-xs"},Se={class:"inline-flex items-center gap-1 text-gray-500 dark:text-gray-400"},Te={class:"inline-flex items-center gap-1 text-gray-500 dark:text-gray-400"},He={class:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700"},Ue={class:"ml-2 text-xs bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded"},Ke=I({__name:"index",setup(B){re({title:"Шаблоны сертификатов - АТЦ Платформа"});const{authFetch:M}=R(),{success:z,error:h}=G(),{canCreateTemplates:j,canDeleteTemplates:D}=ae(),k=v(!0),d=v([]),c=v(!1),g=v(!1),f=v(null),w=v(!1),$=async()=>{k.value=!0;try{const o=await M("/api/certificates/templates");o.success&&(d.value=o.templates)}catch(o){console.error("Error loading templates:",o),h(o.message||"Ошибка загрузки шаблонов")}finally{k.value=!1}},u=o=>{c.value=!1,W(`/certificates/templates/${o.id}`)},i=o=>{f.value=o,g.value=!0},V=async()=>{if(f.value){w.value=!0;try{await M(`/api/certificates/templates/${f.value.id}`,{method:"DELETE"}),z("Шаблон успешно удалён"),await $()}catch(o){console.error("Error deleting template:",o),h(o.data?.message||o.message||"Ошибка удаления")}finally{w.value=!1,g.value=!1,f.value=null}}},F=async o=>{try{const t=await M(`/api/certificates/templates/${o.id}/duplicate`,{method:"POST"});t.success&&(z(t.message||"Шаблон успешно дублирован"),W(`/certificates/templates/${t.template.id}`))}catch(t){console.error("Error duplicating template:",t),h(t.data?.message||t.message||"Ошибка дублирования")}};oe(()=>{$()});const x=o=>{const t=o.templateData?.background;return t?t.type==="color"?{backgroundColor:t.value}:t.type==="image"?{backgroundImage:`url(${t.value})`,backgroundSize:"cover",backgroundPosition:"center"}:{backgroundColor:"#ffffff"}:{backgroundColor:"#ffffff"}},J=o=>({left:`${o.x}px`,top:`${o.y}px`,width:`${o.width}px`,height:`${o.height}px`,transform:o.rotation?`rotate(${o.rotation}deg)`:void 0,position:"absolute",zIndex:10}),E=o=>({fontFamily:o.fontFamily,fontSize:`${o.fontSize}px`,fontWeight:o.fontWeight,fontStyle:o.fontStyle,color:o.color,textAlign:o.textAlign,whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:o.lineHeight||1.2,width:"100%",height:"100%",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center"});return(o,t)=>{const N=q,O=Z,Q=de,X=se;return s(),a("div",ce,[e("div",ue,[t[5]||(t[5]=e("div",null,[e("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Шаблоны сертификатов "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Управление шаблонами для генерации сертификатов ")],-1)),n(j)?(s(),H(N,{key:0,onClick:t[0]||(t[0]=r=>c.value=!0)},{default:b(()=>[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),m(" Создать шаблон ",-1)])]),_:1})):y("",!0)]),n(k)?(s(),a("div",ge,[...t[6]||(t[6]=[e("div",{class:"h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"},null,-1)])])):n(d).length===0?(s(),a("div",me,[t[8]||(t[8]=Y('<div class="mx-auto mb-4 h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center"><svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2"> Нет шаблонов </h3><p class="text-gray-500 dark:text-gray-400 mb-6"> Создайте первый шаблон сертификата для начала работы </p>',3)),n(j)?(s(),H(N,{key:0,onClick:t[1]||(t[1]=r=>c.value=!0)},{default:b(()=>[...t[7]||(t[7]=[m(" Создать шаблон ",-1)])]),_:1})):y("",!0)])):(s(),a("div",pe,[(s(!0),a(L,null,P(n(d),r=>(s(),a("div",{key:r.id,class:"group rounded-xl bg-white dark:bg-boxdark shadow-md overflow-hidden hover:shadow-lg transition-all duration-200"},[e("div",fe,[r.templateData?(s(),a("div",xe,[e("div",{class:"relative bg-white shadow-lg overflow-hidden shrink-0",style:_({width:`${r.templateData.width}px`,height:`${r.templateData.height}px`,transform:"scale(0.2)",transformOrigin:"center center"})},[e("div",{class:"absolute inset-0 z-0",style:_(x(r))},null,4),(s(!0),a(L,null,P(r.templateData.elements,l=>(s(),a("div",{key:l.id,style:_(J(l)),class:"pointer-events-none"},[l.type==="text"?(s(),a("div",{key:0,style:_(E(l))},p(l.content),5)):l.type==="variable"?(s(),a("div",{key:1,style:_(E(l)),class:"text-primary font-bold opacity-70"}," ["+p(l.variableKey)+"] ",5)):l.type==="image"?(s(),a("img",{key:2,src:l.src,class:"w-full h-full object-contain"},null,8,ve)):l.type==="qr"?(s(),a("div",ye,[...t[9]||(t[9]=[e("svg",{class:"w-1/2 h-1/2 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M3 3h6v6H3V3zm2 2v2h2V5H5zm8-2h6v6h-6V3zm2 2v2h2V5h-2zM3 11h6v6H3v-6zm2 2v2h2v-2H5zm13-2h-3v3h3v-3zm0 3h-3v3h3v-3z"})],-1)])])):l.type==="shape"?(s(),a("div",{key:4,class:"w-full h-full",style:_({backgroundColor:l.fillColor,borderRadius:l.shapeType==="circle"?"50%":"0",border:l.strokeWidth>0?`${l.strokeWidth}px solid ${l.strokeColor}`:"none"})},null,4)):y("",!0)],4))),128))],4),t[10]||(t[10]=e("div",{class:"absolute inset-0 bg-linear-to-t from-black/10 to-transparent pointer-events-none"},null,-1))])):r.backgroundUrl?(s(),a("div",be,[e("img",{src:r.backgroundUrl,alt:r.name,class:"w-full h-full object-cover object-center transition-transform duration-300 group-hover:scale-105"},null,8,he),t[11]||(t[11]=e("div",{class:"absolute inset-0 bg-linear-to-t from-black/30 to-transparent"},null,-1))])):r.originalFileUrl?(s(),a("div",ke,[...t[12]||(t[12]=[Y('<div class="w-24 h-28 bg-white dark:bg-gray-200 rounded-lg shadow-lg flex flex-col items-center justify-center transform -rotate-2 transition-transform duration-300 group-hover:rotate-0 group-hover:scale-105"><svg class="w-10 h-10 text-primary mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span class="text-xs font-semibold text-gray-600">.docx</span></div><p class="mt-2 text-xs text-gray-500 dark:text-gray-400"> Word шаблон загружен </p>',2)])])):(s(),a("div",we,[...t[13]||(t[13]=[e("div",{class:"w-16 h-16 mx-auto mb-3 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})])],-1),e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Загрузите шаблон",-1)])])),r.originalFileUrl||r.backgroundUrl?(s(),a("div",{key:4,class:U(["absolute bottom-3 right-3 px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 backdrop-blur-sm",r.variables&&r.variables.length>0?"bg-success/80 text-white":"bg-warning/80 text-white"])},[r.variables&&r.variables.length>0?(s(),a("svg",_e,[...t[14]||(t[14]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):(s(),a("svg",Ce,[...t[15]||(t[15]=[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)])])),m(" "+p(r.variables&&r.variables.length>0?"Готов":"Настройте"),1)],2)):y("",!0),e("div",Me,[e("span",{class:U(["px-2 py-1 rounded-full text-xs font-medium",r.isActive?"bg-success/20 text-success":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"])},p(r.isActive?"Активен":"Неактивен"),3)]),e("div",ze,[C(O,{to:`/certificates/templates/${r.id}/editor`,class:"p-2 bg-white rounded-lg hover:bg-blue-50 transition-colors",title:"Открыть редактор"},{default:b(()=>[...t[16]||(t[16]=[e("svg",{class:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})],-1)])]),_:1},8,["to"]),C(O,{to:`/certificates/templates/${r.id}`,class:"p-2 bg-white rounded-lg hover:bg-gray-100 transition-colors",title:"Настройки"},{default:b(()=>[...t[17]||(t[17]=[e("svg",{class:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),_:1},8,["to"]),e("button",{onClick:K(l=>F(r),["stop"]),class:"p-2 bg-white rounded-lg hover:bg-green-50 transition-colors",title:"Дублировать"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,je),n(D)?(s(),a("button",{key:0,onClick:l=>i(r),class:"p-2 bg-white rounded-lg hover:bg-red-50 transition-colors",title:"Удалить"},[...t[19]||(t[19]=[e("svg",{class:"w-5 h-5 text-danger",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,$e)):y("",!0)])]),e("div",Ve,[e("h3",Be,p(r.name),1),r.description?(s(),a("p",De,p(r.description),1)):y("",!0),e("div",Fe,[e("span",Se,[t[20]||(t[20]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),m(" "+p(r.variables?.length||0)+" переменных ",1)]),e("span",Te,[t[21]||(t[21]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),m(" "+p(r.lastNumber)+" выдано ",1)])]),e("div",He,[t[22]||(t[22]=e("span",{class:"text-xs text-gray-400"},"Формат:",-1)),e("code",Ue,p(r.numberFormat),1)])])]))),128))])),C(Q,{"is-open":n(c),onClose:t[2]||(t[2]=r=>c.value=!1),onCreated:u},null,8,["is-open"]),C(X,{"is-open":n(g),title:"Удаление шаблона",message:"Вы уверены, что хотите удалить этот шаблон?","item-name":n(f)?.name,warning:"Это действие нельзя отменить.",loading:n(w),onConfirm:V,onCancel:t[3]||(t[3]=r=>g.value=!1)},null,8,["is-open","item-name","loading"])])}}});export{Ke as default};
