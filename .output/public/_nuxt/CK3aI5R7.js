import{_ as Z}from"./BKg9m4wI.js";import{_ as ee}from"./BMofnORk.js";import{_ as te}from"./Bd-ycxNi.js";import{v as re,u as se,Q as oe,s as ae,r as c,f as U,g as ie,c as l,a as t,b as f,w as v,i as o,t as u,z as ne,x as g,h as M,d as p,A as b,n as V,D as le,F as S,j as $,G as de,o as d}from"./GLV6bXvn.js";import{u as ue}from"./DlZaGH1J.js";import{u as ce}from"./DVL-QcDc.js";import"./UFmxYCVi.js";import"./CyDLpZDf.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const me={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},pe={class:"mb-6"},xe={class:"flex items-center gap-3 mb-4"},fe={key:0,class:"flex justify-center items-center py-20"},ge={key:1,class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark p-8"},ve={class:"text-center"},ye={class:"text-gray-600 dark:text-gray-400 mb-4"},ke={class:"rounded-lg bg-white dark:bg-boxdark p-6 shadow-md"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},he={class:"md:col-span-2"},we={key:0,class:"mt-1 text-sm text-danger"},_e={key:0,class:"mt-1 text-sm text-danger"},He={key:0,class:"mt-1 text-sm text-danger"},Ce=["value"],Ie={class:"flex items-center gap-3"},Ne={class:"flex items-center gap-3"},Me={class:"inline-flex items-center cursor-pointer"},Ve={class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},De={class:"md:col-span-2"},Te={class:"rounded-lg bg-white dark:bg-boxdark p-6 shadow-md"},je={class:"flex items-center justify-between mb-4"},Ae={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},Be={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ue={key:1,class:"space-y-3"},Se={class:"flex items-center gap-3 flex-1"},$e={class:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold text-sm"},Ee={class:"flex-1"},Fe={class:"flex items-center gap-2"},Le={class:"font-medium text-gray-900 dark:text-white"},Oe={key:0,class:"text-xs text-gray-400"},Pe={key:1,class:"text-xs text-success"},ze={class:"flex items-center gap-3 mt-1"},qe={class:"text-xs text-gray-500 dark:text-gray-400"},Ge={class:"text-xs font-semibold text-primary"},Re={class:"flex items-center gap-2"},Je=["onClick"],Qe=["onClick"],Ye={class:"flex items-center justify-end gap-4"},nt=re({__name:"[id]",setup(Ke){se({title:"Редактирование программы - АТЦ Платформа"});const E=oe(),F=ae(),y=E.params.id,{authFetch:h}=ue(),{success:L,error:D}=ce(),C=c(!0),k=c(null),I=c(!1),T=c([]),j=c([]),w=c(!1),x=c(null),_=c(void 0),r=c({name:"",shortName:"",code:"",description:"",certificateTemplateId:void 0,certificateValidityMonths:void 0,isActive:!0,disciplines:[]}),n=c({}),O=U(()=>r.value.disciplines.reduce((s,e)=>s+(e.theoryHours||0)+(e.practiceHours||0)+(e.assessmentHours||0),0)),P=s=>(s.theoryHours||0)+(s.practiceHours||0)+(s.assessmentHours||0),z=U(()=>j.value.map(s=>({id:s.id,label:s.fullName,description:s.email}))),A=async()=>{C.value=!0,k.value=null;try{const s=await h(`/api/courses/${y}`,{method:"GET"});if(s.success&&s.course){const e=s.course;r.value={name:e.name,shortName:e.shortName,code:e.code,description:e.description||"",certificateTemplateId:e.certificateTemplateId,certificateValidityMonths:e.certificateValidityMonths||void 0,isActive:e.isActive,disciplines:(e.disciplines||[]).map((i,m)=>({id:i.id,name:i.name,description:i.description||"",theoryHours:i.theoryHours||0,practiceHours:i.practiceHours||0,assessmentHours:i.assessmentHours||0,orderIndex:i.orderIndex??m,instructorIds:i.instructors?.map(N=>N.instructorId)||[]}))}}else k.value=s.message||"Не удалось загрузить данные учебной программы"}catch(s){console.error("Error loading course:",s),k.value=s.data?.message||s.message||"Не удалось загрузить данные учебной программы"}finally{C.value=!1}},q=async()=>{try{const s=await h("/api/courses/templates");s.success&&(T.value=s.templates)}catch(s){console.error("Ошибка загрузки шаблонов сертификатов:",s)}},G=async()=>{try{const s=await h("/api/instructors/all");s.success&&(j.value=s.instructors)}catch(s){console.error("Ошибка загрузки инструкторов:",s)}},R=()=>{x.value=null,_.value=void 0,w.value=!0},J=s=>{const e=r.value.disciplines[s];e&&(x.value=s,_.value={name:e.name,description:e.description,theoryHours:e.theoryHours,practiceHours:e.practiceHours,assessmentHours:e.assessmentHours,orderIndex:e.orderIndex,instructorIds:e.instructorIds||[]},w.value=!0)},B=()=>{w.value=!1,x.value=null,_.value=void 0},Q=s=>{if(x.value!==null){const i=r.value.disciplines[x.value]?.id;r.value.disciplines[x.value]={...s,id:i,orderIndex:x.value}}else r.value.disciplines.push({...s,orderIndex:r.value.disciplines.length});B()},Y=s=>{r.value.disciplines.splice(s,1),r.value.disciplines.forEach((e,i)=>{e.orderIndex=i})},K=()=>(n.value={},(!r.value.name||r.value.name.trim().length===0)&&(n.value.name="Название курса обязательно"),(!r.value.shortName||r.value.shortName.trim().length<2)&&(n.value.shortName="Короткое название должно быть от 2 до 10 символов"),(!r.value.code||r.value.code.trim().length===0)&&(n.value.code="Код курса обязателен"),Object.keys(n.value).length===0),W=async()=>{if(K()){I.value=!0;try{const s={name:r.value.name,shortName:r.value.shortName,code:r.value.code,description:r.value.description||null,certificateTemplateId:r.value.certificateTemplateId||null,certificateValidityMonths:r.value.certificateValidityMonths||null,isActive:r.value.isActive,disciplines:r.value.disciplines.map((i,m)=>({id:i.id,name:i.name,description:i.description||null,theoryHours:i.theoryHours,practiceHours:i.practiceHours,assessmentHours:i.assessmentHours,orderIndex:m,instructorIds:i.instructorIds}))},e=await h(`/api/courses/${y}`,{method:"PUT",body:JSON.stringify(s)});e.success?(L("Учебная программа успешно обновлена","Успех"),setTimeout(()=>{F.push(`/programs/${y}`)},1e3)):(e.field&&(n.value[e.field]=e.message),D(e.message||"Ошибка при обновлении учебной программы","Ошибка"))}catch(s){console.error("Ошибка обновления учебной программы:",s),D(s.data?.message||"Произошла ошибка при обновлении учебной программы","Ошибка")}finally{I.value=!1}}};return ie(async()=>{await Promise.all([A(),q(),G()])}),(s,e)=>{const i=Z,m=ee,N=te;return d(),l("div",me,[t("div",pe,[t("div",xe,[f(i,{to:`/programs/${o(y)}`,class:"flex items-center gap-2 text-gray-600 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors"},{default:v(()=>[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),p(" Назад к программе ",-1)])]),_:1},8,["to"])]),e[9]||(e[9]=t("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Редактирование учебной программы ",-1)),e[10]||(e[10]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," Внесите изменения в информацию о курсе и дисциплинах ",-1))]),o(C)?(d(),l("div",fe,[...e[11]||(e[11]=[t("div",{class:"h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"},null,-1)])])):o(k)?(d(),l("div",ge,[t("div",ve,[e[13]||(e[13]=t("div",{class:"mx-auto mb-4 h-16 w-16 rounded-full bg-danger/10 flex items-center justify-center"},[t("svg",{class:"w-8 h-8 text-danger",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[14]||(e[14]=t("h3",{class:"mb-2 text-xl font-semibold text-black dark:text-white"},"Ошибка загрузки",-1)),t("p",ye,u(o(k)),1),f(m,{variant:"primary",onClick:A},{default:v(()=>[...e[12]||(e[12]=[p(" Попробовать снова ",-1)])]),_:1})])])):(d(),l("form",{key:2,onSubmit:ne(W,["prevent"]),class:"space-y-6"},[t("div",ke,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-black dark:text-white mb-4"}," Основная информация ",-1)),t("div",be,[t("div",he,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[p(" Название курса "),t("span",{class:"text-danger"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o(r).name=a),type:"text",placeholder:"Например: Основы программирования на Python",class:V(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o(n).name}]),required:""},null,2),[[b,o(r).name]]),o(n).name?(d(),l("p",we,u(o(n).name),1)):M("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[p(" Короткое название "),t("span",{class:"text-danger"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o(r).shortName=a),type:"text",placeholder:"PYTHON",maxlength:"10",class:V(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary uppercase",{"border-danger":o(n).shortName}]),required:"",onInput:e[2]||(e[2]=a=>o(r).shortName=o(r).shortName.toUpperCase())},null,34),[[b,o(r).shortName]]),e[17]||(e[17]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"4-10 заглавных букв",-1)),o(n).shortName?(d(),l("p",_e,u(o(n).shortName),1)):M("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[p(" Код курса "),t("span",{class:"text-danger"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o(r).code=a),type:"text",placeholder:"2400001",class:V(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o(n).code}]),required:""},null,2),[[b,o(r).code]]),o(n).code?(d(),l("p",He,u(o(n).code),1)):M("",!0)]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Шаблон сертификата ",-1)),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>o(r).certificateTemplateId=a),class:"w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},[e[19]||(e[19]=t("option",{value:void 0},"Не выбран",-1)),(d(!0),l(S,null,$(o(T),a=>(d(),l("option",{key:a.id,value:a.id},u(a.name),9,Ce))),128))],512),[[le,o(r).certificateTemplateId]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Срок действия сертификата ",-1)),t("div",Ie,[g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o(r).certificateValidityMonths=a),type:"number",min:"1",max:"120",placeholder:"Не ограничен",class:"w-40 rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},null,512),[[b,o(r).certificateValidityMonths,void 0,{number:!0}]]),e[21]||(e[21]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"месяцев",-1))]),e[23]||(e[23]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Оставьте пустым для бессрочных сертификатов ",-1))]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Статус ",-1)),t("div",Ne,[t("label",Me,[g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o(r).isActive=a),type:"checkbox",class:"sr-only peer"},null,512),[[de,o(r).isActive]]),e[24]||(e[24]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 dark:peer-focus:ring-primary/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"},null,-1)),t("span",Ve,u(o(r).isActive?"Активен":"Неактивен"),1)])])]),t("div",De,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),g(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=a=>o(r).description=a),rows:"4",placeholder:"Краткое описание курса...",class:"w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},null,512),[[b,o(r).description]])])])]),t("div",Te,[t("div",je,[t("div",null,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold text-black dark:text-white"}," Дисциплины курса ",-1)),t("p",Ae," Всего часов: "+u(o(O)),1)]),f(m,{type:"button",onClick:R,class:"flex items-center gap-2"},{default:v(()=>[...e[29]||(e[29]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),p(" Добавить дисциплину ",-1)])]),_:1})]),o(r).disciplines.length===0?(d(),l("div",Be,[...e[30]||(e[30]=[t("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1),t("p",null,"Дисциплины не добавлены",-1),t("p",{class:"text-sm mt-1"},'Нажмите "Добавить дисциплину" чтобы начать',-1)])])):(d(),l("div",Ue,[(d(!0),l(S,null,$(o(r).disciplines,(a,H)=>(d(),l("div",{key:a.id||`new-${H}`,class:"flex items-center justify-between border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-primary/50 transition-colors"},[t("div",Se,[t("div",$e,u(H+1),1),t("div",Ee,[t("div",Fe,[t("h4",Le,u(a.name),1),a.id?(d(),l("span",Oe,"(существующая)")):(d(),l("span",Pe,"(новая)"))]),t("div",ze,[t("span",qe," Теория: "+u(a.theoryHours)+"ч | Практика: "+u(a.practiceHours)+"ч | Проверка: "+u(a.assessmentHours)+"ч ",1),t("span",Ge," Всего: "+u(P(a))+"ч ",1)])])]),t("div",Re,[t("button",{type:"button",onClick:X=>J(H),class:"p-2 text-gray-600 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors",title:"Редактировать"},[...e[31]||(e[31]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Je),t("button",{type:"button",onClick:X=>Y(H),class:"p-2 text-danger hover:text-danger/80 transition-colors",title:"Удалить"},[...e[32]||(e[32]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Qe)])]))),128))]))]),t("div",Ye,[f(i,{to:`/programs/${o(y)}`},{default:v(()=>[f(m,{variant:"danger"},{default:v(()=>[...e[33]||(e[33]=[p(" Отмена ",-1)])]),_:1})]),_:1},8,["to"]),f(m,{type:"submit",variant:"success",loading:o(I)},{default:v(()=>[...e[34]||(e[34]=[p(" Сохранить изменения ",-1)])]),_:1},8,["loading"])])],32)),f(N,{"is-open":o(w),discipline:o(_),"instructor-options":o(z),onClose:B,onSave:Q},null,8,["is-open","discipline","instructor-options"])])}}});export{nt as default};
