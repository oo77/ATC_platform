import{_ as F}from"./BMofnORk.js";import{u as I,e as R,r as g,f as V,g as H,c as b,a as r,h as z,b as l,i as m,t as o,w as P,d as u,F as G,j as $,x as i,y as j,z as D,A as y,o as c,n as O,k as J,B as K}from"./GLV6bXvn.js";import{u as Q}from"./DVL-QcDc.js";import{u as W}from"./DlZaGH1J.js";import{C as X,U as Y}from"./DbDyPcRw.js";import{c as U}from"./CVqvr-Q5.js";import{U as Z}from"./8LVoMU2R.js";import{B as rr}from"./ETPkf32v.js";import{L as T}from"./BFBOxgT2.js";import"./CFbq0LVm.js";import"./CRUGdXr-.js";const er=U("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const tr=U("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const ar=U("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const sr=U("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),or={class:"mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10"},dr={key:0,class:"flex justify-center items-center py-20"},lr={key:1,class:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white shadow-md dark:bg-boxdark p-8"},ir={class:"text-center"},nr={class:"text-gray-600 dark:text-gray-400 mb-4"},gr={key:2},ur={class:"mb-6 rounded-lg border border-gray-200 dark:border-gray-700 bg-white shadow-md dark:bg-boxdark"},yr={class:"px-6 pb-6"},cr={class:"relative -mt-16 mb-6 flex flex-col items-center gap-4 sm:flex-row sm:items-end"},pr={class:"relative"},br={class:"h-32 w-32 overflow-hidden rounded-full border-4 border-white bg-gray-100 shadow-lg dark:border-gray-900"},mr=["src","alt"],xr={class:"flex-1 text-center sm:text-left"},vr={class:"mb-1 text-2xl font-bold text-gray-900 dark:text-white"},fr={class:"mb-2 text-gray-600 dark:text-gray-400"},kr={class:"flex flex-wrap items-center justify-center gap-3 sm:justify-start"},wr={class:"inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-sm font-medium text-primary"},hr={key:0,class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},_r={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},Pr={class:"flex items-center gap-3"},Ur={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10"},Cr={class:"text-2xl font-bold text-gray-900 dark:text-white"},jr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-success/50 dark:border-gray-700 dark:bg-gray-800/50"},Ar={class:"flex items-center gap-3"},Mr={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-success/10"},Vr={class:"text-2xl font-bold text-gray-900 dark:text-white"},zr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-warning/50 dark:border-gray-700 dark:bg-gray-800/50"},Dr={class:"flex items-center gap-3"},Tr={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-warning/10"},Er={class:"text-2xl font-bold text-gray-900 dark:text-white"},Nr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-info/50 dark:border-gray-700 dark:bg-gray-800/50"},Lr={class:"flex items-center gap-3"},Sr={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-info/10"},Br={class:"text-2xl font-bold text-gray-900 dark:text-white"},qr={class:"flex flex-col gap-6"},Fr={class:"rounded-lg bg-gray-50 p-1 dark:bg-gray-800"},Ir={class:"flex gap-1","aria-label":"Tabs"},Rr=["onClick"],Hr={class:"flex items-center justify-center gap-2"},Gr={class:"rounded-lg border border-gray-200 dark:border-gray-700 bg-white shadow-md dark:bg-boxdark"},$r={class:"p-6"},Or={class:"space-y-3"},Jr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50"},Kr={class:"font-medium text-gray-900 dark:text-white"},Qr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50"},Wr={class:"font-medium text-gray-900 dark:text-white"},Xr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50"},Yr={class:"font-medium text-gray-900 dark:text-white"},Zr={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50"},re={class:"font-medium text-gray-900 dark:text-white"},ee={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50"},te={class:"font-medium text-gray-900 dark:text-white"},ae={class:"p-6"},se={class:"grid grid-cols-1 gap-5"},oe={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},de={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},le={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},ie={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},ne={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 transition-all hover:border-primary/50 dark:border-gray-700 dark:bg-gray-800/50"},ge={class:"flex justify-end gap-3 pt-4"},ue={class:"p-6"},ye={class:"space-y-6"},ce={class:"rounded-lg border border-gray-200 bg-gray-50 p-5 dark:border-gray-700 dark:bg-gray-800/50"},pe={class:"mb-4 flex items-center gap-2 text-lg font-medium text-gray-900 dark:text-white"},be={class:"flex justify-end pt-2"},Me={__name:"profile",setup(me){I({title:"Профиль пользователя | TailAdmin"});const v=Q();R();const{authFetch:f}=W(),C=g(!0),k=g(null),t=g(null),x=g(null),w=g(!1),h=g(!1),p=g("overview"),d=g({name:"",phone:"",workplace:"",position:"",pinfl:""}),n=g({currentPassword:"",newPassword:"",confirmPassword:""}),E=V(()=>t.value?.role==="ADMIN"),N=V(()=>[{id:"overview",label:"Обзор",icon:Y},{id:"edit",label:"Редактировать",icon:sr},{id:"security",label:"Безопасность",icon:T}]),A=a=>({ADMIN:"Администратор",MANAGER:"Менеджер",TEACHER:"Инструктор",STUDENT:"Студент"})[a]||a,L=a=>a?new Date(a).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Не указано",M=async()=>{try{C.value=!0,k.value=null;const a=await f("/api/profile");if(a?.success&&(t.value=a.user,d.value={name:t.value.name,phone:t.value.phone||"",workplace:t.value.workplace||"",position:t.value.position||"",pinfl:t.value.pinfl||""}),t.value?.role==="ADMIN"){const e=await f("/api/profile/stats/admin");e?.success&&(x.value=e.stats)}}catch(a){console.error("Error loading profile:",a),k.value=a.message||"Ошибка при загрузке профиля"}finally{C.value=!1}},S=async()=>{try{w.value=!0;const a=await f("/api/profile",{method:"PUT",body:d.value});a?.success&&(t.value=a.user,v.success("Профиль успешно обновлен"),p.value="overview")}catch(a){console.error("Error updating profile:",a),v.error(a.data?.message||"Ошибка при обновлении профиля")}finally{w.value=!1}},B=()=>{d.value={name:t.value.name,phone:t.value.phone||"",workplace:t.value.workplace||"",position:t.value.position||"",pinfl:t.value.pinfl||""},p.value="overview"},q=async()=>{if(n.value.newPassword!==n.value.confirmPassword){v.error("Пароли не совпадают");return}try{h.value=!0,(await f("/api/profile/password",{method:"PUT",body:n.value}))?.success&&(v.success("Пароль успешно изменен"),n.value={currentPassword:"",newPassword:"",confirmPassword:""})}catch(a){console.error("Error changing password:",a),v.error(a.data?.message||"Ошибка при изменении пароля")}finally{h.value=!1}};return H(()=>{M()}),(a,e)=>{const _=F;return c(),b("div",or,[e[35]||(e[35]=r("div",{class:"mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},[r("h2",{class:"text-title-md2 font-bold text-black dark:text-white"}," Профиль пользователя ")],-1)),C.value?(c(),b("div",dr,[...e[8]||(e[8]=[r("div",{class:"h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"},null,-1)])])):k.value?(c(),b("div",lr,[r("div",ir,[l(m(X),{class:"h-16 w-16 text-danger mx-auto mb-4"}),e[10]||(e[10]=r("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},"Ошибка загрузки",-1)),r("p",nr,o(k.value),1),l(_,{variant:"primary",onClick:M},{default:P(()=>[...e[9]||(e[9]=[u(" Попробовать снова ",-1)])]),_:1})])])):t.value?(c(),b("div",gr,[r("div",ur,[e[16]||(e[16]=r("div",{class:"relative h-48 overflow-hidden rounded-t-lg bg-linear-to-r from-primary to-primary-600"},[r("div",{class:"absolute inset-0 bg-black/10"})],-1)),r("div",yr,[r("div",cr,[r("div",pr,[r("div",br,[r("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(t.value.name)}&size=128&background=465fff&color=fff&bold=true`,alt:t.value.name,class:"h-full w-full object-cover"},null,8,mr)])]),r("div",xr,[r("h3",vr,o(t.value.name),1),r("p",fr,o(t.value.email),1),r("div",kr,[e[11]||(e[11]=r("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-success/10 px-3 py-1 text-sm font-medium text-success"},[r("span",{class:"h-2 w-2 rounded-full bg-success"}),u(" Активен ")],-1)),r("span",wr,[l(m(ar),{class:"h-4 w-4"}),u(" "+o(A(t.value.role)),1)])])])]),E.value&&x.value?(c(),b("div",hr,[r("div",_r,[r("div",Pr,[r("div",Ur,[l(m(Z),{class:"h-6 w-6 text-primary"})]),r("div",null,[e[12]||(e[12]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Всего пользователей",-1)),r("p",Cr,o(x.value.totalUsers),1)])])]),r("div",jr,[r("div",Ar,[r("div",Mr,[l(m(tr),{class:"h-6 w-6 text-success"})]),r("div",null,[e[13]||(e[13]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Всего студентов",-1)),r("p",Vr,o(x.value.totalStudents),1)])])]),r("div",zr,[r("div",Dr,[r("div",Tr,[l(m(rr),{class:"h-6 w-6 text-warning"})]),r("div",null,[e[14]||(e[14]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Активных групп",-1)),r("p",Er,o(x.value.activeGroups),1)])])]),r("div",Nr,[r("div",Lr,[r("div",Sr,[l(m(er),{class:"h-6 w-6 text-info"})]),r("div",null,[e[15]||(e[15]=r("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Активность сегодня",-1)),r("p",Br,o(x.value.todayActivities),1)])])])])):z("",!0)])]),r("div",qr,[r("div",Fr,[r("nav",Ir,[(c(!0),b(G,null,$(N.value,s=>(c(),b("button",{key:s.id,onClick:xe=>p.value=s.id,class:O(["flex-1 rounded-md px-4 py-3 text-sm font-medium transition-all duration-200",p.value===s.id?"bg-primary text-white shadow-sm":"text-gray-600 hover:bg-white hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"])},[r("span",Hr,[(c(),J(K(s.icon),{class:"h-5 w-5"})),u(" "+o(s.label),1)])],10,Rr))),128))])]),r("div",Gr,[i(r("div",$r,[r("div",null,[e[22]||(e[22]=r("h3",{class:"mb-4 text-xl font-semibold text-gray-900 dark:text-white"}," Личная информация ",-1)),r("div",Or,[r("div",Jr,[e[17]||(e[17]=r("p",{class:"mb-1 text-sm text-gray-600 dark:text-gray-400"},"Полное имя",-1)),r("p",Kr,o(t.value.name),1)]),r("div",Qr,[e[18]||(e[18]=r("p",{class:"mb-1 text-sm text-gray-600 dark:text-gray-400"},"Email",-1)),r("p",Wr,o(t.value.email),1)]),r("div",Xr,[e[19]||(e[19]=r("p",{class:"mb-1 text-sm text-gray-600 dark:text-gray-400"},"Телефон",-1)),r("p",Yr,o(t.value.phone||"Не указан"),1)]),r("div",Zr,[e[20]||(e[20]=r("p",{class:"mb-1 text-sm text-gray-600 dark:text-gray-400"},"Роль",-1)),r("p",re,o(A(t.value.role)),1)]),r("div",ee,[e[21]||(e[21]=r("p",{class:"mb-1 text-sm text-gray-600 dark:text-gray-400"},"Дата регистрации",-1)),r("p",te,o(L(t.value.created_at)),1)])])])],512),[[j,p.value==="overview"]]),i(r("div",ae,[e[29]||(e[29]=r("h3",{class:"mb-6 text-xl font-semibold text-gray-900 dark:text-white"}," Редактировать профиль ",-1)),r("form",{onSubmit:D(S,["prevent"]),class:"space-y-5"},[r("div",se,[r("div",oe,[e[23]||(e[23]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Полное имя * ",-1)),i(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.name=s),type:"text",required:"",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,d.value.name]])]),r("div",de,[e[24]||(e[24]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Телефон ",-1)),i(r("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.phone=s),type:"tel",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,d.value.phone]])]),r("div",le,[e[25]||(e[25]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Место работы ",-1)),i(r("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.workplace=s),type:"text",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,d.value.workplace]])]),r("div",ie,[e[26]||(e[26]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Должность ",-1)),i(r("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.position=s),type:"text",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,d.value.position]])]),r("div",ne,[e[27]||(e[27]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," ПИНФЛ ",-1)),i(r("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>d.value.pinfl=s),type:"text",maxlength:"14",pattern:"[0-9]{14}",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,d.value.pinfl]])])]),r("div",ge,[l(_,{variant:"outline",size:"md",type:"button",onClick:B},{default:P(()=>[...e[28]||(e[28]=[u(" Отмена ",-1)])]),_:1}),l(_,{variant:"primary",size:"md",type:"submit",disabled:w.value},{default:P(()=>[u(o(w.value?"Сохранение...":"Сохранить изменения"),1)]),_:1},8,["disabled"])])],32)],512),[[j,p.value==="edit"]]),i(r("div",ue,[e[34]||(e[34]=r("h3",{class:"mb-6 text-xl font-semibold text-gray-900 dark:text-white"}," Настройки безопасности ",-1)),r("div",ye,[r("div",ce,[r("h4",pe,[l(m(T),{class:"h-5 w-5"}),e[30]||(e[30]=u(" Изменить пароль ",-1))]),r("form",{onSubmit:D(q,["prevent"]),class:"space-y-4"},[r("div",null,[e[31]||(e[31]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Текущий пароль * ",-1)),i(r("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.currentPassword=s),type:"password",required:"",autocomplete:"current-password",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,n.value.currentPassword]])]),r("div",null,[e[32]||(e[32]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Новый пароль * ",-1)),i(r("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.newPassword=s),type:"password",required:"",minlength:"6",autocomplete:"new-password",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,n.value.newPassword]])]),r("div",null,[e[33]||(e[33]=r("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Подтвердите новый пароль * ",-1)),i(r("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>n.value.confirmPassword=s),type:"password",required:"",autocomplete:"new-password",class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 transition-all focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-900 dark:text-white"},null,512),[[y,n.value.confirmPassword]])]),r("div",be,[l(_,{variant:"primary",size:"md",type:"submit",disabled:h.value},{default:P(()=>[u(o(h.value?"Обновление...":"Обновить пароль"),1)]),_:1},8,["disabled"])])],32)])])],512),[[j,p.value==="security"]])])])])):z("",!0)])}}};export{Me as default};
