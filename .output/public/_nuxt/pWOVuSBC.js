import{_ as N}from"./BMofnORk.js";import{v as O,r as A,C as B,f as E,g as F,k as L,b as g,w,T as j,K as q,c as d,h as u,z as X,a as t,t as m,x as k,d as b,A as y,n as v,o as n,e as z,R as I}from"./GLV6bXvn.js";import{u as R}from"./DVL-QcDc.js";import{u as G}from"./DlZaGH1J.js";const H={key:0,class:"fixed inset-0 z-999999 flex items-center justify-center bg-black/80 px-4 py-5"},K={class:"border-b border-stroke px-6 py-4 dark:border-strokedark flex items-center justify-between"},Z={class:"text-xl font-semibold text-black dark:text-white"},J={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},Q={class:"sm:col-span-2"},W={key:0,class:"mt-1 text-sm text-danger"},Y=["disabled"],ee={key:0,class:"mt-1 text-sm text-danger"},te={key:0,class:"mt-1 text-sm text-danger"},re={key:0},se=["required"],oe={key:0,class:"mt-1 text-sm text-danger"},ae={key:1},le=["required"],ne={key:0,class:"mt-1 text-sm text-danger"},ie={key:0,class:"mt-1 text-sm text-danger"},de={key:0,class:"mt-1 text-sm text-danger"},ue={class:"sm:col-span-2"},pe={key:0,class:"mt-1 text-sm text-danger"},ce={class:"mt-6 flex justify-end gap-4"},me=O({__name:"UserFormModal",props:{user:{},role:{}},emits:["close","save"],setup(_,{emit:P}){const p=_,$=P,h=A(!1),x=A(!1),o=B({}),i=R(),r=B({name:"",email:"",phone:"",password:"",confirmPassword:"",workplace:"",position:"",pinfl:""}),c=E(()=>!!p.user),T=E(()=>({ADMIN:"Администратор",MANAGER:"Модератор",TEACHER:"Учитель",STUDENT:"Студент"})[p.role]),C=(s,e)=>{switch(s){case"name":if(!e||e.trim().length<2)return"Имя должно содержать минимум 2 символа";break;case"email":if(!e||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return"Введите корректный email адрес";break;case"phone":if(e&&!/^\+998\d{9}$/.test(e))return"Номер телефона должен быть в формате +998XXXXXXXXX";break;case"password":if(!c.value){if(!e||e.length<6)return"Пароль должен содержать минимум 6 символов";if(!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(e))return"Пароль должен содержать заглавную букву, строчную букву и цифру"}break;case"confirmPassword":if(!c.value&&e!==r.password)return"Пароли не совпадают";break;case"pinfl":if(e&&!/^\d{14}$/.test(e))return"ПИНФЛ должен содержать ровно 14 цифр";break}return null},U=()=>{x.value=!1,setTimeout(()=>{$("close")},300)},f=async()=>{if(h.value)return;Object.keys(o).forEach(l=>delete o[l]);const s=["name","email","phone"];c.value||s.push("password","confirmPassword"),s.push("pinfl");let e=!1;for(const l of s){const a=r[l],M=C(l,a);M&&(o[l]=[M],i.error(M,"Ошибка валидации"),e=!0)}if(!e){h.value=!0;try{if(c.value){const{token:l}=z();await $fetch(`/api/users/${p.user.id}`,{method:"PUT",headers:{Authorization:`Bearer ${l.value}`},body:{name:r.name,phone:r.phone||void 0,workplace:r.workplace||void 0,position:r.position||void 0,pinfl:r.pinfl||void 0}}),i.success("Пользователь успешно обновлен","Успех")}else{const{token:l}=z();await $fetch("/api/users",{method:"POST",headers:{Authorization:`Bearer ${l.value}`},body:{name:r.name,email:r.email,password:r.password,phone:r.phone||void 0,workplace:r.workplace||void 0,position:r.position||void 0,pinfl:r.pinfl||void 0,role:p.role}}),i.success("Пользователь успешно создан","Успех")}$("save"),U()}catch(l){if(console.error("Error saving user:",l),l.data?.errors){const a=l.data.errors;Object.assign(o,a),Object.entries(a).forEach(([M,V])=>{const S={name:"Имя",email:"Email",phone:"Телефон",password:"Пароль",pinfl:"ПИНФЛ",workplace:"Место работы",position:"Должность"}[M]||M,D=Array.isArray(V)?V[0]:V;i.error(`${S}: ${D}`,"Ошибка валидации")})}else{const a=l.data?.message||"Произошла ошибка при сохранении";i.error(a,"Ошибка")}}finally{h.value=!1}}};return F(()=>{setTimeout(()=>{x.value=!0},10),p.user&&(r.name=p.user.name,r.email=p.user.email,r.phone=p.user.phone||"",r.workplace=p.user.workplace||"",r.position=p.user.position||"",r.pinfl=p.user.pinfl||"")}),(s,e)=>{const l=N;return n(),L(q,{to:"body"},[g(j,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:w(()=>[x.value?(n(),d("div",H,[g(j,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 -translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 -translate-y-4"},{default:w(()=>[x.value?(n(),d("div",{key:0,class:"w-full max-w-3xl rounded-lg bg-white dark:bg-boxdark shadow-xl",onClick:e[8]||(e[8]=X(()=>{},["stop"]))},[t("div",K,[t("h3",Z,m(c.value?"Редактировать":"Добавить")+" "+m(T.value.toLowerCase())+"а ",1),t("button",{onClick:U,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"},[...e[9]||(e[9]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:X(f,["prevent"]),class:"p-6"},[t("div",J,[t("div",Q,[e[10]||(e[10]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"},[b(" Полное имя "),t("span",{class:"text-danger"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),type:"text",placeholder:"Введите полное имя",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.name}]),required:""},null,2),[[y,r.name]]),o.name?(n(),d("p",W,m(o.name[0]),1)):u("",!0)]),t("div",null,[e[11]||(e[11]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"},[b(" Email "),t("span",{class:"text-danger"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.email=a),type:"email",placeholder:"email@example.com",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.email}]),disabled:c.value,required:""},null,10,Y),[[y,r.email]]),o.email?(n(),d("p",ee,m(o.email[0]),1)):u("",!0)]),t("div",null,[e[12]||(e[12]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Телефон ",-1)),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.phone=a),type:"tel",placeholder:"+998901234567",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.phone}])},null,2),[[y,r.phone]]),o.phone?(n(),d("p",te,m(o.phone[0]),1)):u("",!0),e[13]||(e[13]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Формат: +998XXXXXXXXX ",-1))]),c.value?u("",!0):(n(),d("div",re,[e[14]||(e[14]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"},[b(" Пароль "),t("span",{class:"text-danger"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.password=a),type:"password",placeholder:"Минимум 6 символов",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.password}]),required:!c.value},null,10,se),[[y,r.password]]),o.password?(n(),d("p",oe,m(o.password[0]),1)):u("",!0),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Должен содержать заглавную букву, строчную букву и цифру ",-1))])),c.value?u("",!0):(n(),d("div",ae,[e[16]||(e[16]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"},[b(" Подтвердите пароль "),t("span",{class:"text-danger"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.confirmPassword=a),type:"password",placeholder:"Повторите пароль",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.confirmPassword}]),required:!c.value},null,10,le),[[y,r.confirmPassword]]),o.confirmPassword?(n(),d("p",ne,m(o.confirmPassword[0]),1)):u("",!0)])),t("div",null,[e[17]||(e[17]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Место работы ",-1)),k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.workplace=a),type:"text",placeholder:"Название организации",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.workplace}])},null,2),[[y,r.workplace]]),o.workplace?(n(),d("p",ie,m(o.workplace[0]),1)):u("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," Должность ",-1)),k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.position=a),type:"text",placeholder:"Должность",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.position}])},null,2),[[y,r.position]]),o.position?(n(),d("p",de,m(o.position[0]),1)):u("",!0)]),t("div",ue,[e[19]||(e[19]=t("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white"}," ПИНФЛ ",-1)),k(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>r.pinfl=a),type:"text",placeholder:"14 цифр",maxlength:"14",class:v(["w-full rounded-lg border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",{"border-danger":o.pinfl}])},null,2),[[y,r.pinfl]]),o.pinfl?(n(),d("p",pe,m(o.pinfl[0]),1)):u("",!0),e[20]||(e[20]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Персональный идентификационный номер физического лица (14 цифр) ",-1))])]),t("div",ce,[g(l,{variant:"danger",onClick:U,disabled:h.value},{default:w(()=>[...e[21]||(e[21]=[b(" Отмена ",-1)])]),_:1},8,["disabled"]),g(l,{variant:"success",type:"submit",loading:h.value},{default:w(()=>[b(m(c.value?"Сохранить":"Создать"),1)]),_:1},8,["loading"])])],32)])):u("",!0)]),_:1})])):u("",!0)]),_:1})])}}}),Be=Object.assign(me,{__name:"UsersUserFormModal"}),be={key:0,class:"fixed inset-0 z-999999 flex items-center justify-center bg-black/80 px-4 py-5"},fe={class:"border-b border-stroke px-6 py-4 dark:border-strokedark flex items-center justify-between"},ke=["disabled"],xe={class:"mb-4"},ye={class:"mb-4 text-sm text-gray-600 dark:text-gray-400"},ve={class:"font-medium text-black dark:text-white"},ge={class:"mb-4"},we={class:"relative"},he=["type"],_e={key:0,class:"h-5 w-5 text-gray-500 hover:text-primary transition-colors duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Me={key:1,class:"h-5 w-5 text-gray-500 hover:text-primary transition-colors duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={class:"mb-4"},Ce={class:"flex flex-wrap gap-2"},Ue={class:"flex justify-end gap-4 mt-6"},Ae=O({__name:"UserPasswordModal",props:{isOpen:{type:Boolean},userId:{},userName:{}},emits:["close","success"],setup(_,{emit:P}){const p=_,$=P,{authFetch:h}=G(),x=R(),o=A(!1),i=A(""),r=A(!1),c=()=>{const f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let s="";s+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(Math.random()*26)),s+="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(Math.random()*26)),s+="0123456789".charAt(Math.floor(Math.random()*10));for(let e=0;e<9;e++)s+=f.charAt(Math.floor(Math.random()*f.length));i.value=s.split("").sort(()=>.5-Math.random()).join(""),r.value=!0},T=()=>{i.value&&(navigator.clipboard.writeText(i.value),x.success("Пароль скопирован в буфер обмена","Скопировано"))},C=()=>{i.value="",r.value=!1,$("close")},U=async()=>{if(!o.value&&!(!i.value||i.value.length<6)){o.value=!0;try{(await h(`/api/users/${p.userId}/password`,{method:"PUT",body:{password:i.value}})).success&&(x.success("Пароль пользователя успешно изменен","Успех"),$("success"),C())}catch(f){console.error("Password reset error:",f),x.error(f.message||"Ошибка сброса пароля")}finally{o.value=!1}}};return(f,s)=>{const e=N;return n(),L(q,{to:"body"},[g(j,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:w(()=>[_.isOpen?(n(),d("div",be,[g(j,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 scale-95 -translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 -translate-y-4"},{default:w(()=>[_.isOpen?(n(),d("div",{key:0,class:"w-full max-w-md rounded-lg bg-white dark:bg-boxdark shadow-xl",onClick:s[2]||(s[2]=X(()=>{},["stop"]))},[t("div",fe,[s[4]||(s[4]=t("h3",{class:"text-xl font-semibold text-black dark:text-white"}," Сброс пароля ",-1)),t("button",{onClick:C,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",disabled:o.value},[...s[3]||(s[3]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ke)]),t("form",{onSubmit:X(U,["prevent"]),class:"p-6"},[t("div",xe,[t("p",ye,[s[5]||(s[5]=b(" Установите новый пароль для пользователя ",-1)),t("span",ve,m(_.userName),1),s[6]||(s[6]=b(". ",-1))]),t("div",ge,[s[9]||(s[9]=t("label",{class:"mb-2.5 block font-medium text-black dark:text-white"}," Новый пароль ",-1)),t("div",we,[k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>i.value=l),type:r.value?"text":"password",placeholder:"Введите новый пароль",class:"w-full rounded-lg border border-stroke bg-transparent py-3 pl-6 pr-10 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary",required:"",minlength:"6"},null,8,he),[[I,i.value]]),t("span",{class:"absolute right-4 top-3 cursor-pointer p-0.5 z-10",onClick:s[1]||(s[1]=X(l=>r.value=!r.value,["prevent"]))},[r.value?(n(),d("svg",Me,[...s[8]||(s[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(n(),d("svg",_e,[...s[7]||(s[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))])])]),t("div",$e,[t("div",Ce,[t("button",{type:"button",onClick:c,class:"text-xs text-primary hover:underline"}," Сгенерировать случайный пароль "),i.value?(n(),d("button",{key:0,type:"button",onClick:T,class:"text-xs text-primary hover:underline ml-auto"}," Скопировать ")):u("",!0)])])]),t("div",Ue,[g(e,{type:"button",variant:"danger",onClick:C,disabled:o.value},{default:w(()=>[...s[10]||(s[10]=[b(" Отмена ",-1)])]),_:1},8,["disabled"]),g(e,{type:"submit",variant:"success",loading:o.value,disabled:o.value||!i.value||i.value.length<6},{default:w(()=>[...s[11]||(s[11]=[b(" Сохранить ",-1)])]),_:1},8,["loading","disabled"])])],32)])):u("",!0)]),_:1})])):u("",!0)]),_:1})])}}}),Ee=Object.assign(Ae,{__name:"UsersUserPasswordModal"});export{Be as _,Ee as a};
